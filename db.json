{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"themes/butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/about/index.md","hash":"ff6cfbf31d55b159013b29f07f2958eb86660858","modified":1647607891259},{"_id":"source/CNAME","hash":"68bad9461d64a58ff671b81b11c93a347f51f9be","modified":1646707032475},{"_id":"source/_posts/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1646706918300},{"_id":"source/.DS_Store","hash":"213ff6ed02d149755826ad5f57b416026c9533be","modified":1646796916529},{"_id":"source/tags/index.md","hash":"c695100d633c8bd10517875892f451b7d5b39445","modified":1647777014312},{"_id":"source/categories/index.md","hash":"6ea1eece30da8b92f41802f3a75d572c85ab2498","modified":1647776993438},{"_id":"source/_posts/2022/Git/git-command.md","hash":"de6ad1eb4fefbea56df37abc074a3362f6bc7ec8","modified":1647776851478},{"_id":"source/knowledge/index.md","hash":"a88f3e0301a9b2f0bd2217022c588993f45c6882","modified":1651640375570},{"_id":"source/_posts/2022/Git/git-back.md","hash":"b6b98056cecfa0ca68946ef009ac3963372eea28","modified":1647962161450},{"_id":"source/_posts/2022/Markdown/markdown-grammar.md","hash":"d0b90abed6cd66ab35186b4fe8db3b8f6e6dfdc7","modified":1647960545615},{"_id":"source/_posts/2022/android/Handler-内存泄漏解决方案.md","hash":"16fb5b624ee93f6168d52e6c5bcd071e9eb22b5a","modified":1651730733485},{"_id":"source/_posts/2022/java/LruCache-原理分析.md","hash":"39aff5ece7ac6d74106f85070db5dffb1d7c98ea","modified":1648053049528},{"_id":"source/_posts/2022/java/LinkedHashMap-原理分析.md","hash":"661595412a0d048bfdaf7b7f06d2b8df7f5de675","modified":1648086491041},{"_id":"source/_posts/2022/android/Handler-消息通讯机制详解.md","hash":"57a6847ab7200563f537cd65ed6eaa788a5984d3","modified":1651897898929},{"_id":"source/_posts/2022/android/glide-缓存那些事儿.md","hash":"0f0e48604998c98ac068cd17766ea5e14efb74cb","modified":1648692733178},{"_id":"source/_posts/2022/java/java-链表.md","hash":"b9f605131432e0bb293414915bfe5cbf742cdbdc","modified":1648692713378},{"_id":"source/_posts/2022/java/java-反射.md","hash":"7dfa1ceaf7e4473da70ecf9c05d69132f37bfa81","modified":1648987066150},{"_id":"themes/butterfly/package.json","hash":"bd78af0483a969cf800200b7cf69078495b5e7aa","modified":1646637730284},{"_id":"themes/butterfly/_config.yml","hash":"96d6b67dfd61ac4145c7acc89855d3694dbdacc1","modified":1649320567323},{"_id":"themes/butterfly/README.md","hash":"6ee27baf95a5741abbc224ef8938d679b6597665","modified":1646637730246},{"_id":"themes/butterfly/README_CN.md","hash":"49ace5208f98783344f17a00adab7641cda43280","modified":1646637730246},{"_id":"themes/butterfly/languages/default.yml","hash":"7fd2950554e99a6f15232267621f36f026a85380","modified":1646637730246},{"_id":"themes/butterfly/.DS_Store","hash":"42da7dd0c132054c2d6e79a537567f89d5006d3c","modified":1647611899613},{"_id":"themes/butterfly/languages/en.yml","hash":"4b2c351f2b5fd4f8497e806085364928e1af0b5b","modified":1646637730247},{"_id":"themes/butterfly/languages/zh-CN.yml","hash":"6c35255c196ea8e9817b85b6d7729d00cf18f231","modified":1646637730247},{"_id":"themes/butterfly/languages/zh-TW.yml","hash":"ef035065ebb37fce3e56e51f8b56deb596db78b2","modified":1646637730248},{"_id":"themes/butterfly/.github/stale.yml","hash":"05a55a87fa7f122c59683e41c8b2e37e79f688f0","modified":1646637730245},{"_id":"themes/butterfly/layout/archive.pug","hash":"bd62286afb64a51c97e800c5945620d51605d5fa","modified":1646637730248},{"_id":"themes/butterfly/layout/category.pug","hash":"710708cfdb436bc875602abf096c919ccdf544db","modified":1646637730248},{"_id":"themes/butterfly/layout/index.pug","hash":"7beb11ed5120bbf662df12026b5f9a835854a785","modified":1647612307410},{"_id":"themes/butterfly/layout/page.pug","hash":"baf469784aef227e4cc840550888554588e87a13","modified":1646637730283},{"_id":"themes/butterfly/layout/post.pug","hash":"2f728121d632529282029580bd0daa285765d81c","modified":1651640385117},{"_id":"themes/butterfly/layout/tag.pug","hash":"0440f42569df2676273c026a92384fa7729bc4e9","modified":1646637730283},{"_id":"themes/butterfly/layout/includes/404.pug","hash":"cb49f737aca272ccfeb62880bd651eccee72a129","modified":1646637730248},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/feature_request.md","hash":"f6867a2f0417fe89a0f2008730ee19dd38422021","modified":1646637730245},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/custom.md","hash":"eff495eb1584cf4586e33c76e8b2fa6a469a179b","modified":1646637730245},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/bug_report.md","hash":"476802922b774b679225102ac30a9d9183394701","modified":1646637730245},{"_id":"themes/butterfly/.github/workflows/publish.yml","hash":"05857c2f265246d8de00e31037f2720709540c09","modified":1646637730245},{"_id":"themes/butterfly/layout/includes/additional-js.pug","hash":"594a977ebe8d97e60fa3d7cb40fc260ded4d8a58","modified":1646637730249},{"_id":"themes/butterfly/layout/includes/footer.pug","hash":"02390a5b6ae1f57497b22ba2e6be9f13cfb7acac","modified":1646637730249},{"_id":"themes/butterfly/layout/includes/head.pug","hash":"09ea5da460ece61fb036f2ba7274fa61571775fc","modified":1646637730249},{"_id":"themes/butterfly/layout/includes/layout.pug","hash":"6f2608c4d93d3d10ae6b2cd7f8918f303f024321","modified":1646637730258},{"_id":"themes/butterfly/layout/includes/pagination.pug","hash":"0b80f04950bd0fe5e6c4e7b7559adf4d0ce28436","modified":1646637730266},{"_id":"themes/butterfly/layout/includes/rightside.pug","hash":"699d0d2cff233628752956c4434125c8203f7d63","modified":1646637730267},{"_id":"themes/butterfly/layout/includes/sidebar.pug","hash":"f093ab771257a6a939b194f68607a2038c8d7da3","modified":1646637730267},{"_id":"themes/butterfly/scripts/events/404.js","hash":"83cd7f73225ccad123afbd526ce1834eb1eb6a6d","modified":1646637730284},{"_id":"themes/butterfly/scripts/events/config.js","hash":"5c9f4bffa7e4a0ac125ecf3a8af44fdeaab7ed2a","modified":1646637730284},{"_id":"themes/butterfly/scripts/events/init.js","hash":"a7f567b3d3110afe2f99c967b8e15351a7f5bd6d","modified":1646637730284},{"_id":"themes/butterfly/scripts/events/stylus.js","hash":"9819f0996234fbd80d6c50a9e526c56ebf22588d","modified":1646637730285},{"_id":"themes/butterfly/scripts/events/welcome.js","hash":"3cfc46c749e2fd7ae9c2a17206238ed0e0e17e7d","modified":1646637730285},{"_id":"themes/butterfly/scripts/filters/post_lazyload.js","hash":"932df912976261929f809b7dbd4eb473e7787345","modified":1646637730285},{"_id":"themes/butterfly/scripts/filters/random_cover.js","hash":"21379ed2dccb69c43b893895c9d56238c11e5f43","modified":1646734547730},{"_id":"themes/butterfly/scripts/helpers/aside_archives.js","hash":"2ec66513d5322f185d2071acc052978ba9415a8e","modified":1646637730286},{"_id":"themes/butterfly/LICENSE","hash":"1128f8f91104ba9ef98d37eea6523a888dcfa5de","modified":1646637730245},{"_id":"themes/butterfly/scripts/helpers/page.js","hash":"c6611d97087c51845cb1ab4821696a62fa33daeb","modified":1646637730286},{"_id":"themes/butterfly/scripts/helpers/aside_categories.js","hash":"e00efdb5d02bc5c6eb4159e498af69fa61a7dbb9","modified":1646637730286},{"_id":"themes/butterfly/scripts/helpers/inject_head_js.js","hash":"6a103a2472903289bdecd5240eb89cac0b9e13d9","modified":1646637730286},{"_id":"themes/butterfly/scripts/helpers/related_post.js","hash":"21556f9cb412ddc500ad12ecfd419f3ea6c9f663","modified":1646637730287},{"_id":"themes/butterfly/scripts/tag/button.js","hash":"91d954f6e9fe6e571eb8ec9f8996294b2dc3688e","modified":1646637730288},{"_id":"themes/butterfly/scripts/tag/flink.js","hash":"ab62919fa567b95fbe14889517abda649991b1ee","modified":1646637730288},{"_id":"themes/butterfly/scripts/tag/gallery.js","hash":"f79c99f6c5b626c272dc2bed2b0250d6b91bb28a","modified":1646637730288},{"_id":"themes/butterfly/scripts/tag/hide.js","hash":"396c3ab1bcf1c7693ad7e506eadd13016c6769b6","modified":1646637730289},{"_id":"themes/butterfly/scripts/tag/inlineImg.js","hash":"a43ee2c7871bdd93cb6beb804429e404570f7929","modified":1646637730289},{"_id":"themes/butterfly/scripts/tag/label.js","hash":"03b2afef41d02bd1045c89578a02402c28356006","modified":1646637730289},{"_id":"themes/butterfly/scripts/tag/mermaid.js","hash":"531808a290b8bdd66bac2faab211ada8e9646a37","modified":1646637730290},{"_id":"themes/butterfly/scripts/tag/note.js","hash":"c16c6eb058af2b36bcd583b2591076c7ebdd51ad","modified":1646637730290},{"_id":"themes/butterfly/scripts/tag/tabs.js","hash":"6c6e415623d0fd39da016d9e353bb4f5cca444f5","modified":1646637730290},{"_id":"themes/butterfly/scripts/tag/timeline.js","hash":"300eb779588bf35a1b687d9f829d866074b707e3","modified":1646637730291},{"_id":"themes/butterfly/source/css/.DS_Store","hash":"4c7a1834ddd57897f9a8a86d3aa9aba6af66c9b3","modified":1647611160321},{"_id":"themes/butterfly/source/css/index.styl","hash":"861998e4ac67a59529a8245a9130d68f826c9c12","modified":1646637730318},{"_id":"themes/butterfly/source/css/var.styl","hash":"4890a40366d6443f8b8942a4e9a6dce9fe3494f5","modified":1646637730319},{"_id":"themes/butterfly/source/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1646637730319},{"_id":"themes/butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1646637730319},{"_id":"themes/butterfly/source/js/tw_cn.js","hash":"00053ce73210274b3679f42607edef1206eebc68","modified":1646637730323},{"_id":"themes/butterfly/source/js/main.js","hash":"04efcbd28b37875cfec88eb87cab7256a9ebb327","modified":1646637730321},{"_id":"themes/butterfly/layout/includes/head/Open_Graph.pug","hash":"6c41f49a3e682067533dd9384e6e4511fc3a1349","modified":1646637730249},{"_id":"themes/butterfly/layout/includes/head/analytics.pug","hash":"15530d9ac59c576d79af75dd687efe71e8d261b0","modified":1646637730249},{"_id":"themes/butterfly/layout/includes/head/config.pug","hash":"1e0e6657a09fd29beb41bcd6c1bac90b9ce0cad2","modified":1646637730250},{"_id":"themes/butterfly/layout/includes/head/config_site.pug","hash":"7df90c8e432e33716517ab918b0a125bc284041b","modified":1646637730250},{"_id":"themes/butterfly/layout/includes/head/google_adsense.pug","hash":"95a37e92b39c44bcbea4be7e29ddb3921c5b8220","modified":1646637730250},{"_id":"themes/butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1646637730320},{"_id":"themes/butterfly/source/js/utils.js","hash":"0b95daada72abb5d64a1e3236049a60120e47cca","modified":1646637730323},{"_id":"themes/butterfly/layout/includes/head/noscript.pug","hash":"d16ad2ee0ff5751fd7f8a5ce1b83935518674977","modified":1646637730250},{"_id":"themes/butterfly/layout/includes/head/pwa.pug","hash":"3d492cfe645d37c94d30512e0b230b0a09913148","modified":1646637730250},{"_id":"themes/butterfly/layout/includes/head/preconnect.pug","hash":"65a23b5170204e55b813ce13a79d799b66b7382c","modified":1646637730250},{"_id":"themes/butterfly/layout/includes/head/site_verification.pug","hash":"e2e8d681f183f00ce5ee239c42d2e36b3744daad","modified":1646637730251},{"_id":"themes/butterfly/layout/includes/header/index.pug","hash":"65fa23680af0daf64930a399c2f2ca37809a8149","modified":1646637730251},{"_id":"themes/butterfly/layout/includes/header/menu_item.pug","hash":"31346a210f4f9912c5b29f51d8f659913492f388","modified":1646637730251},{"_id":"themes/butterfly/layout/includes/header/nav.pug","hash":"78a3abd90bb3c18cd773d3d5abac3541e7f415e5","modified":1646637730251},{"_id":"themes/butterfly/layout/includes/header/post-info.pug","hash":"dc3913c1a6dd207051c3d3414a33851ae8bc0a45","modified":1646637730251},{"_id":"themes/butterfly/layout/includes/header/social.pug","hash":"0d953e51d04a9294a64153c89c20f491a9ec42d4","modified":1646637730252},{"_id":"themes/butterfly/layout/includes/loading/loading-js.pug","hash":"4cfcf0100e37ce91864703cd44f1cb99cb5493ea","modified":1646637730258},{"_id":"themes/butterfly/layout/includes/loading/loading.pug","hash":"5276937fbcceb9d62879dc47be880cd469a27349","modified":1646637730259},{"_id":"themes/butterfly/layout/includes/mixins/post-ui.pug","hash":"b9ebb02af8ccf43e3f73be43db19254fa913c57b","modified":1646637730259},{"_id":"themes/butterfly/layout/includes/mixins/article-sort.pug","hash":"2fb74d0b0e4b98749427c5a1a1b0acb6c85fadc4","modified":1646637730259},{"_id":"themes/butterfly/layout/includes/page/default-page.pug","hash":"12c65c174d26a41821df9bad26cdf1087ec5b0ca","modified":1646637730265},{"_id":"themes/butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":1646637730265},{"_id":"themes/butterfly/layout/includes/page/flink.pug","hash":"fed069baa9b383f57db32bb631115071d29bdc60","modified":1646637730265},{"_id":"themes/butterfly/layout/includes/page/tags.pug","hash":"6311eda08e4515281c51bd49f43902a51832383c","modified":1646637730266},{"_id":"themes/butterfly/layout/includes/post/reward.pug","hash":"864869c43fe5b5bb6f4ac6b13dd4bfb16ea47550","modified":1646637730266},{"_id":"themes/butterfly/layout/includes/third-party/aplayer.pug","hash":"c7cfade2b160380432c47eef4cd62273b6508c58","modified":1646637730267},{"_id":"themes/butterfly/layout/includes/post/post-copyright.pug","hash":"88e3b611b03149665e4113cfa39595c1a3fca7e5","modified":1646637730266},{"_id":"themes/butterfly/layout/includes/third-party/effect.pug","hash":"6528e86656906117a1af6b90e0349c2c4651d5e1","modified":1646637730273},{"_id":"themes/butterfly/layout/includes/third-party/pangu.pug","hash":"0f024e36b8116118233e10118714bde304e01e12","modified":1646637730276},{"_id":"themes/butterfly/layout/includes/third-party/prismjs.pug","hash":"ffb9ea15a2b54423cd4cd441e2d061b8233e9b58","modified":1646637730277},{"_id":"themes/butterfly/layout/includes/third-party/pjax.pug","hash":"de2e978ff0cacd02eb635cf7676a39e9a21781dd","modified":1646637730277},{"_id":"themes/butterfly/layout/includes/third-party/subtitle.pug","hash":"bae2f32ac96cebef600c1e37eaa8467c9a7e5d92","modified":1646637730279},{"_id":"themes/butterfly/layout/includes/widget/card_ad.pug","hash":"60dc48a7b5d89c2a49123c3fc5893ab9c57dd225","modified":1646637730279},{"_id":"themes/butterfly/layout/includes/widget/card_archives.pug","hash":"86897010fe71503e239887fd8f6a4f5851737be9","modified":1646637730280},{"_id":"themes/butterfly/layout/includes/widget/card_announcement.pug","hash":"ae392459ad401a083ca51ee0b27526b3c1e1faed","modified":1646637730279},{"_id":"themes/butterfly/layout/includes/widget/card_author.pug","hash":"0380a1e048e6219ea4b4a8a4eadba960edf308f0","modified":1646637730280},{"_id":"themes/butterfly/layout/includes/widget/card_bottom_self.pug","hash":"13dc8ce922e2e2332fe6ad5856ebb5dbf9ea4444","modified":1646637730280},{"_id":"themes/butterfly/layout/includes/widget/card_categories.pug","hash":"d1a416d0a8a7916d0b1a41d73adc66f8c811e493","modified":1646637730280},{"_id":"themes/butterfly/layout/includes/widget/card_newest_comment.pug","hash":"6d93564a8bd13cb9b52ee5e178db3bcbf18b1bc6","modified":1646637730281},{"_id":"themes/butterfly/layout/includes/widget/card_post_toc.pug","hash":"3057a2f6f051355e35d3b205121af8735100eacf","modified":1646637730281},{"_id":"themes/butterfly/layout/includes/widget/card_recent_post.pug","hash":"9c1229af6ab48961021886882c473514101fba21","modified":1646637730281},{"_id":"themes/butterfly/layout/includes/widget/card_tags.pug","hash":"438aea3e713ed16b7559b9a80a9c5ec0221263df","modified":1646637730282},{"_id":"themes/butterfly/layout/includes/widget/card_top_self.pug","hash":"ae67c6d4130a6c075058a9c1faea1648bcc6f83e","modified":1646637730282},{"_id":"themes/butterfly/layout/includes/widget/card_webinfo.pug","hash":"0612aaee878f33ea8d3da0293c7dc3b6cd871466","modified":1646637730282},{"_id":"themes/butterfly/layout/includes/widget/index.pug","hash":"7fb096656c8a6c21a4b6a5100885b1081d6021ed","modified":1646637730282},{"_id":"themes/butterfly/source/css/_global/function.styl","hash":"f7fd855593396b30932a06627287a73a407aff88","modified":1646637730292},{"_id":"themes/butterfly/source/css/_highlight/highlight.styl","hash":"2f95e99b8351fbecd9037a1bbdc3fee9d6ea8a77","modified":1646637730293},{"_id":"themes/butterfly/source/css/_global/index.styl","hash":"714f19e7d66df84938bd1b82b33d5667abe1f147","modified":1646637730292},{"_id":"themes/butterfly/source/css/_layout/chat.styl","hash":"29f48f9370f245e6e575b5836bccf47eb5688d8b","modified":1646637730301},{"_id":"themes/butterfly/source/css/_layout/aside.styl","hash":"2d3b0386c8b62a61734e10bab2cf86842cbb1673","modified":1646637730301},{"_id":"themes/butterfly/source/css/_layout/footer.styl","hash":"26be2afa9d4e7016cf3c42a6cd166f01e8e4ad5c","modified":1646637730302},{"_id":"themes/butterfly/source/css/_highlight/theme.styl","hash":"bcd384c8b2aa0390c9eb69ac1abbfd1240ce1da4","modified":1646637730300},{"_id":"themes/butterfly/source/css/_layout/comments.styl","hash":"c61dccca690d486c3d9c29cf028d87b777385141","modified":1646637730301},{"_id":"themes/butterfly/source/css/_layout/head.styl","hash":"d97c1722ce0fcc319f1f90ec2d51f9d746748e2b","modified":1646637730302},{"_id":"themes/butterfly/source/css/_layout/loading.styl","hash":"ef21990de28bd75dcd0f88b8d616e1a7a137502f","modified":1646637730302},{"_id":"themes/butterfly/source/css/_layout/pagination.styl","hash":"fb9f78bfbb79579f1d752cb73fb6d25c8418e0fd","modified":1646637730303},{"_id":"themes/butterfly/source/css/_layout/post.styl","hash":"84d4f27fde933bdf839629eb3bddcbc0f4592836","modified":1646637730303},{"_id":"themes/butterfly/source/css/_layout/relatedposts.styl","hash":"d53de408cb27a2e704aba7f7402b7caebe0410d8","modified":1646637730303},{"_id":"themes/butterfly/source/css/_layout/rightside.styl","hash":"bd88ee30ebf8ca2e7b4d3a034c317fd61733921f","modified":1646637730304},{"_id":"themes/butterfly/source/css/_layout/reward.styl","hash":"c5cfed620708807a48076b5ee59b0ba84e29aa80","modified":1646637730304},{"_id":"themes/butterfly/source/css/_layout/sidebar.styl","hash":"1bcbc80dff19cd53d0b367c3b9a3c751d3a1f10d","modified":1646637730304},{"_id":"themes/butterfly/source/css/_layout/third-party.styl","hash":"9e39e9b8c40b71b2118498090f959874b1362c87","modified":1647612023638},{"_id":"themes/butterfly/source/css/_mode/darkmode.styl","hash":"f67177310f5594954b25a591d186d28d5d450b18","modified":1646637730305},{"_id":"themes/butterfly/source/css/_page/404.styl","hash":"50dbb9e6d98c71ffe16741b8c1b0c1b9771efd2b","modified":1646637730306},{"_id":"themes/butterfly/source/css/_mode/readmode.styl","hash":"69f8e9414526dfda3af9a71c8e528fdd0ecbbfe5","modified":1646637730305},{"_id":"themes/butterfly/source/css/_page/categories.styl","hash":"f01ee74948cedb44e53cd3bb1ef36b7d2778ede7","modified":1646637730306},{"_id":"themes/butterfly/source/css/_page/archives.styl","hash":"6f4b4ede52305bce9b22c8c897dcbde8af6e2ce4","modified":1646637730306},{"_id":"themes/butterfly/source/css/_page/flink.styl","hash":"98d755b686ee833e9da10afaa40c4ec2bd66c19a","modified":1646637730307},{"_id":"themes/butterfly/source/css/_page/common.styl","hash":"a58d35d698885f1034dedbe99f7dbc1a801412c6","modified":1646637730307},{"_id":"themes/butterfly/source/css/_page/tags.styl","hash":"580feb7e8b0822a1be48ac380f8c5c53b1523321","modified":1646637730307},{"_id":"themes/butterfly/source/css/_search/algolia.styl","hash":"656f9007d94cf29a20532705d94fb7f22827e6fe","modified":1646637730314},{"_id":"themes/butterfly/source/css/_page/homepage.styl","hash":"826dae759062d8f84eb2bf5ab8fdb80e0f79d58b","modified":1646637730307},{"_id":"themes/butterfly/source/css/_search/index.styl","hash":"0290605c4984882990059eefe3ad18d2ac6a19ef","modified":1646637730315},{"_id":"themes/butterfly/source/css/_search/local-search.styl","hash":"e4c987c0202162b50dec91e1df74665d0fa933c9","modified":1646637730315},{"_id":"themes/butterfly/source/css/_tags/button.styl","hash":"45f0c32bdea117540f6b14ebac6450d7142bd710","modified":1646637730315},{"_id":"themes/butterfly/source/css/_tags/hexo.styl","hash":"d76c38adf1d9c1279ef4241835667789f5b736e0","modified":1646637730316},{"_id":"themes/butterfly/source/css/_tags/hide.styl","hash":"ce489ca2e249e2a3cf71584e20d84bdb022e3475","modified":1646637730316},{"_id":"themes/butterfly/source/css/_tags/gallery.styl","hash":"a310e48f826a4cacc55d8e68f43806e5085554f6","modified":1646637730316},{"_id":"themes/butterfly/source/css/_tags/inlineImg.styl","hash":"df9d405c33a9a68946b530410f64096bcb72560c","modified":1646637730316},{"_id":"themes/butterfly/source/css/_tags/label.styl","hash":"66c59e193d794cdb02cca7bd1dc4aea5a19d7e84","modified":1646637730317},{"_id":"themes/butterfly/source/css/_tags/note.styl","hash":"08493b66b9f31f2bd3e9a3115017a0ce16142b20","modified":1646637730317},{"_id":"themes/butterfly/source/css/_tags/timeline.styl","hash":"f071156d439556e7463ed4bc61ceee87170d5d08","modified":1646637730317},{"_id":"themes/butterfly/source/css/_tags/tabs.styl","hash":"bf9568444dd54e39dc59b461323dcd38942f27d9","modified":1646637730317},{"_id":"themes/butterfly/source/js/search/local-search.js","hash":"ec62117f38e095425f295b1170c222c7a1399425","modified":1646637730322},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"7848ec58c6ec03243abf80a3b22b4dc10f3edf53","modified":1646637730268},{"_id":"themes/butterfly/source/css/_third-party/normalize.min.css","hash":"2c18a1c9604af475b4749def8f1959df88d8b276","modified":1646637730318},{"_id":"themes/butterfly/source/js/search/algolia.js","hash":"aaa5e44125dcf321866bc2355a73773b11db8c9c","modified":1646637730322},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d85c3737b5c9548553a78b757a7698df126a52cf","modified":1646637730268},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"7d98129f2ee08169f877b76d4d0b95c17df354f8","modified":1646637730268},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"309b9aee523f90aff13d48142d124de9039d8511","modified":1646637730269},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"e3bf847553515174f6085df982f0623e9783db7a","modified":1646637730268},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"00b6daac4cc26dd0832984ec51bf44b8e0f56d13","modified":1646637730269},{"_id":"themes/butterfly/layout/includes/third-party/chat/chatra.pug","hash":"481cd5053bafb1a19f623554a27d3aa077ea59c3","modified":1646637730269},{"_id":"themes/butterfly/layout/includes/third-party/chat/crisp.pug","hash":"76634112c64023177260d1317ae39cef2a68e35f","modified":1646637730269},{"_id":"themes/butterfly/layout/includes/third-party/chat/daovoice.pug","hash":"cfe63e7d26a6665df6aa32ca90868ad48e05ec04","modified":1646637730270},{"_id":"themes/butterfly/layout/includes/third-party/chat/gitter.pug","hash":"d1d2474420bf4edc2e43ccdff6f92b8b082143df","modified":1646637730270},{"_id":"themes/butterfly/layout/includes/third-party/chat/index.pug","hash":"3f05f8311ae559d768ee3d0925e84ed767c314d3","modified":1646637730270},{"_id":"themes/butterfly/layout/includes/third-party/chat/tidio.pug","hash":"24a926756c2300b9c561aaab6bd3a71fdd16e16d","modified":1646637730270},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqus.pug","hash":"a111407fdcafcf1099e26ffa69786f8822c5d9fb","modified":1646637730271},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"693d999777dd16e0566d29ac3203d4c167b2f9a7","modified":1646637730271},{"_id":"themes/butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"fe684aaad4c99b908dc4499c85afd9a2cd893aae","modified":1646637730271},{"_id":"themes/butterfly/layout/includes/third-party/comments/giscus.pug","hash":"591ef23c583690bd74af0cafb09af64ba5bd8151","modified":1646637730272},{"_id":"themes/butterfly/layout/includes/third-party/comments/index.pug","hash":"e4850f2c9ba5f6b2248808f7257662679e0fab0a","modified":1646637730272},{"_id":"themes/butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"22e2ef30fe5eb1db7566e89943c74ece029b2a8e","modified":1646637730272},{"_id":"themes/butterfly/layout/includes/third-party/comments/js.pug","hash":"9302837f1e35f153323bb4f166514c7e96e8ecdd","modified":1646637730272},{"_id":"themes/butterfly/layout/includes/third-party/comments/livere.pug","hash":"52ea8aa26b84d3ad38ae28cdf0f163e9ca8dced7","modified":1646637730273},{"_id":"themes/butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"c488a3414dbae899488b6d46f6cb91575bc23b9e","modified":1646637730273},{"_id":"themes/butterfly/layout/includes/third-party/comments/utterances.pug","hash":"a737046e730eb7264606ba0536218964044492f9","modified":1646637730273},{"_id":"themes/butterfly/layout/includes/third-party/comments/valine.pug","hash":"e55b9c0f8ced231f47eb88bd7f4ec99f29c5c29d","modified":1646637730273},{"_id":"themes/butterfly/layout/includes/third-party/comments/waline.pug","hash":"e660100b37dc3146abb690ecaf2937cfd4f043d2","modified":1646637730273},{"_id":"themes/butterfly/layout/includes/third-party/math/index.pug","hash":"b8ae5fd7d74e1edcef21f5004fc96147e064d219","modified":1646637730274},{"_id":"themes/butterfly/layout/includes/third-party/math/katex.pug","hash":"8cb8fcc210edab1ae1adf4aee8cc6948f7e9f28e","modified":1646637730274},{"_id":"themes/butterfly/layout/includes/third-party/math/mathjax.pug","hash":"5737164f5a77fb813b5bacba0a273d2a490a2ced","modified":1646637730274},{"_id":"themes/butterfly/layout/includes/third-party/math/mermaid.pug","hash":"7c712719bb8960c335f94b519923e5a86ee7bd32","modified":1646637730274},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"04b2a5882e789a988e41d45abe606f0617b08e38","modified":1646637730275},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"e846ddfe4a63b15d1416f6055f5756af5e3da7c6","modified":1646637730275},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"f6506ccfd1ce994b9e53aa95588d0b6dbad11411","modified":1646637730275},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"26ac3fb930fe9f3ace0c5d0191b87425bf053e74","modified":1646637730276},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"290b8de49afd3a14594c4dc19955145b1327619f","modified":1646637730276},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"d19e1c2c0a50f0e4547d71a17b9be88e8152f17c","modified":1646637730276},{"_id":"themes/butterfly/layout/includes/third-party/search/algolia.pug","hash":"c92df4f9d0611cf44c1a4491e226f242ec80f5bb","modified":1646637730277},{"_id":"themes/butterfly/layout/includes/third-party/search/local-search.pug","hash":"8ce336a4c8cae81b58ee26ff51040ca650ff1519","modified":1646637730278},{"_id":"themes/butterfly/layout/includes/third-party/search/index.pug","hash":"da3b9437d061ee68dbc383057db5c73034c49605","modified":1646637730277},{"_id":"themes/butterfly/layout/includes/third-party/share/add-this.pug","hash":"2980f1889226ca981aa23b8eb1853fde26dcf89a","modified":1646637730278},{"_id":"themes/butterfly/layout/includes/third-party/share/addtoany.pug","hash":"85c92f8a7e44d7cd1c86f089a05be438535e5362","modified":1646637730278},{"_id":"themes/butterfly/layout/includes/third-party/share/index.pug","hash":"4c4a9c15215ae8ac5eadb0e086b278f76db9ee92","modified":1646637730278},{"_id":"themes/butterfly/layout/includes/third-party/share/share-js.pug","hash":"f61d63724ea5c5f352568b3a16bde023affefbe5","modified":1646637730279},{"_id":"themes/butterfly/source/css/_highlight/highlight/index.styl","hash":"18804c58239d95798fa86d0597f32d7f7dd30051","modified":1646637730293},{"_id":"themes/butterfly/source/css/_highlight/highlight/diff.styl","hash":"cf1fae641c927621a4df1be5ca4a853b9b526e23","modified":1646637730293},{"_id":"themes/butterfly/source/css/_highlight/prismjs/index.styl","hash":"5dc2e0bcae9a54bfb9bdcc82d02ae5a3cf1ca97d","modified":1646637730294},{"_id":"themes/butterfly/source/css/_highlight/prismjs/diff.styl","hash":"5972c61f5125068cbe0af279a0c93a54847fdc3b","modified":1646637730293},{"_id":"themes/butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"8970cc1916c982b64a1478792b2822d1d31e276d","modified":1646637730300},{"_id":"public/search.xml","hash":"74a0b4436ed47167b7da41f16a47b61df145edc1","modified":1651905023984},{"_id":"public/tags/index.html","hash":"daad88a13f30b34e3c69a1160e12ad6d33f6e0cf","modified":1651906238075},{"_id":"public/about/index.html","hash":"50b2f2c576fbadbdf8b91256635e82ec1d0cbdd7","modified":1651906238075},{"_id":"public/knowledge/index.html","hash":"8860138411d273af90476ac5ad72d10f715dd458","modified":1651906238075},{"_id":"public/categories/index.html","hash":"e971f2952add628fb40ca44b4e9d8f135941c5be","modified":1651906238075},{"_id":"public/relaxed/Handler-内存泄漏解决方案/index.html","hash":"1447419d28c3feade700f1b1056148bb0bb8d0f1","modified":1651905023984},{"_id":"public/relaxed/Handler-消息通讯机制详解/index.html","hash":"df8fe8f63909c40c877e54ed590f7608c85d78dc","modified":1651905023984},{"_id":"public/relaxed/java-反射/index.html","hash":"249ec72dbe5930b8ff82d720956a1896051c38ec","modified":1651905023984},{"_id":"public/relaxed/LruCache-原理分析/index.html","hash":"2da06541b85656c03d978bec57f76f3dd408a4db","modified":1651905023984},{"_id":"public/relaxed/java-链表/index.html","hash":"729f1abcaf640c27b0a8e2703f2ae31e0ebdb41f","modified":1651905023984},{"_id":"public/relaxed/glide-缓存那些事儿/index.html","hash":"33323a3ef4f0cc91cd23eb9b7be7adadd68a7e97","modified":1651905023984},{"_id":"public/relaxed/LinkedHashMap-原理分析/index.html","hash":"4c897ec13a8c345e0170edcdca32a21a3ccf6981","modified":1651905023984},{"_id":"public/relaxed/git-back/index.html","hash":"31dce0d1961709599b20df2eb463f08925362c7f","modified":1651905023984},{"_id":"public/relaxed/git-command/index.html","hash":"6c155278221820f689af2427b02a95f07cddadc7","modified":1651905023984},{"_id":"public/relaxed/markdown-grammar/index.html","hash":"48c211afdc06474585de2dadd2c1f0ba457f5e9f","modified":1651905023984},{"_id":"public/archives/index.html","hash":"8efe67449d33528d1a9b27cbf974666dfa81c638","modified":1651906238075},{"_id":"public/archives/2022/index.html","hash":"bb369fa092f6e78299bfde0759736b757ea28a5a","modified":1651906238075},{"_id":"public/archives/2022/03/index.html","hash":"ee4953ae7a664676543537f3538d29e39d677186","modified":1651906238075},{"_id":"public/archives/2022/04/index.html","hash":"e73cb5e2c854c8de0ec1640a7595f306c913210f","modified":1651906238075},{"_id":"public/archives/2022/05/index.html","hash":"643d86461f3e1e3078ebc18be5c111e63625bd7a","modified":1651906238075},{"_id":"public/index.html","hash":"5a00482a75ce8fc22a9de6d75a76dd1b6b36bfea","modified":1651906238075},{"_id":"public/categories/Git/index.html","hash":"0ebd7b0a5b6052fa325d05c3df0e0bca23c533de","modified":1651906238075},{"_id":"public/categories/Markdown/index.html","hash":"746fc822de78d30ca1a3925f2aa1f5418c6c9077","modified":1651906238075},{"_id":"public/categories/Android/index.html","hash":"4cb7ea83fb8f1cb0ca2a9eb862ac753414891354","modified":1651906238075},{"_id":"public/categories/Java/index.html","hash":"c6228d124e3bd4769475ba42d8cf2d97f0ab8017","modified":1651906238075},{"_id":"public/tags/Git/index.html","hash":"a8b214ec64314eb4321438c43d76835cbe138b6c","modified":1651906238075},{"_id":"public/tags/Markdown/index.html","hash":"0f1b7c32f9afcd7fa96c9386dd05c5671c3b7040","modified":1651906238075},{"_id":"public/tags/Handler/index.html","hash":"b16834fef5a8ce3e9ba657cc8bb78281c9f934a2","modified":1651906238075},{"_id":"public/tags/Android/index.html","hash":"1d8594422c7f85746885041f350f8fa9412c4772","modified":1651906238075},{"_id":"public/tags/Java/index.html","hash":"72c48778ea35a913c3a524d4315d38dfb6cf9124","modified":1651906238075},{"_id":"public/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1651905023984},{"_id":"public/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1651905023984},{"_id":"public/CNAME","hash":"68bad9461d64a58ff671b81b11c93a347f51f9be","modified":1651905023984},{"_id":"public/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1651905023984},{"_id":"public/css/var.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1651905023984},{"_id":"public/js/search/local-search.js","hash":"ec62117f38e095425f295b1170c222c7a1399425","modified":1651905023984},{"_id":"public/js/search/algolia.js","hash":"aaa5e44125dcf321866bc2355a73773b11db8c9c","modified":1651905023984},{"_id":"public/js/utils.js","hash":"0b95daada72abb5d64a1e3236049a60120e47cca","modified":1651905023984},{"_id":"public/css/index.css","hash":"34a5bcaf0d12884c22801bdeb81addb37fa7b504","modified":1651905023984},{"_id":"public/js/tw_cn.js","hash":"00053ce73210274b3679f42607edef1206eebc68","modified":1651905023984},{"_id":"public/js/main.js","hash":"04efcbd28b37875cfec88eb87cab7256a9ebb327","modified":1651905023984}],"Category":[{"name":"Git","_id":"cl2vhlmfp0004t6fy5830bpr6"},{"name":"Markdown","_id":"cl2vhlmfx000gt6fy5m427ghq"},{"name":"Android","_id":"cl2vhlmg1000nt6fy6nhf3y2k"},{"name":"Java","_id":"cl2vhlmg6000zt6fy0kpn1cnr"}],"Data":[],"Page":[{"title":"标签","date":"2020-11-24T07:14:39.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2020-11-24 15:14:39\ntype: \"tags\"\n---\n","updated":"2022-03-20T11:50:14.312Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cl2vhlmfh0000t6fy5mh8gibx","content":"","site":{"data":{}},"cover":"https://s1.ax1x.com/2022/03/18/qFjhon.jpg","excerpt":"","more":""},{"title":"关于","date":"2020-11-24T08:05:01.000Z","_content":"# About Simpler\n欢迎访问以下链接找到我，一起学习，一起交流\n\n<div style=\"display: flex;\">\n<!-- 简书 -->\n  <a href = \"https://www.jianshu.com/u/ea7cce3b286a\" title = \"简书\" align = left >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFulM4.png\"  width=\"30\" height=\"30\" >\n  </a>\n  &nbsp; &nbsp;\n<!-- 掘金 -->\n  <a href = \"https://juejin.cn/user/2858385961663149\" title = \"掘金\" align = left >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFuNi6.png\"  width=\"30\" height=\"30\" >\n  </a>\n  &nbsp; &nbsp;\n  <!-- CSDN -->\n  <a href = \"https://blog.csdn.net/qq_20605113?spm=1010.2135.3001.5421\" title = \"CSDN\" >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFuDLd.png\"  width=\"30\" height=\"30\" >\n  </a>\n  &nbsp; &nbsp;\n  <!--Github-->\n  <a href = \"https://github.com/Simplerd\" title = \"Github\" >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFQdzT.png\"  width=\"30\" height=\"30\" >\n  </a>\n</div>\n\n\n{% link <简书>,<https://www.jianshu.com/u/ea7cce3b286a>,<https://s1.ax1x.com/2022/03/18/qFulM4.png> %}\n# About Blog\n  [框架·Hexo](https://hexo.io/docs/)\n  [主题·Butterfly](https://butterfly.js.org/)\n","source":"about/index.md","raw":"---\ntitle: 关于\ndate: 2020-11-24 16:05:01\n---\n# About Simpler\n欢迎访问以下链接找到我，一起学习，一起交流\n\n<div style=\"display: flex;\">\n<!-- 简书 -->\n  <a href = \"https://www.jianshu.com/u/ea7cce3b286a\" title = \"简书\" align = left >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFulM4.png\"  width=\"30\" height=\"30\" >\n  </a>\n  &nbsp; &nbsp;\n<!-- 掘金 -->\n  <a href = \"https://juejin.cn/user/2858385961663149\" title = \"掘金\" align = left >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFuNi6.png\"  width=\"30\" height=\"30\" >\n  </a>\n  &nbsp; &nbsp;\n  <!-- CSDN -->\n  <a href = \"https://blog.csdn.net/qq_20605113?spm=1010.2135.3001.5421\" title = \"CSDN\" >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFuDLd.png\"  width=\"30\" height=\"30\" >\n  </a>\n  &nbsp; &nbsp;\n  <!--Github-->\n  <a href = \"https://github.com/Simplerd\" title = \"Github\" >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFQdzT.png\"  width=\"30\" height=\"30\" >\n  </a>\n</div>\n\n\n{% link <简书>,<https://www.jianshu.com/u/ea7cce3b286a>,<https://s1.ax1x.com/2022/03/18/qFulM4.png> %}\n# About Blog\n  [框架·Hexo](https://hexo.io/docs/)\n  [主题·Butterfly](https://butterfly.js.org/)\n","updated":"2022-03-18T12:51:31.259Z","path":"about/index.html","comments":1,"layout":"page","_id":"cl2vhlmfn0002t6fyarx7dmje","content":"<h1 id=\"About-Simpler\"><a href=\"#About-Simpler\" class=\"headerlink\" title=\"About Simpler\"></a>About Simpler</h1><p>欢迎访问以下链接找到我，一起学习，一起交流</p>\n<div style=\"display: flex;\">\n<!-- 简书 -->\n  <a href = \"https://www.jianshu.com/u/ea7cce3b286a\" title = \"简书\" align = left >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFulM4.png\"  width=\"30\" height=\"30\" >\n  </a>\n  &nbsp; &nbsp;\n<!-- 掘金 -->\n  <a href = \"https://juejin.cn/user/2858385961663149\" title = \"掘金\" align = left >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFuNi6.png\"  width=\"30\" height=\"30\" >\n  </a>\n  &nbsp; &nbsp;\n  <!-- CSDN -->\n  <a href = \"https://blog.csdn.net/qq_20605113?spm=1010.2135.3001.5421\" title = \"CSDN\" >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFuDLd.png\"  width=\"30\" height=\"30\" >\n  </a>\n  &nbsp; &nbsp;\n  <!--Github-->\n  <a href = \"https://github.com/Simplerd\" title = \"Github\" >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFQdzT.png\"  width=\"30\" height=\"30\" >\n  </a>\n</div>\n\n\n<a href=\"%3C%E7%AE%80%E4%B9%A6%3E,%3Chttps://www.jianshu.com/u/ea7cce3b286a%3E,%3Chttps://s1.ax1x.com/2022/03/18/qFulM4.png%3E\" title=\"\" target=\"\"></a>\n<h1 id=\"About-Blog\"><a href=\"#About-Blog\" class=\"headerlink\" title=\"About Blog\"></a>About Blog</h1><p>  <a href=\"https://hexo.io/docs/\">框架·Hexo</a><br>  <a href=\"https://butterfly.js.org/\">主题·Butterfly</a></p>\n","site":{"data":{}},"cover":"https://s1.ax1x.com/2022/03/18/qFjhon.jpg","excerpt":"","more":"<h1 id=\"About-Simpler\"><a href=\"#About-Simpler\" class=\"headerlink\" title=\"About Simpler\"></a>About Simpler</h1><p>欢迎访问以下链接找到我，一起学习，一起交流</p>\n<div style=\"display: flex;\">\n<!-- 简书 -->\n  <a href = \"https://www.jianshu.com/u/ea7cce3b286a\" title = \"简书\" align = left >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFulM4.png\"  width=\"30\" height=\"30\" >\n  </a>\n  &nbsp; &nbsp;\n<!-- 掘金 -->\n  <a href = \"https://juejin.cn/user/2858385961663149\" title = \"掘金\" align = left >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFuNi6.png\"  width=\"30\" height=\"30\" >\n  </a>\n  &nbsp; &nbsp;\n  <!-- CSDN -->\n  <a href = \"https://blog.csdn.net/qq_20605113?spm=1010.2135.3001.5421\" title = \"CSDN\" >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFuDLd.png\"  width=\"30\" height=\"30\" >\n  </a>\n  &nbsp; &nbsp;\n  <!--Github-->\n  <a href = \"https://github.com/Simplerd\" title = \"Github\" >  \n  <img src=\"https://s1.ax1x.com/2022/03/18/qFQdzT.png\"  width=\"30\" height=\"30\" >\n  </a>\n</div>\n\n\n<a href=\"%3C%E7%AE%80%E4%B9%A6%3E,%3Chttps://www.jianshu.com/u/ea7cce3b286a%3E,%3Chttps://s1.ax1x.com/2022/03/18/qFulM4.png%3E\" title=\"\" target=\"\"></a>\n<h1 id=\"About-Blog\"><a href=\"#About-Blog\" class=\"headerlink\" title=\"About Blog\"></a>About Blog</h1><p>  <a href=\"https://hexo.io/docs/\">框架·Hexo</a><br>  <a href=\"https://butterfly.js.org/\">主题·Butterfly</a></p>\n"},{"title":"知识体系","date":"2020-11-24T07:12:19.000Z","type":"knowledge","_content":"\n# Android\n\n| 文章系列 | 文章数目 | 状态备注 |\n| :-----:| :----: | :----: |\n| {% post_link glide-缓存那些事儿 Glide缓存那些事儿 %}  | 1篇 | 完结 |\n| {% post_link Handler-内存泄漏解决方案 %}  | 1篇 | 完结 |\n\n# Java\n\n| 文章系列 | 文章数目 | 状态备注 |\n| :-----:| :----: | :----: |\n| {% post_link java-链表 Java链表(单向、循环、双向) %}  | 1篇 | 完结 |\n| {% post_link LinkedHashMap-原理分析 LinkedHashMap原理分析 %}  | 1篇 | 完结 |\n| {% post_link LruCache-原理分析 LruCache原理分析 %}  | 1篇 | 完结 |\n\n# Git\n\n| 文章系列 | 文章数目 | 状态备注 |\n| :-----:| :----: | :----: |\n| {% post_link git-command Git常用命令 %}  | 1篇 | 完结 |\n| {% post_link git-back Git代码回滚 %} | 1篇 | 完结|\n\n# Markdown\n\n| 文章系列 | 文章数目 | 状态备注 |\n| :-----:| :----: | :----: |\n| {% post_link markdown-grammar markdown基本语法 %}  | 1篇 | 完结 |\n","source":"knowledge/index.md","raw":"---\ntitle: 知识体系\ndate: 2020-11-24 15:12:19\ntype: \"knowledge\"\n---\n\n# Android\n\n| 文章系列 | 文章数目 | 状态备注 |\n| :-----:| :----: | :----: |\n| {% post_link glide-缓存那些事儿 Glide缓存那些事儿 %}  | 1篇 | 完结 |\n| {% post_link Handler-内存泄漏解决方案 %}  | 1篇 | 完结 |\n\n# Java\n\n| 文章系列 | 文章数目 | 状态备注 |\n| :-----:| :----: | :----: |\n| {% post_link java-链表 Java链表(单向、循环、双向) %}  | 1篇 | 完结 |\n| {% post_link LinkedHashMap-原理分析 LinkedHashMap原理分析 %}  | 1篇 | 完结 |\n| {% post_link LruCache-原理分析 LruCache原理分析 %}  | 1篇 | 完结 |\n\n# Git\n\n| 文章系列 | 文章数目 | 状态备注 |\n| :-----:| :----: | :----: |\n| {% post_link git-command Git常用命令 %}  | 1篇 | 完结 |\n| {% post_link git-back Git代码回滚 %} | 1篇 | 完结|\n\n# Markdown\n\n| 文章系列 | 文章数目 | 状态备注 |\n| :-----:| :----: | :----: |\n| {% post_link markdown-grammar markdown基本语法 %}  | 1篇 | 完结 |\n","updated":"2022-05-04T04:59:35.570Z","path":"knowledge/index.html","comments":1,"layout":"page","_id":"cl2vhlmfr0006t6fy6zc1c68b","content":"<h1 id=\"Android\"><a href=\"#Android\" class=\"headerlink\" title=\"Android\"></a>Android</h1><table>\n<thead>\n<tr>\n<th align=\"center\">文章系列</th>\n<th align=\"center\">文章数目</th>\n<th align=\"center\">状态备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"/relaxed/glide-%E7%BC%93%E5%AD%98%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/\" title=\"Glide缓存那些事儿\">Glide缓存那些事儿</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"/relaxed/Handler-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/\" title=\"Handler-内存泄漏解决方案\">Handler-内存泄漏解决方案</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n</tbody></table>\n<h1 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h1><table>\n<thead>\n<tr>\n<th align=\"center\">文章系列</th>\n<th align=\"center\">文章数目</th>\n<th align=\"center\">状态备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"/relaxed/java-%E9%93%BE%E8%A1%A8/\" title=\"Java链表(单向、循环、双向)\">Java链表(单向、循环、双向)</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"/relaxed/LinkedHashMap-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/\" title=\"LinkedHashMap原理分析\">LinkedHashMap原理分析</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"/relaxed/LruCache-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/\" title=\"LruCache原理分析\">LruCache原理分析</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n</tbody></table>\n<h1 id=\"Git\"><a href=\"#Git\" class=\"headerlink\" title=\"Git\"></a>Git</h1><table>\n<thead>\n<tr>\n<th align=\"center\">文章系列</th>\n<th align=\"center\">文章数目</th>\n<th align=\"center\">状态备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"/relaxed/git-command/\" title=\"Git常用命令\">Git常用命令</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"/relaxed/git-back/\" title=\"Git代码回滚\">Git代码回滚</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n</tbody></table>\n<h1 id=\"Markdown\"><a href=\"#Markdown\" class=\"headerlink\" title=\"Markdown\"></a>Markdown</h1><table>\n<thead>\n<tr>\n<th align=\"center\">文章系列</th>\n<th align=\"center\">文章数目</th>\n<th align=\"center\">状态备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"/relaxed/markdown-grammar/\" title=\"markdown基本语法\">markdown基本语法</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n</tbody></table>\n","site":{"data":{}},"cover":"https://s1.ax1x.com/2022/03/18/qFjhon.jpg","excerpt":"","more":"<h1 id=\"Android\"><a href=\"#Android\" class=\"headerlink\" title=\"Android\"></a>Android</h1><table>\n<thead>\n<tr>\n<th align=\"center\">文章系列</th>\n<th align=\"center\">文章数目</th>\n<th align=\"center\">状态备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"/relaxed/glide-%E7%BC%93%E5%AD%98%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/\" title=\"Glide缓存那些事儿\">Glide缓存那些事儿</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"/relaxed/Handler-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/\" title=\"Handler-内存泄漏解决方案\">Handler-内存泄漏解决方案</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n</tbody></table>\n<h1 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h1><table>\n<thead>\n<tr>\n<th align=\"center\">文章系列</th>\n<th align=\"center\">文章数目</th>\n<th align=\"center\">状态备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"/relaxed/java-%E9%93%BE%E8%A1%A8/\" title=\"Java链表(单向、循环、双向)\">Java链表(单向、循环、双向)</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"/relaxed/LinkedHashMap-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/\" title=\"LinkedHashMap原理分析\">LinkedHashMap原理分析</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"/relaxed/LruCache-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/\" title=\"LruCache原理分析\">LruCache原理分析</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n</tbody></table>\n<h1 id=\"Git\"><a href=\"#Git\" class=\"headerlink\" title=\"Git\"></a>Git</h1><table>\n<thead>\n<tr>\n<th align=\"center\">文章系列</th>\n<th align=\"center\">文章数目</th>\n<th align=\"center\">状态备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"/relaxed/git-command/\" title=\"Git常用命令\">Git常用命令</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"/relaxed/git-back/\" title=\"Git代码回滚\">Git代码回滚</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n</tbody></table>\n<h1 id=\"Markdown\"><a href=\"#Markdown\" class=\"headerlink\" title=\"Markdown\"></a>Markdown</h1><table>\n<thead>\n<tr>\n<th align=\"center\">文章系列</th>\n<th align=\"center\">文章数目</th>\n<th align=\"center\">状态备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"/relaxed/markdown-grammar/\" title=\"markdown基本语法\">markdown基本语法</a></td>\n<td align=\"center\">1篇</td>\n<td align=\"center\">完结</td>\n</tr>\n</tbody></table>\n"},{"title":"分类","date":"2020-11-24T07:12:19.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2020-11-24 15:12:19\ntype: \"categories\"\n---\n","updated":"2022-03-20T11:49:53.438Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cl2vhlmfs0008t6fy02iu7i4j","content":"","site":{"data":{}},"cover":"https://s1.ax1x.com/2022/03/18/qFjhon.jpg","excerpt":"","more":""}],"Post":[{"title":"Git代码回滚","date":"2022-03-17T15:06:12.000Z","cover":"https://www.eenzo.com/upload/cars/20190824/20190824141837_56697.jpg","_content":"\n\n## 前言\n&ensp;在我们开发过程中，因各种原因，避免不了将业务代码回滚至指定版本，或者具体一些到某次commit。\n下面我们将具体步骤及具体实现做分析。\n\n## 操作前阅读\n&ensp; 在代码回归操作过程中主要 围绕 git reset 命令进行，该命令会把版本库和工作目录改变为已知状态。具体来讲，git reset 调整 HEAD 引用指向指定的提交，默认情况下还会更新索引以匹配该提交。根据需要，git reset 命令也可以修改工作目录以呈现指定提交代表的项目修订版本。\n* git reset 命令有三个主要选项\n* `--soft`\n&ensp; 会将 HEAD 引用指向指定提交。索引和工作目录的内容保持不变。这个版本的命令有“最小”影响，只改变一个符号引用的状态使其指向一个新提交。\n\n* `--mixed`\n&ensp; 会将 HEAD 指向指定提交。索引内容也跟着改变以符合指定提交的树结构，但是工作目录中的内容保持不变。这个版本的命令将索引变成你刚刚暂存该提交全部变化时的状态，它会显示工作目录中还有什么修改。--mixed 是 git reset 的默认模式。\n\n* `--hard`\n&ensp; 这条命令将 HEAD 引用指向给定提交。索引的内容也跟着改变以符合给定提交的树结构。此外，工作目录的内容也随之改变以反映给定提交表示的树的状态。当改变工作目录的时候，整个目录结构都改成给定提交对应的样子。做的修改都将丢失，新文件将被删除。在给定提交中但不在工作目录中的文件将恢复回来。\n\n## 具体步骤\n&ensp;一般情况下，我们分为三个步骤就可以解决完代码回滚操作\n\n### 第一步\n* 执行 git log命令查看日志，获取需要回退的版本号\n例如:\n![](https://s3.bmp.ovh/imgs/2022/03/0c4021f483bb41cf.jpg)\n\n### 第二步\n执行 git reset –-soft <commit id> ，如 git reset --soft 4f5e9a90edeadcc45d85f43bd861a837fa7ce4c7 ，重置至指定版本的提交\n\n### 第三步\n执行 git push -f origin <branch_name> 强制提交当前版本号\n\n* \\>··< 此时恭喜你，你的代码回滚成功了\n","source":"_posts/2022/Git/git-back.md","raw":"---\ntitle: Git代码回滚\ndate: 2022-03-17 23:06:12\ncategories:\n - Git\ntags:\n - Git\ncover: https://www.eenzo.com/upload/cars/20190824/20190824141837_56697.jpg\n---\n\n\n## 前言\n&ensp;在我们开发过程中，因各种原因，避免不了将业务代码回滚至指定版本，或者具体一些到某次commit。\n下面我们将具体步骤及具体实现做分析。\n\n## 操作前阅读\n&ensp; 在代码回归操作过程中主要 围绕 git reset 命令进行，该命令会把版本库和工作目录改变为已知状态。具体来讲，git reset 调整 HEAD 引用指向指定的提交，默认情况下还会更新索引以匹配该提交。根据需要，git reset 命令也可以修改工作目录以呈现指定提交代表的项目修订版本。\n* git reset 命令有三个主要选项\n* `--soft`\n&ensp; 会将 HEAD 引用指向指定提交。索引和工作目录的内容保持不变。这个版本的命令有“最小”影响，只改变一个符号引用的状态使其指向一个新提交。\n\n* `--mixed`\n&ensp; 会将 HEAD 指向指定提交。索引内容也跟着改变以符合指定提交的树结构，但是工作目录中的内容保持不变。这个版本的命令将索引变成你刚刚暂存该提交全部变化时的状态，它会显示工作目录中还有什么修改。--mixed 是 git reset 的默认模式。\n\n* `--hard`\n&ensp; 这条命令将 HEAD 引用指向给定提交。索引的内容也跟着改变以符合给定提交的树结构。此外，工作目录的内容也随之改变以反映给定提交表示的树的状态。当改变工作目录的时候，整个目录结构都改成给定提交对应的样子。做的修改都将丢失，新文件将被删除。在给定提交中但不在工作目录中的文件将恢复回来。\n\n## 具体步骤\n&ensp;一般情况下，我们分为三个步骤就可以解决完代码回滚操作\n\n### 第一步\n* 执行 git log命令查看日志，获取需要回退的版本号\n例如:\n![](https://s3.bmp.ovh/imgs/2022/03/0c4021f483bb41cf.jpg)\n\n### 第二步\n执行 git reset –-soft <commit id> ，如 git reset --soft 4f5e9a90edeadcc45d85f43bd861a837fa7ce4c7 ，重置至指定版本的提交\n\n### 第三步\n执行 git push -f origin <branch_name> 强制提交当前版本号\n\n* \\>··< 此时恭喜你，你的代码回滚成功了\n","slug":"git-back","published":1,"relaxed":"Git","updated":"2022-03-22T15:16:01.450Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl2vhlmfk0001t6fydl615rdg","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>&ensp;在我们开发过程中，因各种原因，避免不了将业务代码回滚至指定版本，或者具体一些到某次commit。<br>下面我们将具体步骤及具体实现做分析。</p>\n<h2 id=\"操作前阅读\"><a href=\"#操作前阅读\" class=\"headerlink\" title=\"操作前阅读\"></a>操作前阅读</h2><p>&ensp; 在代码回归操作过程中主要 围绕 git reset 命令进行，该命令会把版本库和工作目录改变为已知状态。具体来讲，git reset 调整 HEAD 引用指向指定的提交，默认情况下还会更新索引以匹配该提交。根据需要，git reset 命令也可以修改工作目录以呈现指定提交代表的项目修订版本。</p>\n<ul>\n<li><p>git reset 命令有三个主要选项</p>\n</li>\n<li><p><code>--soft</code><br>&ensp; 会将 HEAD 引用指向指定提交。索引和工作目录的内容保持不变。这个版本的命令有“最小”影响，只改变一个符号引用的状态使其指向一个新提交。</p>\n</li>\n<li><p><code>--mixed</code><br>&ensp; 会将 HEAD 指向指定提交。索引内容也跟着改变以符合指定提交的树结构，但是工作目录中的内容保持不变。这个版本的命令将索引变成你刚刚暂存该提交全部变化时的状态，它会显示工作目录中还有什么修改。–mixed 是 git reset 的默认模式。</p>\n</li>\n<li><p><code>--hard</code><br>&ensp; 这条命令将 HEAD 引用指向给定提交。索引的内容也跟着改变以符合给定提交的树结构。此外，工作目录的内容也随之改变以反映给定提交表示的树的状态。当改变工作目录的时候，整个目录结构都改成给定提交对应的样子。做的修改都将丢失，新文件将被删除。在给定提交中但不在工作目录中的文件将恢复回来。</p>\n</li>\n</ul>\n<h2 id=\"具体步骤\"><a href=\"#具体步骤\" class=\"headerlink\" title=\"具体步骤\"></a>具体步骤</h2><p>&ensp;一般情况下，我们分为三个步骤就可以解决完代码回滚操作</p>\n<h3 id=\"第一步\"><a href=\"#第一步\" class=\"headerlink\" title=\"第一步\"></a>第一步</h3><ul>\n<li>执行 git log命令查看日志，获取需要回退的版本号<br>例如:<br><img src=\"https://s3.bmp.ovh/imgs/2022/03/0c4021f483bb41cf.jpg\"></li>\n</ul>\n<h3 id=\"第二步\"><a href=\"#第二步\" class=\"headerlink\" title=\"第二步\"></a>第二步</h3><p>执行 git reset –-soft <commit id> ，如 git reset –soft 4f5e9a90edeadcc45d85f43bd861a837fa7ce4c7 ，重置至指定版本的提交</p>\n<h3 id=\"第三步\"><a href=\"#第三步\" class=\"headerlink\" title=\"第三步\"></a>第三步</h3><p>执行 git push -f origin <branch_name> 强制提交当前版本号</p>\n<ul>\n<li>&gt;··&lt; 此时恭喜你，你的代码回滚成功了</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>&ensp;在我们开发过程中，因各种原因，避免不了将业务代码回滚至指定版本，或者具体一些到某次commit。<br>下面我们将具体步骤及具体实现做分析。</p>\n<h2 id=\"操作前阅读\"><a href=\"#操作前阅读\" class=\"headerlink\" title=\"操作前阅读\"></a>操作前阅读</h2><p>&ensp; 在代码回归操作过程中主要 围绕 git reset 命令进行，该命令会把版本库和工作目录改变为已知状态。具体来讲，git reset 调整 HEAD 引用指向指定的提交，默认情况下还会更新索引以匹配该提交。根据需要，git reset 命令也可以修改工作目录以呈现指定提交代表的项目修订版本。</p>\n<ul>\n<li><p>git reset 命令有三个主要选项</p>\n</li>\n<li><p><code>--soft</code><br>&ensp; 会将 HEAD 引用指向指定提交。索引和工作目录的内容保持不变。这个版本的命令有“最小”影响，只改变一个符号引用的状态使其指向一个新提交。</p>\n</li>\n<li><p><code>--mixed</code><br>&ensp; 会将 HEAD 指向指定提交。索引内容也跟着改变以符合指定提交的树结构，但是工作目录中的内容保持不变。这个版本的命令将索引变成你刚刚暂存该提交全部变化时的状态，它会显示工作目录中还有什么修改。–mixed 是 git reset 的默认模式。</p>\n</li>\n<li><p><code>--hard</code><br>&ensp; 这条命令将 HEAD 引用指向给定提交。索引的内容也跟着改变以符合给定提交的树结构。此外，工作目录的内容也随之改变以反映给定提交表示的树的状态。当改变工作目录的时候，整个目录结构都改成给定提交对应的样子。做的修改都将丢失，新文件将被删除。在给定提交中但不在工作目录中的文件将恢复回来。</p>\n</li>\n</ul>\n<h2 id=\"具体步骤\"><a href=\"#具体步骤\" class=\"headerlink\" title=\"具体步骤\"></a>具体步骤</h2><p>&ensp;一般情况下，我们分为三个步骤就可以解决完代码回滚操作</p>\n<h3 id=\"第一步\"><a href=\"#第一步\" class=\"headerlink\" title=\"第一步\"></a>第一步</h3><ul>\n<li>执行 git log命令查看日志，获取需要回退的版本号<br>例如:<br><img src=\"https://s3.bmp.ovh/imgs/2022/03/0c4021f483bb41cf.jpg\"></li>\n</ul>\n<h3 id=\"第二步\"><a href=\"#第二步\" class=\"headerlink\" title=\"第二步\"></a>第二步</h3><p>执行 git reset –-soft <commit id> ，如 git reset –soft 4f5e9a90edeadcc45d85f43bd861a837fa7ce4c7 ，重置至指定版本的提交</p>\n<h3 id=\"第三步\"><a href=\"#第三步\" class=\"headerlink\" title=\"第三步\"></a>第三步</h3><p>执行 git push -f origin <branch_name> 强制提交当前版本号</p>\n<ul>\n<li>&gt;··&lt; 此时恭喜你，你的代码回滚成功了</li>\n</ul>\n"},{"title":"Git常用命令","date":"2022-03-17T15:06:12.000Z","cover":"https://s3.bmp.ovh/imgs/2022/03/087ccecd2950bc30.jpeg","_content":"# 前言\n使用Git 命令前，先了解几个关键词的概念\n\n*   工作区（workSpace）\n*   暂缓区（stage/index）\n*   本地仓库（Repository）\n*   远程仓库（Remote）\n\n![](https://s3.bmp.ovh/imgs/2022/03/64aa14707f10bfb0.png)\n\n# Git 常见命令速查表\n![](https://ftp.bmp.ovh/imgs/2020/04/5991c03f6436c41b.jpg)\n\n## 创建版本库\n* 初始化本地git仓库（创建新仓库）\n>` git init `\n\n* 配置用户名\n> `git config --global user.name \"xxx\" `\n\n* 配置邮件\n>`git config --global user.email \"xxx@xxx.com\" `\n\n## 修改与提交\n* 查看当前版本状态（是否修改）\n>`git status`\n\n* 添加修改的指定文件至index(暂缓区)\n>`git add \"xxx\"`\n\n* 添加修改的所有文件至index(暂缓区)\n>`git add .`\n\n*  提交文件 \"xxx\"为本次提交的说明\"\n>`git commit -m 'xxx' `\n\n* 合并上一次提交\ngit commit -a -m 'xxx'   ==>>（等价于） git add .   git commit -m 'xxx'\n>`git commit --amend -m 'xxx'`\n\n* 将add和commit合为一步\n>` git commit -am 'xxx' `\n\n## 查看历史提交\n* 显示提交日志\n> `git log `\n\n*  显示1行日志 -n为n行 git log -5\n> `git log -1`\n\n* 显示提交日志及相关变动文件\n> `git log --stat `\n\n* 可查看该文件以前每一次push的修改内容）  \n> `git log -p + xxx(文件名)`\n\n* 只查看该文件当前这一次的push内容）\n> `git log - p -1 + xxx(文件名`\n\n* 显示HEAD提交日志\n>`git show HEAD `\n\n* 显示某个提交的详细内容\n>`git show dfb02e6e4f2f7b573337763e5c0013802e392818 `\n\n* 显示已存在的tag\n>`git tag`\n\n* 增加v2.0的tag\n>`git tag -a v2.0  -m 'xxx'  `\n\n* 显示v2.0的日志及详细内容\n>`git show v2.0 `\n\n* 显示v2.0的日志\n>`git log v2.0  `\n\n* 显示所有未添加至index的变更\n>`git diff `\n\n* 显示所有已添加index但还未commit的变更\n>`git diff --cached `\n\n## 撤销\n* 撤销 add 过的文件 xxx（指定文件名）\n>`git reset HEAR \"xxx\" `\n\n*  撤销上一次 add 过的所有文件\n>`git reset HEAR `\n\n* 放弃单个的文件修改\n>`git checkout -- xxx`\n\n*  放弃所有的文件修改\n>`git checkout .`\n\n## 分支与标签\n* 显示本地所有分支\n>`git branch`\n\n* 显示远程、本地所有分支\n>`git branch -a`\n\n* 切换至指定分支下\n>`git checkout \"xxx\"`\n\n* 创建新的分支\n>`git branch ”xxx“   xxx为新的分支名`\n\n* 创建新的分支并切换至当前新建的分支下\n>`git check -b \"xxx\"`\n\n* 删除指定分支\n>`git branch -d \"xxx\"`\n\n* 强制删除指定分支\n>`git branch -D \"xxx\"`\n\n* 删除tag\n>`git tag -d \"xxx\"`\n\n* 清除本地缓存分支\n>`git remote prune origin`\n\n## 合并已衍合\n\n* 合并远程master分支至当前分支\n>`git merge origin/master `\n\n* 合并提交ff44785404a8e的修改\n>`git cherry-pick \"ff44785404a8e\"`\n\n* 将当前分支push到远程master分支\n>`git push origin master `\n\n* 把所有本地tags推送到远程仓库\n>`git push --tags`\n\n* 获取所有远程分支（不更新本地分支）\n>`git fetch `\n\n*  获取所有原创分支并清除服务器上已删掉的分支\n>`git fetch --prune `\n\n* 获取远程分支master并merge到当前分支\n>`git pull origin master `\n\n* 重命名文件README为README2\n>`git mv README README2`\n\n* 将当前版本重置为HEAD（通常用于merge失败回退）\n>`git reset --hard HEAD `\n\n## 暂存\n* 暂存当前修改，将所有至为HEAD状态\n>`git stash `\n\n*  查看所有暂存\n>`git stash list`\n\n* 恢复暂存文件\n>`git stash pop `\n\n\n## 操作远程\n* 本地分支推送到远程仓库\n>`git push origin master `\n\n* -u选项指定一个默认主机\n>`git push -u origin`\n\n* 不管是否存在对应的远程分支，将本地的所有分支都推送到远程主机\n>`git push --all origin `\n","source":"_posts/2022/Git/git-command.md","raw":"---\ntitle: Git常用命令\ndate: 2022-03-17 23:06:12\ncategories:\n - Git\ntags:\n - Git\ncover: https://s3.bmp.ovh/imgs/2022/03/087ccecd2950bc30.jpeg\n---\n# 前言\n使用Git 命令前，先了解几个关键词的概念\n\n*   工作区（workSpace）\n*   暂缓区（stage/index）\n*   本地仓库（Repository）\n*   远程仓库（Remote）\n\n![](https://s3.bmp.ovh/imgs/2022/03/64aa14707f10bfb0.png)\n\n# Git 常见命令速查表\n![](https://ftp.bmp.ovh/imgs/2020/04/5991c03f6436c41b.jpg)\n\n## 创建版本库\n* 初始化本地git仓库（创建新仓库）\n>` git init `\n\n* 配置用户名\n> `git config --global user.name \"xxx\" `\n\n* 配置邮件\n>`git config --global user.email \"xxx@xxx.com\" `\n\n## 修改与提交\n* 查看当前版本状态（是否修改）\n>`git status`\n\n* 添加修改的指定文件至index(暂缓区)\n>`git add \"xxx\"`\n\n* 添加修改的所有文件至index(暂缓区)\n>`git add .`\n\n*  提交文件 \"xxx\"为本次提交的说明\"\n>`git commit -m 'xxx' `\n\n* 合并上一次提交\ngit commit -a -m 'xxx'   ==>>（等价于） git add .   git commit -m 'xxx'\n>`git commit --amend -m 'xxx'`\n\n* 将add和commit合为一步\n>` git commit -am 'xxx' `\n\n## 查看历史提交\n* 显示提交日志\n> `git log `\n\n*  显示1行日志 -n为n行 git log -5\n> `git log -1`\n\n* 显示提交日志及相关变动文件\n> `git log --stat `\n\n* 可查看该文件以前每一次push的修改内容）  \n> `git log -p + xxx(文件名)`\n\n* 只查看该文件当前这一次的push内容）\n> `git log - p -1 + xxx(文件名`\n\n* 显示HEAD提交日志\n>`git show HEAD `\n\n* 显示某个提交的详细内容\n>`git show dfb02e6e4f2f7b573337763e5c0013802e392818 `\n\n* 显示已存在的tag\n>`git tag`\n\n* 增加v2.0的tag\n>`git tag -a v2.0  -m 'xxx'  `\n\n* 显示v2.0的日志及详细内容\n>`git show v2.0 `\n\n* 显示v2.0的日志\n>`git log v2.0  `\n\n* 显示所有未添加至index的变更\n>`git diff `\n\n* 显示所有已添加index但还未commit的变更\n>`git diff --cached `\n\n## 撤销\n* 撤销 add 过的文件 xxx（指定文件名）\n>`git reset HEAR \"xxx\" `\n\n*  撤销上一次 add 过的所有文件\n>`git reset HEAR `\n\n* 放弃单个的文件修改\n>`git checkout -- xxx`\n\n*  放弃所有的文件修改\n>`git checkout .`\n\n## 分支与标签\n* 显示本地所有分支\n>`git branch`\n\n* 显示远程、本地所有分支\n>`git branch -a`\n\n* 切换至指定分支下\n>`git checkout \"xxx\"`\n\n* 创建新的分支\n>`git branch ”xxx“   xxx为新的分支名`\n\n* 创建新的分支并切换至当前新建的分支下\n>`git check -b \"xxx\"`\n\n* 删除指定分支\n>`git branch -d \"xxx\"`\n\n* 强制删除指定分支\n>`git branch -D \"xxx\"`\n\n* 删除tag\n>`git tag -d \"xxx\"`\n\n* 清除本地缓存分支\n>`git remote prune origin`\n\n## 合并已衍合\n\n* 合并远程master分支至当前分支\n>`git merge origin/master `\n\n* 合并提交ff44785404a8e的修改\n>`git cherry-pick \"ff44785404a8e\"`\n\n* 将当前分支push到远程master分支\n>`git push origin master `\n\n* 把所有本地tags推送到远程仓库\n>`git push --tags`\n\n* 获取所有远程分支（不更新本地分支）\n>`git fetch `\n\n*  获取所有原创分支并清除服务器上已删掉的分支\n>`git fetch --prune `\n\n* 获取远程分支master并merge到当前分支\n>`git pull origin master `\n\n* 重命名文件README为README2\n>`git mv README README2`\n\n* 将当前版本重置为HEAD（通常用于merge失败回退）\n>`git reset --hard HEAD `\n\n## 暂存\n* 暂存当前修改，将所有至为HEAD状态\n>`git stash `\n\n*  查看所有暂存\n>`git stash list`\n\n* 恢复暂存文件\n>`git stash pop `\n\n\n## 操作远程\n* 本地分支推送到远程仓库\n>`git push origin master `\n\n* -u选项指定一个默认主机\n>`git push -u origin`\n\n* 不管是否存在对应的远程分支，将本地的所有分支都推送到远程主机\n>`git push --all origin `\n","slug":"git-command","published":1,"relaxed":"Git","updated":"2022-03-20T11:47:31.478Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl2vhlmfn0003t6fyb3nt5url","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>使用Git 命令前，先了解几个关键词的概念</p>\n<ul>\n<li>  工作区（workSpace）</li>\n<li>  暂缓区（stage/index）</li>\n<li>  本地仓库（Repository）</li>\n<li>  远程仓库（Remote）</li>\n</ul>\n<p><img src=\"https://s3.bmp.ovh/imgs/2022/03/64aa14707f10bfb0.png\"></p>\n<h1 id=\"Git-常见命令速查表\"><a href=\"#Git-常见命令速查表\" class=\"headerlink\" title=\"Git 常见命令速查表\"></a>Git 常见命令速查表</h1><p><img src=\"https://ftp.bmp.ovh/imgs/2020/04/5991c03f6436c41b.jpg\"></p>\n<h2 id=\"创建版本库\"><a href=\"#创建版本库\" class=\"headerlink\" title=\"创建版本库\"></a>创建版本库</h2><ul>\n<li><p>初始化本地git仓库（创建新仓库）</p>\n<blockquote>\n<p><code>git init</code></p>\n</blockquote>\n</li>\n<li><p>配置用户名</p>\n<blockquote>\n<p><code>git config --global user.name &quot;xxx&quot; </code></p>\n</blockquote>\n</li>\n<li><p>配置邮件</p>\n<blockquote>\n<p><code>git config --global user.email &quot;xxx@xxx.com&quot; </code></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"修改与提交\"><a href=\"#修改与提交\" class=\"headerlink\" title=\"修改与提交\"></a>修改与提交</h2><ul>\n<li><p>查看当前版本状态（是否修改）</p>\n<blockquote>\n<p><code>git status</code></p>\n</blockquote>\n</li>\n<li><p>添加修改的指定文件至index(暂缓区)</p>\n<blockquote>\n<p><code>git add &quot;xxx&quot;</code></p>\n</blockquote>\n</li>\n<li><p>添加修改的所有文件至index(暂缓区)</p>\n<blockquote>\n<p><code>git add .</code></p>\n</blockquote>\n</li>\n<li><p> 提交文件 “xxx”为本次提交的说明”</p>\n<blockquote>\n<p><code>git commit -m &#39;xxx&#39; </code></p>\n</blockquote>\n</li>\n<li><p>合并上一次提交<br>git commit -a -m ‘xxx’   ==&gt;&gt;（等价于） git add .   git commit -m ‘xxx’</p>\n<blockquote>\n<p><code>git commit --amend -m &#39;xxx&#39;</code></p>\n</blockquote>\n</li>\n<li><p>将add和commit合为一步</p>\n<blockquote>\n<p><code>git commit -am &#39;xxx&#39;</code></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"查看历史提交\"><a href=\"#查看历史提交\" class=\"headerlink\" title=\"查看历史提交\"></a>查看历史提交</h2><ul>\n<li><p>显示提交日志</p>\n<blockquote>\n<p><code>git log </code></p>\n</blockquote>\n</li>\n<li><p> 显示1行日志 -n为n行 git log -5</p>\n<blockquote>\n<p><code>git log -1</code></p>\n</blockquote>\n</li>\n<li><p>显示提交日志及相关变动文件</p>\n<blockquote>\n<p><code>git log --stat </code></p>\n</blockquote>\n</li>\n<li><p>可查看该文件以前每一次push的修改内容）  </p>\n<blockquote>\n<p><code>git log -p + xxx(文件名)</code></p>\n</blockquote>\n</li>\n<li><p>只查看该文件当前这一次的push内容）</p>\n<blockquote>\n<p><code>git log - p -1 + xxx(文件名</code></p>\n</blockquote>\n</li>\n<li><p>显示HEAD提交日志</p>\n<blockquote>\n<p><code>git show HEAD </code></p>\n</blockquote>\n</li>\n<li><p>显示某个提交的详细内容</p>\n<blockquote>\n<p><code>git show dfb02e6e4f2f7b573337763e5c0013802e392818 </code></p>\n</blockquote>\n</li>\n<li><p>显示已存在的tag</p>\n<blockquote>\n<p><code>git tag</code></p>\n</blockquote>\n</li>\n<li><p>增加v2.0的tag</p>\n<blockquote>\n<p><code>git tag -a v2.0  -m &#39;xxx&#39;  </code></p>\n</blockquote>\n</li>\n<li><p>显示v2.0的日志及详细内容</p>\n<blockquote>\n<p><code>git show v2.0 </code></p>\n</blockquote>\n</li>\n<li><p>显示v2.0的日志</p>\n<blockquote>\n<p><code>git log v2.0  </code></p>\n</blockquote>\n</li>\n<li><p>显示所有未添加至index的变更</p>\n<blockquote>\n<p><code>git diff </code></p>\n</blockquote>\n</li>\n<li><p>显示所有已添加index但还未commit的变更</p>\n<blockquote>\n<p><code>git diff --cached </code></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"撤销\"><a href=\"#撤销\" class=\"headerlink\" title=\"撤销\"></a>撤销</h2><ul>\n<li><p>撤销 add 过的文件 xxx（指定文件名）</p>\n<blockquote>\n<p><code>git reset HEAR &quot;xxx&quot; </code></p>\n</blockquote>\n</li>\n<li><p> 撤销上一次 add 过的所有文件</p>\n<blockquote>\n<p><code>git reset HEAR </code></p>\n</blockquote>\n</li>\n<li><p>放弃单个的文件修改</p>\n<blockquote>\n<p><code>git checkout -- xxx</code></p>\n</blockquote>\n</li>\n<li><p> 放弃所有的文件修改</p>\n<blockquote>\n<p><code>git checkout .</code></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"分支与标签\"><a href=\"#分支与标签\" class=\"headerlink\" title=\"分支与标签\"></a>分支与标签</h2><ul>\n<li><p>显示本地所有分支</p>\n<blockquote>\n<p><code>git branch</code></p>\n</blockquote>\n</li>\n<li><p>显示远程、本地所有分支</p>\n<blockquote>\n<p><code>git branch -a</code></p>\n</blockquote>\n</li>\n<li><p>切换至指定分支下</p>\n<blockquote>\n<p><code>git checkout &quot;xxx&quot;</code></p>\n</blockquote>\n</li>\n<li><p>创建新的分支</p>\n<blockquote>\n<p><code>git branch ”xxx“   xxx为新的分支名</code></p>\n</blockquote>\n</li>\n<li><p>创建新的分支并切换至当前新建的分支下</p>\n<blockquote>\n<p><code>git check -b &quot;xxx&quot;</code></p>\n</blockquote>\n</li>\n<li><p>删除指定分支</p>\n<blockquote>\n<p><code>git branch -d &quot;xxx&quot;</code></p>\n</blockquote>\n</li>\n<li><p>强制删除指定分支</p>\n<blockquote>\n<p><code>git branch -D &quot;xxx&quot;</code></p>\n</blockquote>\n</li>\n<li><p>删除tag</p>\n<blockquote>\n<p><code>git tag -d &quot;xxx&quot;</code></p>\n</blockquote>\n</li>\n<li><p>清除本地缓存分支</p>\n<blockquote>\n<p><code>git remote prune origin</code></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"合并已衍合\"><a href=\"#合并已衍合\" class=\"headerlink\" title=\"合并已衍合\"></a>合并已衍合</h2><ul>\n<li><p>合并远程master分支至当前分支</p>\n<blockquote>\n<p><code>git merge origin/master </code></p>\n</blockquote>\n</li>\n<li><p>合并提交ff44785404a8e的修改</p>\n<blockquote>\n<p><code>git cherry-pick &quot;ff44785404a8e&quot;</code></p>\n</blockquote>\n</li>\n<li><p>将当前分支push到远程master分支</p>\n<blockquote>\n<p><code>git push origin master </code></p>\n</blockquote>\n</li>\n<li><p>把所有本地tags推送到远程仓库</p>\n<blockquote>\n<p><code>git push --tags</code></p>\n</blockquote>\n</li>\n<li><p>获取所有远程分支（不更新本地分支）</p>\n<blockquote>\n<p><code>git fetch </code></p>\n</blockquote>\n</li>\n<li><p> 获取所有原创分支并清除服务器上已删掉的分支</p>\n<blockquote>\n<p><code>git fetch --prune </code></p>\n</blockquote>\n</li>\n<li><p>获取远程分支master并merge到当前分支</p>\n<blockquote>\n<p><code>git pull origin master </code></p>\n</blockquote>\n</li>\n<li><p>重命名文件README为README2</p>\n<blockquote>\n<p><code>git mv README README2</code></p>\n</blockquote>\n</li>\n<li><p>将当前版本重置为HEAD（通常用于merge失败回退）</p>\n<blockquote>\n<p><code>git reset --hard HEAD </code></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"暂存\"><a href=\"#暂存\" class=\"headerlink\" title=\"暂存\"></a>暂存</h2><ul>\n<li><p>暂存当前修改，将所有至为HEAD状态</p>\n<blockquote>\n<p><code>git stash </code></p>\n</blockquote>\n</li>\n<li><p> 查看所有暂存</p>\n<blockquote>\n<p><code>git stash list</code></p>\n</blockquote>\n</li>\n<li><p>恢复暂存文件</p>\n<blockquote>\n<p><code>git stash pop </code></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"操作远程\"><a href=\"#操作远程\" class=\"headerlink\" title=\"操作远程\"></a>操作远程</h2><ul>\n<li><p>本地分支推送到远程仓库</p>\n<blockquote>\n<p><code>git push origin master </code></p>\n</blockquote>\n</li>\n<li><p>-u选项指定一个默认主机</p>\n<blockquote>\n<p><code>git push -u origin</code></p>\n</blockquote>\n</li>\n<li><p>不管是否存在对应的远程分支，将本地的所有分支都推送到远程主机</p>\n<blockquote>\n<p><code>git push --all origin </code></p>\n</blockquote>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>使用Git 命令前，先了解几个关键词的概念</p>\n<ul>\n<li>  工作区（workSpace）</li>\n<li>  暂缓区（stage/index）</li>\n<li>  本地仓库（Repository）</li>\n<li>  远程仓库（Remote）</li>\n</ul>\n<p><img src=\"https://s3.bmp.ovh/imgs/2022/03/64aa14707f10bfb0.png\"></p>\n<h1 id=\"Git-常见命令速查表\"><a href=\"#Git-常见命令速查表\" class=\"headerlink\" title=\"Git 常见命令速查表\"></a>Git 常见命令速查表</h1><p><img src=\"https://ftp.bmp.ovh/imgs/2020/04/5991c03f6436c41b.jpg\"></p>\n<h2 id=\"创建版本库\"><a href=\"#创建版本库\" class=\"headerlink\" title=\"创建版本库\"></a>创建版本库</h2><ul>\n<li><p>初始化本地git仓库（创建新仓库）</p>\n<blockquote>\n<p><code>git init</code></p>\n</blockquote>\n</li>\n<li><p>配置用户名</p>\n<blockquote>\n<p><code>git config --global user.name &quot;xxx&quot; </code></p>\n</blockquote>\n</li>\n<li><p>配置邮件</p>\n<blockquote>\n<p><code>git config --global user.email &quot;xxx@xxx.com&quot; </code></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"修改与提交\"><a href=\"#修改与提交\" class=\"headerlink\" title=\"修改与提交\"></a>修改与提交</h2><ul>\n<li><p>查看当前版本状态（是否修改）</p>\n<blockquote>\n<p><code>git status</code></p>\n</blockquote>\n</li>\n<li><p>添加修改的指定文件至index(暂缓区)</p>\n<blockquote>\n<p><code>git add &quot;xxx&quot;</code></p>\n</blockquote>\n</li>\n<li><p>添加修改的所有文件至index(暂缓区)</p>\n<blockquote>\n<p><code>git add .</code></p>\n</blockquote>\n</li>\n<li><p> 提交文件 “xxx”为本次提交的说明”</p>\n<blockquote>\n<p><code>git commit -m &#39;xxx&#39; </code></p>\n</blockquote>\n</li>\n<li><p>合并上一次提交<br>git commit -a -m ‘xxx’   ==&gt;&gt;（等价于） git add .   git commit -m ‘xxx’</p>\n<blockquote>\n<p><code>git commit --amend -m &#39;xxx&#39;</code></p>\n</blockquote>\n</li>\n<li><p>将add和commit合为一步</p>\n<blockquote>\n<p><code>git commit -am &#39;xxx&#39;</code></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"查看历史提交\"><a href=\"#查看历史提交\" class=\"headerlink\" title=\"查看历史提交\"></a>查看历史提交</h2><ul>\n<li><p>显示提交日志</p>\n<blockquote>\n<p><code>git log </code></p>\n</blockquote>\n</li>\n<li><p> 显示1行日志 -n为n行 git log -5</p>\n<blockquote>\n<p><code>git log -1</code></p>\n</blockquote>\n</li>\n<li><p>显示提交日志及相关变动文件</p>\n<blockquote>\n<p><code>git log --stat </code></p>\n</blockquote>\n</li>\n<li><p>可查看该文件以前每一次push的修改内容）  </p>\n<blockquote>\n<p><code>git log -p + xxx(文件名)</code></p>\n</blockquote>\n</li>\n<li><p>只查看该文件当前这一次的push内容）</p>\n<blockquote>\n<p><code>git log - p -1 + xxx(文件名</code></p>\n</blockquote>\n</li>\n<li><p>显示HEAD提交日志</p>\n<blockquote>\n<p><code>git show HEAD </code></p>\n</blockquote>\n</li>\n<li><p>显示某个提交的详细内容</p>\n<blockquote>\n<p><code>git show dfb02e6e4f2f7b573337763e5c0013802e392818 </code></p>\n</blockquote>\n</li>\n<li><p>显示已存在的tag</p>\n<blockquote>\n<p><code>git tag</code></p>\n</blockquote>\n</li>\n<li><p>增加v2.0的tag</p>\n<blockquote>\n<p><code>git tag -a v2.0  -m &#39;xxx&#39;  </code></p>\n</blockquote>\n</li>\n<li><p>显示v2.0的日志及详细内容</p>\n<blockquote>\n<p><code>git show v2.0 </code></p>\n</blockquote>\n</li>\n<li><p>显示v2.0的日志</p>\n<blockquote>\n<p><code>git log v2.0  </code></p>\n</blockquote>\n</li>\n<li><p>显示所有未添加至index的变更</p>\n<blockquote>\n<p><code>git diff </code></p>\n</blockquote>\n</li>\n<li><p>显示所有已添加index但还未commit的变更</p>\n<blockquote>\n<p><code>git diff --cached </code></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"撤销\"><a href=\"#撤销\" class=\"headerlink\" title=\"撤销\"></a>撤销</h2><ul>\n<li><p>撤销 add 过的文件 xxx（指定文件名）</p>\n<blockquote>\n<p><code>git reset HEAR &quot;xxx&quot; </code></p>\n</blockquote>\n</li>\n<li><p> 撤销上一次 add 过的所有文件</p>\n<blockquote>\n<p><code>git reset HEAR </code></p>\n</blockquote>\n</li>\n<li><p>放弃单个的文件修改</p>\n<blockquote>\n<p><code>git checkout -- xxx</code></p>\n</blockquote>\n</li>\n<li><p> 放弃所有的文件修改</p>\n<blockquote>\n<p><code>git checkout .</code></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"分支与标签\"><a href=\"#分支与标签\" class=\"headerlink\" title=\"分支与标签\"></a>分支与标签</h2><ul>\n<li><p>显示本地所有分支</p>\n<blockquote>\n<p><code>git branch</code></p>\n</blockquote>\n</li>\n<li><p>显示远程、本地所有分支</p>\n<blockquote>\n<p><code>git branch -a</code></p>\n</blockquote>\n</li>\n<li><p>切换至指定分支下</p>\n<blockquote>\n<p><code>git checkout &quot;xxx&quot;</code></p>\n</blockquote>\n</li>\n<li><p>创建新的分支</p>\n<blockquote>\n<p><code>git branch ”xxx“   xxx为新的分支名</code></p>\n</blockquote>\n</li>\n<li><p>创建新的分支并切换至当前新建的分支下</p>\n<blockquote>\n<p><code>git check -b &quot;xxx&quot;</code></p>\n</blockquote>\n</li>\n<li><p>删除指定分支</p>\n<blockquote>\n<p><code>git branch -d &quot;xxx&quot;</code></p>\n</blockquote>\n</li>\n<li><p>强制删除指定分支</p>\n<blockquote>\n<p><code>git branch -D &quot;xxx&quot;</code></p>\n</blockquote>\n</li>\n<li><p>删除tag</p>\n<blockquote>\n<p><code>git tag -d &quot;xxx&quot;</code></p>\n</blockquote>\n</li>\n<li><p>清除本地缓存分支</p>\n<blockquote>\n<p><code>git remote prune origin</code></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"合并已衍合\"><a href=\"#合并已衍合\" class=\"headerlink\" title=\"合并已衍合\"></a>合并已衍合</h2><ul>\n<li><p>合并远程master分支至当前分支</p>\n<blockquote>\n<p><code>git merge origin/master </code></p>\n</blockquote>\n</li>\n<li><p>合并提交ff44785404a8e的修改</p>\n<blockquote>\n<p><code>git cherry-pick &quot;ff44785404a8e&quot;</code></p>\n</blockquote>\n</li>\n<li><p>将当前分支push到远程master分支</p>\n<blockquote>\n<p><code>git push origin master </code></p>\n</blockquote>\n</li>\n<li><p>把所有本地tags推送到远程仓库</p>\n<blockquote>\n<p><code>git push --tags</code></p>\n</blockquote>\n</li>\n<li><p>获取所有远程分支（不更新本地分支）</p>\n<blockquote>\n<p><code>git fetch </code></p>\n</blockquote>\n</li>\n<li><p> 获取所有原创分支并清除服务器上已删掉的分支</p>\n<blockquote>\n<p><code>git fetch --prune </code></p>\n</blockquote>\n</li>\n<li><p>获取远程分支master并merge到当前分支</p>\n<blockquote>\n<p><code>git pull origin master </code></p>\n</blockquote>\n</li>\n<li><p>重命名文件README为README2</p>\n<blockquote>\n<p><code>git mv README README2</code></p>\n</blockquote>\n</li>\n<li><p>将当前版本重置为HEAD（通常用于merge失败回退）</p>\n<blockquote>\n<p><code>git reset --hard HEAD </code></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"暂存\"><a href=\"#暂存\" class=\"headerlink\" title=\"暂存\"></a>暂存</h2><ul>\n<li><p>暂存当前修改，将所有至为HEAD状态</p>\n<blockquote>\n<p><code>git stash </code></p>\n</blockquote>\n</li>\n<li><p> 查看所有暂存</p>\n<blockquote>\n<p><code>git stash list</code></p>\n</blockquote>\n</li>\n<li><p>恢复暂存文件</p>\n<blockquote>\n<p><code>git stash pop </code></p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"操作远程\"><a href=\"#操作远程\" class=\"headerlink\" title=\"操作远程\"></a>操作远程</h2><ul>\n<li><p>本地分支推送到远程仓库</p>\n<blockquote>\n<p><code>git push origin master </code></p>\n</blockquote>\n</li>\n<li><p>-u选项指定一个默认主机</p>\n<blockquote>\n<p><code>git push -u origin</code></p>\n</blockquote>\n</li>\n<li><p>不管是否存在对应的远程分支，将本地的所有分支都推送到远程主机</p>\n<blockquote>\n<p><code>git push --all origin </code></p>\n</blockquote>\n</li>\n</ul>\n"},{"title":"Markdown 语法","date":"2022-03-17T15:06:12.000Z","cover":"https://s3.bmp.ovh/imgs/2022/03/14585d705654707c.jpeg","_content":"## 前言\n &ensp; Markdown语法的基本使用\n## 目录\n\n![](https://s3.bmp.ovh/imgs/2022/03/5e25d102468382c1.jpg)\n\n## 简介\nMarkDown基础语法使用参考\n## 标题\n* 语法\n一级标题用一个#，二级标题## ....最多展示六级标题\n```\n    # 一级标题\n    ## 二级标题\n    ### 三级标题\n    #### 四级标题\n    ###### 五级标题\n    ####### 六级标题\n```\n\n* 效果\n # 一级标题\n ## 二级标题\n ### 三级标题\n #### 四级标题\n ##### 五级标题\n ###### 六级标题\n\n## 字体\n* 加粗\n  * 语法\n     要加粗的文本前后用两个 ** 符号包裹起来\n  * 效果\n     **我是加粗后的字体**\n\n* 斜体\n  * 语法\n     要倾斜的文本前后用一个 * 符号包裹起来\n  * 效果\n   *我是倾斜后的字体*\n\n* 斜体&加粗\n  *语法\n    要倾斜并且加粗的文本前后用三个 ***  符号包裹起来\n  *效果\n***我是倾斜并且加粗后的字体***\n\n* 删除线\n  * 语法\n     要加删除线的文本左右分别用两个 ~~ 符号包起来\n  * 效果\n  ~~我是添加删除线的字体~~\n\n## 段落\n* 空格\n  * 语法\n    ```\n      插入一个空格 &nbsp;   \n      插入两个空格 &ensp;  \n      插入四个空格 &emsp;   \n    ```\n或者使用全角空格。即：在全角输入状态下直接使用空格键就ok了\n  * 效果\n    &nbsp;   插入一个空格文本\n    &ensp;   插入两个空格文本\n    &emsp;   插入四个空格文本\n　　全角按了两个空格文本😎\n\n* 换行\n  * 语法\n    使用 HTML 的 `<br>` 标签来实现换行。\n  * 效果\n    我在这里需要换行啦<br>精彩内容在仍在继续...\n\n## 块引用\n* 单个段落块引用\n  * 语法\n    要创建单个段落块引用，请在段落前添加一个 > 符号。\n  * 效果\n    >我是单个段落引用\n\n* 多个段落块引用\n  * 语法\n     要创建单个段落块引用，请在段落前与段落之间添加 > 符号。\n  * 效果\n   >我是段落一\n   >\n   >我是段落二\n\n* 嵌套块引用\n * 语法\n    在要嵌套的段落前添加一个 >> 符号。\n * 效果\n >我是段落一\n   >\n   >>我是段落二并且需要嵌套引用\n  >>>\n  >>>>\n  >>>>>\n  >>>>>>\n  >>>>>>>无限嵌套引用...\n\n## 列表\n* 有序列表\n  * 语法\n     列表项前添加数字并紧跟一个英文句点 1. 2. 3. 等等 ...\n\n  * 效果\n  1.有序列表\n  2.有序列表\n  3.有序列表\n  ...\n* 无序列表\n为了兼容，请不要在同一个列表中混用不同的分隔符，最好选定一种分隔符使用\n  * 语法\n  无序列表用 - + * 任意一种都可以\n  * 效果\n    * 无序列表\n    * 无序列表\n    * 无序列表\n\n## 代码\n* 代码块高亮\n  * 语法\n\n  ```java\n    （```）java\n      这个写代码块\n      注意：（```）这个写法是防止符号被转义，正常写去掉（）只写 ``` 就好了\n    （```）\n  ```\n  * 效果\n```java\npublic class HelloWorld {\n   public static void main(String args[]) {\n        System.out.println(\"Hello World!\");\n     }\n}\n```\n* 单行代码块\n  * 语法\n  单行代码块使用 \\`  \\`包裹\n  * 效果\n     `  System.out.println(\"Hello World!\");  `\n\n## 图片\n* 语法\n  [图片上传中...(image-9df155-1642153968831)]\n  图片alt就是显示在图片下面的文字，相当于对图片内容的解释。\n* 效果\n![](https://s3.bmp.ovh/imgs/2022/03/3c7eea0313d87901.jpeg)\n\n## 分割线\n* 语法\n  为了兼容性，请在分隔线的前后均添加空白行\n  三个以上 --- 或 ***\n* 效果\n ---\n ---\n ***\n ***\n## 超链接\n* 语法\n要创建链接，请将链接文本括在方括号（例如 [Duck Duck Go]）中，后面紧跟着括在圆括号中的 URL（例如 (https://duckduckgo.com) ）。\n* 效果\nMy favorite search engine is [Duck Duck Go](https://duckduckgo.com).\n\n## 流程图\n因简书不支持流程图，可以参考：\nhttps://www.runoob.com/markdown/md-advance.html\n\n## 表格\n  * 语法\n```\n  | 表头 | 表头|\n  | --- | --- |\n  | 内容 | 内容 |\n  | 内容 | 内容 |\n```\n  * 效果\n     | 表头 | 表头 |\n     | --- | --- |\n     | 内容 | 内容 |\n     | 内容 | 内容 |\n* 对齐方式\n  * 语法\n```\n| 左对齐 | 右对齐 | 居中对齐 |\n| :-----| ----: | :----: |\n| 内容 | 内容 | 内容 |\n| 内容 | 内容 | 内容 |\n```\n  * 效果\n    | 左对齐 | 右对齐 | 居中对齐 |\n    | :-----| ----: | :----: |\n    | 内容 | 内容 | 内容 |\n    | 内容 | 内容 | 内容 |\n## 网址、电子邮件地址\n* 语法\n   将 URL 或电子邮件地址括在<>里\n* 效果\n<https://www.google.com.hk/>\n<test@gmail.com>\n\n## 转义字符\n以下列出的字符都可以通过使用反斜杠字符从而达到转义目的。\n字符|名称\n--|--\n| \\ | 反斜杠\n| * | 星号（asterisk） |\n| _ | 下划线（underscore） |\n| { } | 花括号（curly braces） |\n| [ ] | 方括号（brackets） |\n| < > | angle brackets |\n| ( ) | 圆括号或括号（parentheses） |\n| # | 井号（pound sign） |\n| + | 加号（plus sign） |\n| - | 减号（minus sign） (也叫连字符 hyphen) |\n| . | 句点（dot） |\n| ! | 感叹号（exclamation mark） |\n","source":"_posts/2022/Markdown/markdown-grammar.md","raw":"---\ntitle: Markdown 语法\ndate: 2022-03-17 23:06:12\ncategories:\n - Markdown\ntags:\n - Markdown\ncover: https://s3.bmp.ovh/imgs/2022/03/14585d705654707c.jpeg\n---\n## 前言\n &ensp; Markdown语法的基本使用\n## 目录\n\n![](https://s3.bmp.ovh/imgs/2022/03/5e25d102468382c1.jpg)\n\n## 简介\nMarkDown基础语法使用参考\n## 标题\n* 语法\n一级标题用一个#，二级标题## ....最多展示六级标题\n```\n    # 一级标题\n    ## 二级标题\n    ### 三级标题\n    #### 四级标题\n    ###### 五级标题\n    ####### 六级标题\n```\n\n* 效果\n # 一级标题\n ## 二级标题\n ### 三级标题\n #### 四级标题\n ##### 五级标题\n ###### 六级标题\n\n## 字体\n* 加粗\n  * 语法\n     要加粗的文本前后用两个 ** 符号包裹起来\n  * 效果\n     **我是加粗后的字体**\n\n* 斜体\n  * 语法\n     要倾斜的文本前后用一个 * 符号包裹起来\n  * 效果\n   *我是倾斜后的字体*\n\n* 斜体&加粗\n  *语法\n    要倾斜并且加粗的文本前后用三个 ***  符号包裹起来\n  *效果\n***我是倾斜并且加粗后的字体***\n\n* 删除线\n  * 语法\n     要加删除线的文本左右分别用两个 ~~ 符号包起来\n  * 效果\n  ~~我是添加删除线的字体~~\n\n## 段落\n* 空格\n  * 语法\n    ```\n      插入一个空格 &nbsp;   \n      插入两个空格 &ensp;  \n      插入四个空格 &emsp;   \n    ```\n或者使用全角空格。即：在全角输入状态下直接使用空格键就ok了\n  * 效果\n    &nbsp;   插入一个空格文本\n    &ensp;   插入两个空格文本\n    &emsp;   插入四个空格文本\n　　全角按了两个空格文本😎\n\n* 换行\n  * 语法\n    使用 HTML 的 `<br>` 标签来实现换行。\n  * 效果\n    我在这里需要换行啦<br>精彩内容在仍在继续...\n\n## 块引用\n* 单个段落块引用\n  * 语法\n    要创建单个段落块引用，请在段落前添加一个 > 符号。\n  * 效果\n    >我是单个段落引用\n\n* 多个段落块引用\n  * 语法\n     要创建单个段落块引用，请在段落前与段落之间添加 > 符号。\n  * 效果\n   >我是段落一\n   >\n   >我是段落二\n\n* 嵌套块引用\n * 语法\n    在要嵌套的段落前添加一个 >> 符号。\n * 效果\n >我是段落一\n   >\n   >>我是段落二并且需要嵌套引用\n  >>>\n  >>>>\n  >>>>>\n  >>>>>>\n  >>>>>>>无限嵌套引用...\n\n## 列表\n* 有序列表\n  * 语法\n     列表项前添加数字并紧跟一个英文句点 1. 2. 3. 等等 ...\n\n  * 效果\n  1.有序列表\n  2.有序列表\n  3.有序列表\n  ...\n* 无序列表\n为了兼容，请不要在同一个列表中混用不同的分隔符，最好选定一种分隔符使用\n  * 语法\n  无序列表用 - + * 任意一种都可以\n  * 效果\n    * 无序列表\n    * 无序列表\n    * 无序列表\n\n## 代码\n* 代码块高亮\n  * 语法\n\n  ```java\n    （```）java\n      这个写代码块\n      注意：（```）这个写法是防止符号被转义，正常写去掉（）只写 ``` 就好了\n    （```）\n  ```\n  * 效果\n```java\npublic class HelloWorld {\n   public static void main(String args[]) {\n        System.out.println(\"Hello World!\");\n     }\n}\n```\n* 单行代码块\n  * 语法\n  单行代码块使用 \\`  \\`包裹\n  * 效果\n     `  System.out.println(\"Hello World!\");  `\n\n## 图片\n* 语法\n  [图片上传中...(image-9df155-1642153968831)]\n  图片alt就是显示在图片下面的文字，相当于对图片内容的解释。\n* 效果\n![](https://s3.bmp.ovh/imgs/2022/03/3c7eea0313d87901.jpeg)\n\n## 分割线\n* 语法\n  为了兼容性，请在分隔线的前后均添加空白行\n  三个以上 --- 或 ***\n* 效果\n ---\n ---\n ***\n ***\n## 超链接\n* 语法\n要创建链接，请将链接文本括在方括号（例如 [Duck Duck Go]）中，后面紧跟着括在圆括号中的 URL（例如 (https://duckduckgo.com) ）。\n* 效果\nMy favorite search engine is [Duck Duck Go](https://duckduckgo.com).\n\n## 流程图\n因简书不支持流程图，可以参考：\nhttps://www.runoob.com/markdown/md-advance.html\n\n## 表格\n  * 语法\n```\n  | 表头 | 表头|\n  | --- | --- |\n  | 内容 | 内容 |\n  | 内容 | 内容 |\n```\n  * 效果\n     | 表头 | 表头 |\n     | --- | --- |\n     | 内容 | 内容 |\n     | 内容 | 内容 |\n* 对齐方式\n  * 语法\n```\n| 左对齐 | 右对齐 | 居中对齐 |\n| :-----| ----: | :----: |\n| 内容 | 内容 | 内容 |\n| 内容 | 内容 | 内容 |\n```\n  * 效果\n    | 左对齐 | 右对齐 | 居中对齐 |\n    | :-----| ----: | :----: |\n    | 内容 | 内容 | 内容 |\n    | 内容 | 内容 | 内容 |\n## 网址、电子邮件地址\n* 语法\n   将 URL 或电子邮件地址括在<>里\n* 效果\n<https://www.google.com.hk/>\n<test@gmail.com>\n\n## 转义字符\n以下列出的字符都可以通过使用反斜杠字符从而达到转义目的。\n字符|名称\n--|--\n| \\ | 反斜杠\n| * | 星号（asterisk） |\n| _ | 下划线（underscore） |\n| { } | 花括号（curly braces） |\n| [ ] | 方括号（brackets） |\n| < > | angle brackets |\n| ( ) | 圆括号或括号（parentheses） |\n| # | 井号（pound sign） |\n| + | 加号（plus sign） |\n| - | 减号（minus sign） (也叫连字符 hyphen) |\n| . | 句点（dot） |\n| ! | 感叹号（exclamation mark） |\n","slug":"markdown-grammar","published":1,"relaxed":"Markdown","updated":"2022-03-22T14:49:05.615Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl2vhlmfr0007t6fyb0m9cxtc","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p> &ensp; Markdown语法的基本使用</p>\n<h2 id=\"目录\"><a href=\"#目录\" class=\"headerlink\" title=\"目录\"></a>目录</h2><p><img src=\"https://s3.bmp.ovh/imgs/2022/03/5e25d102468382c1.jpg\"></p>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>MarkDown基础语法使用参考</p>\n<h2 id=\"标题\"><a href=\"#标题\" class=\"headerlink\" title=\"标题\"></a>标题</h2><ul>\n<li><p>语法<br>一级标题用一个#，二级标题## ….最多展示六级标题</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 一级标题</span><br><span class=\"line\">## 二级标题</span><br><span class=\"line\">### 三级标题</span><br><span class=\"line\">#### 四级标题</span><br><span class=\"line\">###### 五级标题</span><br><span class=\"line\">####### 六级标题</span><br></pre></td></tr></table></figure></li>\n<li><p>效果</p>\n<h1 id=\"一级标题\"><a href=\"#一级标题\" class=\"headerlink\" title=\"一级标题\"></a>一级标题</h1><h2 id=\"二级标题\"><a href=\"#二级标题\" class=\"headerlink\" title=\"二级标题\"></a>二级标题</h2><h3 id=\"三级标题\"><a href=\"#三级标题\" class=\"headerlink\" title=\"三级标题\"></a>三级标题</h3><h4 id=\"四级标题\"><a href=\"#四级标题\" class=\"headerlink\" title=\"四级标题\"></a>四级标题</h4><h5 id=\"五级标题\"><a href=\"#五级标题\" class=\"headerlink\" title=\"五级标题\"></a>五级标题</h5><h6 id=\"六级标题\"><a href=\"#六级标题\" class=\"headerlink\" title=\"六级标题\"></a>六级标题</h6></li>\n</ul>\n<h2 id=\"字体\"><a href=\"#字体\" class=\"headerlink\" title=\"字体\"></a>字体</h2><ul>\n<li><p>加粗</p>\n<ul>\n<li>语法<br> 要加粗的文本前后用两个 ** 符号包裹起来</li>\n<li>效果<br> <strong>我是加粗后的字体</strong></li>\n</ul>\n</li>\n<li><p>斜体</p>\n<ul>\n<li>语法<br> 要倾斜的文本前后用一个 * 符号包裹起来</li>\n<li>效果</li>\n<li>我是倾斜后的字体*</li>\n</ul>\n</li>\n<li><p>斜体&amp;加粗<br>*语法<br>  要倾斜并且加粗的文本前后用三个 ***  符号包裹起来<br>*效果</p>\n</li>\n<li><p><strong>我是倾斜并且加粗后的字体</strong>*</p>\n</li>\n<li><p>删除线</p>\n<ul>\n<li>语法<br> 要加删除线的文本左右分别用两个 ~~ 符号包起来</li>\n<li>效果<br><del>我是添加删除线的字体</del></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"段落\"><a href=\"#段落\" class=\"headerlink\" title=\"段落\"></a>段落</h2><ul>\n<li><p>空格</p>\n<ul>\n<li>语法<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">插入一个空格 &amp;nbsp;   </span><br><span class=\"line\">插入两个空格 &amp;ensp;  </span><br><span class=\"line\">插入四个空格 &amp;emsp;   </span><br></pre></td></tr></table></figure>\n或者使用全角空格。即：在全角输入状态下直接使用空格键就ok了</li>\n<li>效果<br>&nbsp;   插入一个空格文本<br>&ensp;   插入两个空格文本<br>&emsp;   插入四个空格文本<br>　　全角按了两个空格文本😎</li>\n</ul>\n</li>\n<li><p>换行</p>\n<ul>\n<li>语法<br>使用 HTML 的 <code>&lt;br&gt;</code> 标签来实现换行。</li>\n<li>效果<br>我在这里需要换行啦<br>精彩内容在仍在继续…</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"块引用\"><a href=\"#块引用\" class=\"headerlink\" title=\"块引用\"></a>块引用</h2><ul>\n<li><p>单个段落块引用</p>\n<ul>\n<li>语法<br>要创建单个段落块引用，请在段落前添加一个 &gt; 符号。</li>\n<li>效果<blockquote>\n<p>我是单个段落引用</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li><p>多个段落块引用</p>\n<ul>\n<li>语法<br> 要创建单个段落块引用，请在段落前与段落之间添加 &gt; 符号。</li>\n<li>效果<blockquote>\n<p>我是段落一</p>\n<p>我是段落二</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li><p>嵌套块引用</p>\n</li>\n<li><p>语法<br> 在要嵌套的段落前添加一个 &gt;&gt; 符号。</p>\n</li>\n<li><p>效果</p>\n<blockquote>\n<p>我是段落一</p>\n<blockquote>\n<p>我是段落二并且需要嵌套引用</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>无限嵌套引用…</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"列表\"><a href=\"#列表\" class=\"headerlink\" title=\"列表\"></a>列表</h2><ul>\n<li><p>有序列表</p>\n<ul>\n<li><p>语法<br> 列表项前添加数字并紧跟一个英文句点 1. 2. 3. 等等 …</p>\n</li>\n<li><p>效果</p>\n</li>\n</ul>\n<p>1.有序列表<br>2.有序列表<br>3.有序列表<br>…</p>\n</li>\n<li><p>无序列表<br>为了兼容，请不要在同一个列表中混用不同的分隔符，最好选定一种分隔符使用</p>\n<ul>\n<li>语法<br>无序列表用 - + * 任意一种都可以</li>\n<li>效果<ul>\n<li>无序列表</li>\n<li>无序列表</li>\n<li>无序列表</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><ul>\n<li><p>代码块高亮</p>\n<ul>\n<li>语法</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">（```）java</span><br><span class=\"line\">  这个写代码块</span><br><span class=\"line\">  注意：（```）这个写法是防止符号被转义，正常写去掉（）只写 ``` 就好了</span><br><span class=\"line\">（```）</span><br></pre></td></tr></table></figure>\n<ul>\n<li>效果<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HelloWorld</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Hello World!&quot;</span>);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>单行代码块</p>\n<ul>\n<li>语法<br>单行代码块使用 `  `包裹</li>\n<li>效果<br> <code> System.out.println(&quot;Hello World!&quot;); </code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"图片\"><a href=\"#图片\" class=\"headerlink\" title=\"图片\"></a>图片</h2><ul>\n<li>语法<br>[图片上传中…(image-9df155-1642153968831)]<br>图片alt就是显示在图片下面的文字，相当于对图片内容的解释。</li>\n<li>效果<br><img src=\"https://s3.bmp.ovh/imgs/2022/03/3c7eea0313d87901.jpeg\"></li>\n</ul>\n<h2 id=\"分割线\"><a href=\"#分割线\" class=\"headerlink\" title=\"分割线\"></a>分割线</h2><ul>\n<li>语法<br>为了兼容性，请在分隔线的前后均添加空白行<br>三个以上 — 或 ***</li>\n<li>效果</li>\n</ul>\n<hr>\n<hr>\n<hr>\n<hr>\n<h2 id=\"超链接\"><a href=\"#超链接\" class=\"headerlink\" title=\"超链接\"></a>超链接</h2><ul>\n<li>语法<br>要创建链接，请将链接文本括在方括号（例如 [Duck Duck Go]）中，后面紧跟着括在圆括号中的 URL（例如 (<a href=\"https://duckduckgo.com/\">https://duckduckgo.com</a>) ）。</li>\n<li>效果<br>My favorite search engine is <a href=\"https://duckduckgo.com/\">Duck Duck Go</a>.</li>\n</ul>\n<h2 id=\"流程图\"><a href=\"#流程图\" class=\"headerlink\" title=\"流程图\"></a>流程图</h2><p>因简书不支持流程图，可以参考：<br><a href=\"https://www.runoob.com/markdown/md-advance.html\">https://www.runoob.com/markdown/md-advance.html</a></p>\n<h2 id=\"表格\"><a href=\"#表格\" class=\"headerlink\" title=\"表格\"></a>表格</h2><ul>\n<li>语法<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">| 表头 | 表头|</span><br><span class=\"line\">| --- | --- |</span><br><span class=\"line\">| 内容 | 内容 |</span><br><span class=\"line\">| 内容 | 内容 |</span><br></pre></td></tr></table></figure></li>\n<li>效果<table>\n<thead>\n<tr>\n<th>表头</th>\n<th>表头</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>内容</td>\n<td>内容</td>\n</tr>\n<tr>\n<td>内容</td>\n<td>内容</td>\n</tr>\n</tbody></table>\n</li>\n<li>对齐方式<ul>\n<li>语法<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">| 左对齐 | 右对齐 | 居中对齐 |</span><br><span class=\"line\">| :-----| ----: | :----: |</span><br><span class=\"line\">| 内容 | 内容 | 内容 |</span><br><span class=\"line\">| 内容 | 内容 | 内容 |</span><br></pre></td></tr></table></figure></li>\n<li>效果<table>\n<thead>\n<tr>\n<th align=\"left\">左对齐</th>\n<th align=\"right\">右对齐</th>\n<th align=\"center\">居中对齐</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">内容</td>\n<td align=\"right\">内容</td>\n<td align=\"center\">内容</td>\n</tr>\n<tr>\n<td align=\"left\">内容</td>\n<td align=\"right\">内容</td>\n<td align=\"center\">内容</td>\n</tr>\n</tbody></table>\n<h2 id=\"网址、电子邮件地址\"><a href=\"#网址、电子邮件地址\" class=\"headerlink\" title=\"网址、电子邮件地址\"></a>网址、电子邮件地址</h2></li>\n</ul>\n</li>\n<li>语法<br> 将 URL 或电子邮件地址括在&lt;&gt;里</li>\n<li>效果<br><a href=\"https://www.google.com.hk/\">https://www.google.com.hk/</a><br><a href=\"mailto:&#x74;&#x65;&#x73;&#116;&#x40;&#x67;&#109;&#97;&#x69;&#108;&#46;&#99;&#x6f;&#x6d;\">&#x74;&#x65;&#x73;&#116;&#x40;&#x67;&#109;&#97;&#x69;&#108;&#46;&#99;&#x6f;&#x6d;</a></li>\n</ul>\n<h2 id=\"转义字符\"><a href=\"#转义字符\" class=\"headerlink\" title=\"转义字符\"></a>转义字符</h2><p>以下列出的字符都可以通过使用反斜杠字符从而达到转义目的。<br>字符|名称<br>–|–<br>| \\ | 反斜杠<br>| * | 星号（asterisk） |<br>| _ | 下划线（underscore） |<br>| { } | 花括号（curly braces） |<br>| [ ] | 方括号（brackets） |<br>| &lt; &gt; | angle brackets |<br>| ( ) | 圆括号或括号（parentheses） |<br>| # | 井号（pound sign） |<br>| + | 加号（plus sign） |<br>| - | 减号（minus sign） (也叫连字符 hyphen) |<br>| . | 句点（dot） |<br>| ! | 感叹号（exclamation mark） |</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p> &ensp; Markdown语法的基本使用</p>\n<h2 id=\"目录\"><a href=\"#目录\" class=\"headerlink\" title=\"目录\"></a>目录</h2><p><img src=\"https://s3.bmp.ovh/imgs/2022/03/5e25d102468382c1.jpg\"></p>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>MarkDown基础语法使用参考</p>\n<h2 id=\"标题\"><a href=\"#标题\" class=\"headerlink\" title=\"标题\"></a>标题</h2><ul>\n<li><p>语法<br>一级标题用一个#，二级标题## ….最多展示六级标题</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 一级标题</span><br><span class=\"line\">## 二级标题</span><br><span class=\"line\">### 三级标题</span><br><span class=\"line\">#### 四级标题</span><br><span class=\"line\">###### 五级标题</span><br><span class=\"line\">####### 六级标题</span><br></pre></td></tr></table></figure></li>\n<li><p>效果</p>\n<h1 id=\"一级标题\"><a href=\"#一级标题\" class=\"headerlink\" title=\"一级标题\"></a>一级标题</h1><h2 id=\"二级标题\"><a href=\"#二级标题\" class=\"headerlink\" title=\"二级标题\"></a>二级标题</h2><h3 id=\"三级标题\"><a href=\"#三级标题\" class=\"headerlink\" title=\"三级标题\"></a>三级标题</h3><h4 id=\"四级标题\"><a href=\"#四级标题\" class=\"headerlink\" title=\"四级标题\"></a>四级标题</h4><h5 id=\"五级标题\"><a href=\"#五级标题\" class=\"headerlink\" title=\"五级标题\"></a>五级标题</h5><h6 id=\"六级标题\"><a href=\"#六级标题\" class=\"headerlink\" title=\"六级标题\"></a>六级标题</h6></li>\n</ul>\n<h2 id=\"字体\"><a href=\"#字体\" class=\"headerlink\" title=\"字体\"></a>字体</h2><ul>\n<li><p>加粗</p>\n<ul>\n<li>语法<br> 要加粗的文本前后用两个 ** 符号包裹起来</li>\n<li>效果<br> <strong>我是加粗后的字体</strong></li>\n</ul>\n</li>\n<li><p>斜体</p>\n<ul>\n<li>语法<br> 要倾斜的文本前后用一个 * 符号包裹起来</li>\n<li>效果</li>\n<li>我是倾斜后的字体*</li>\n</ul>\n</li>\n<li><p>斜体&amp;加粗<br>*语法<br>  要倾斜并且加粗的文本前后用三个 ***  符号包裹起来<br>*效果</p>\n</li>\n<li><p><strong>我是倾斜并且加粗后的字体</strong>*</p>\n</li>\n<li><p>删除线</p>\n<ul>\n<li>语法<br> 要加删除线的文本左右分别用两个 ~~ 符号包起来</li>\n<li>效果<br><del>我是添加删除线的字体</del></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"段落\"><a href=\"#段落\" class=\"headerlink\" title=\"段落\"></a>段落</h2><ul>\n<li><p>空格</p>\n<ul>\n<li>语法<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">插入一个空格 &amp;nbsp;   </span><br><span class=\"line\">插入两个空格 &amp;ensp;  </span><br><span class=\"line\">插入四个空格 &amp;emsp;   </span><br></pre></td></tr></table></figure>\n或者使用全角空格。即：在全角输入状态下直接使用空格键就ok了</li>\n<li>效果<br>&nbsp;   插入一个空格文本<br>&ensp;   插入两个空格文本<br>&emsp;   插入四个空格文本<br>　　全角按了两个空格文本😎</li>\n</ul>\n</li>\n<li><p>换行</p>\n<ul>\n<li>语法<br>使用 HTML 的 <code>&lt;br&gt;</code> 标签来实现换行。</li>\n<li>效果<br>我在这里需要换行啦<br>精彩内容在仍在继续…</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"块引用\"><a href=\"#块引用\" class=\"headerlink\" title=\"块引用\"></a>块引用</h2><ul>\n<li><p>单个段落块引用</p>\n<ul>\n<li>语法<br>要创建单个段落块引用，请在段落前添加一个 &gt; 符号。</li>\n<li>效果<blockquote>\n<p>我是单个段落引用</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li><p>多个段落块引用</p>\n<ul>\n<li>语法<br> 要创建单个段落块引用，请在段落前与段落之间添加 &gt; 符号。</li>\n<li>效果<blockquote>\n<p>我是段落一</p>\n<p>我是段落二</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li><p>嵌套块引用</p>\n</li>\n<li><p>语法<br> 在要嵌套的段落前添加一个 &gt;&gt; 符号。</p>\n</li>\n<li><p>效果</p>\n<blockquote>\n<p>我是段落一</p>\n<blockquote>\n<p>我是段落二并且需要嵌套引用</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>无限嵌套引用…</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"列表\"><a href=\"#列表\" class=\"headerlink\" title=\"列表\"></a>列表</h2><ul>\n<li><p>有序列表</p>\n<ul>\n<li><p>语法<br> 列表项前添加数字并紧跟一个英文句点 1. 2. 3. 等等 …</p>\n</li>\n<li><p>效果</p>\n</li>\n</ul>\n<p>1.有序列表<br>2.有序列表<br>3.有序列表<br>…</p>\n</li>\n<li><p>无序列表<br>为了兼容，请不要在同一个列表中混用不同的分隔符，最好选定一种分隔符使用</p>\n<ul>\n<li>语法<br>无序列表用 - + * 任意一种都可以</li>\n<li>效果<ul>\n<li>无序列表</li>\n<li>无序列表</li>\n<li>无序列表</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><ul>\n<li><p>代码块高亮</p>\n<ul>\n<li>语法</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">（```）java</span><br><span class=\"line\">  这个写代码块</span><br><span class=\"line\">  注意：（```）这个写法是防止符号被转义，正常写去掉（）只写 ``` 就好了</span><br><span class=\"line\">（```）</span><br></pre></td></tr></table></figure>\n<ul>\n<li>效果<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HelloWorld</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Hello World!&quot;</span>);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>单行代码块</p>\n<ul>\n<li>语法<br>单行代码块使用 `  `包裹</li>\n<li>效果<br> <code> System.out.println(&quot;Hello World!&quot;); </code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"图片\"><a href=\"#图片\" class=\"headerlink\" title=\"图片\"></a>图片</h2><ul>\n<li>语法<br>[图片上传中…(image-9df155-1642153968831)]<br>图片alt就是显示在图片下面的文字，相当于对图片内容的解释。</li>\n<li>效果<br><img src=\"https://s3.bmp.ovh/imgs/2022/03/3c7eea0313d87901.jpeg\"></li>\n</ul>\n<h2 id=\"分割线\"><a href=\"#分割线\" class=\"headerlink\" title=\"分割线\"></a>分割线</h2><ul>\n<li>语法<br>为了兼容性，请在分隔线的前后均添加空白行<br>三个以上 — 或 ***</li>\n<li>效果</li>\n</ul>\n<hr>\n<hr>\n<hr>\n<hr>\n<h2 id=\"超链接\"><a href=\"#超链接\" class=\"headerlink\" title=\"超链接\"></a>超链接</h2><ul>\n<li>语法<br>要创建链接，请将链接文本括在方括号（例如 [Duck Duck Go]）中，后面紧跟着括在圆括号中的 URL（例如 (<a href=\"https://duckduckgo.com/\">https://duckduckgo.com</a>) ）。</li>\n<li>效果<br>My favorite search engine is <a href=\"https://duckduckgo.com/\">Duck Duck Go</a>.</li>\n</ul>\n<h2 id=\"流程图\"><a href=\"#流程图\" class=\"headerlink\" title=\"流程图\"></a>流程图</h2><p>因简书不支持流程图，可以参考：<br><a href=\"https://www.runoob.com/markdown/md-advance.html\">https://www.runoob.com/markdown/md-advance.html</a></p>\n<h2 id=\"表格\"><a href=\"#表格\" class=\"headerlink\" title=\"表格\"></a>表格</h2><ul>\n<li>语法<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">| 表头 | 表头|</span><br><span class=\"line\">| --- | --- |</span><br><span class=\"line\">| 内容 | 内容 |</span><br><span class=\"line\">| 内容 | 内容 |</span><br></pre></td></tr></table></figure></li>\n<li>效果<table>\n<thead>\n<tr>\n<th>表头</th>\n<th>表头</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>内容</td>\n<td>内容</td>\n</tr>\n<tr>\n<td>内容</td>\n<td>内容</td>\n</tr>\n</tbody></table>\n</li>\n<li>对齐方式<ul>\n<li>语法<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">| 左对齐 | 右对齐 | 居中对齐 |</span><br><span class=\"line\">| :-----| ----: | :----: |</span><br><span class=\"line\">| 内容 | 内容 | 内容 |</span><br><span class=\"line\">| 内容 | 内容 | 内容 |</span><br></pre></td></tr></table></figure></li>\n<li>效果<table>\n<thead>\n<tr>\n<th align=\"left\">左对齐</th>\n<th align=\"right\">右对齐</th>\n<th align=\"center\">居中对齐</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">内容</td>\n<td align=\"right\">内容</td>\n<td align=\"center\">内容</td>\n</tr>\n<tr>\n<td align=\"left\">内容</td>\n<td align=\"right\">内容</td>\n<td align=\"center\">内容</td>\n</tr>\n</tbody></table>\n<h2 id=\"网址、电子邮件地址\"><a href=\"#网址、电子邮件地址\" class=\"headerlink\" title=\"网址、电子邮件地址\"></a>网址、电子邮件地址</h2></li>\n</ul>\n</li>\n<li>语法<br> 将 URL 或电子邮件地址括在&lt;&gt;里</li>\n<li>效果<br><a href=\"https://www.google.com.hk/\">https://www.google.com.hk/</a><br><a href=\"mailto:&#x74;&#x65;&#x73;&#116;&#x40;&#x67;&#109;&#97;&#x69;&#108;&#46;&#99;&#x6f;&#x6d;\">&#x74;&#x65;&#x73;&#116;&#x40;&#x67;&#109;&#97;&#x69;&#108;&#46;&#99;&#x6f;&#x6d;</a></li>\n</ul>\n<h2 id=\"转义字符\"><a href=\"#转义字符\" class=\"headerlink\" title=\"转义字符\"></a>转义字符</h2><p>以下列出的字符都可以通过使用反斜杠字符从而达到转义目的。<br>字符|名称<br>–|–<br>| \\ | 反斜杠<br>| * | 星号（asterisk） |<br>| _ | 下划线（underscore） |<br>| { } | 花括号（curly braces） |<br>| [ ] | 方括号（brackets） |<br>| &lt; &gt; | angle brackets |<br>| ( ) | 圆括号或括号（parentheses） |<br>| # | 井号（pound sign） |<br>| + | 加号（plus sign） |<br>| - | 减号（minus sign） (也叫连字符 hyphen) |<br>| . | 句点（dot） |<br>| ! | 感叹号（exclamation mark） |</p>\n"},{"title":"Handler-内存泄漏解决方案","date":"2022-05-04T07:50:46.000Z","cover":"https://s1.ax1x.com/2022/05/04/OE3oQJ.jpg","_content":"\n# 前言\n  * Android开发中，内存泄漏是经常发生的，今天来详细聊一聊Handler使用过程中产生内存泄漏的场景以及对应的解决方案。\n\n# 目录\n[![OEUUXD.png](https://s1.ax1x.com/2022/05/04/OEUUXD.png)](https://s1.ax1x.com/2022/05/04/OEUUXD.png)\n\n# 问题描述\n* Android中使用Handler导致内存泄漏原因分析。当一个对象已经不再被使用时，本该被回收但却因为有另外一个正在使用的对象持有它的引用从而导致它不能被回收，导致了内存泄漏。\n\n# 原因详解\n* 在Handler消息队列还有未处理的消息 / 正在处理消息时，消息队列中的Message持有Handler实例的引用，由于Handler = 非静态内部类 & 匿名内部类又默认持有外部类的引用。如图\n\n[![示例1.png](https://s1.ax1x.com/2022/05/04/OE88YT.png)](https://s1.ax1x.com/2022/05/04/OE88YT.png)\n\n# 解决方案\n* 静态内部类+弱引用\n* 静态内部类 不默认持有外部类的引用，从而使得 “未被处理&正处理的消息 -> Handler实例 -> 外部类”的引用关系不复存在。\n* 使用WeakReference弱引用持有Activity实例的原因：弱引用的对象拥有短暂的生命周期。在垃圾回收器线程扫描时，一旦发现了只具有弱引用的对象，不管当前内存空间足够与否，都会回收它的内存\n\n* 工具类封装\n``` java\npackage com.linked.business.handler;\n\nimport android.os.Handler;\nimport android.os.Looper;\nimport android.os.Message;\n\nimport java.lang.ref.WeakReference;\n\npublic class ArrestLeakHandler extends Handler {\n    private final WeakReference<MessageHandler> reference;\n\n    public ArrestLeakHandler(MessageHandler messageHandler) {\n        reference = new WeakReference<>(messageHandler);\n    }\n\n    public ArrestLeakHandler(MessageHandler messageHandler, Looper looper) {\n        super(looper);\n        reference = new WeakReference<>(messageHandler);\n    }\n\n    /**\n     * 复写handlerMessage 做更新UI的操作\n     */\n    @Override\n    public void handleMessage(Message msg) {\n        MessageHandler messageHandler = reference.get();\n        if (messageHandler != null) {\n            messageHandler.handleMessage(msg);\n        }\n    }\n\n    public interface MessageHandler {\n        void handleMessage(Message msg);\n    }\n}\n\n```\n* 具体 java\n```java\n\npublic class HandlerLeakActivity extends BaseActivity<ActivtyHandlerLeakBinding, BasePresenter> implements ArrestLeakHandler.MessageHandler {\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        initViews();\n        initHandler();\n    }\n\n    @Override\n    protected void initViews() {\n        //发送消息A\n        vBinding.tvA.setOnClickListener(view -> {\n            Message msg = new Message();\n            msg.obj = \"我是消息A\";\n            msg.what = 1;\n            mHandler.sendMessage(msg);\n        });\n\n        //发送消息B\n        vBinding.tvB.setOnClickListener(view -> {\n            Message msg = new Message();\n            msg.obj = \"我是消息B\";\n            msg.what = 2;\n            mHandler.sendMessage(msg);\n        });\n    }\n\n    @Override\n    protected BasePresenter initPresenter() {\n        return null;\n    }\n\n    @Override\n    public void onBackPressed() {\n        super.onBackPressed();\n        finish();\n    }\n\n    static ArrestLeakHandler mHandler, mMainHandler;\n    HandlerThread mHandlerThread;\n\n    private void initHandler() {\n        //①创建子线程\n        mHandlerThread = new HandlerThread(\"handlerThread\");\n        //②开启线程\n        mHandlerThread.start();\n        //③建立与主线程关联Handler\n        mMainHandler = new ArrestLeakHandler(this);\n        mHandler = new ArrestLeakHandler(this, mHandlerThread.getLooper());\n    }\n\n    @Override\n    public void handleMessage(Message msg) {\n        switch (msg.what) {\n            case 1:\n            case 2:\n                String str = (String) msg.obj;\n                try {\n                    Thread.sleep(1500);\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n                LogUtils.v(\"Handler Message--->\" + str);\n                mMainHandler.post(() -> vBinding.tvShowMessage.setText(str));\n                break;\n            default:\n                break;\n        }\n    }\n\n    @Override\n    protected void onDestroy() {\n        super.onDestroy();\n        mHandler.removeCallbacksAndMessages(null);\n        mHandler = null;\n    }\n}\n\n```\n* 注:当外部类（Activity为例）结束生命周期时（onDestroy），应当清除Handler消息队列里的所有消息（调用removeCallbacksAndMessages(null)）方法。\n```java\n@Override\n    protected void onDestroy() {\n        super.onDestroy();\n        mHandler.removeCallbacksAndMessages(null);\n        mHandler = null;\n    }\n```\n# 总结\n* 当Handler消息队列中存在未处理或正在处理的消息时，并且存在引用关系:未被处理&正处理的消息->Handler实例->外部类\n  当Handler的生命周期>外部类的生命周期时（当外部类需销毁时(Handler消息队列中还有未处理或正在处理消息)),将使得外部类无法被垃圾回收器(GC)回收，既造成内存泄露。\n\n### <font color=#9dc2af>如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻</font>\n","source":"_posts/2022/android/Handler-内存泄漏解决方案.md","raw":"---\ntitle: Handler-内存泄漏解决方案\ndate: 2022-05-04 15:50:46\ncategories:\n - Android\ntags:\n - Handler\ncover: https://s1.ax1x.com/2022/05/04/OE3oQJ.jpg\n---\n\n# 前言\n  * Android开发中，内存泄漏是经常发生的，今天来详细聊一聊Handler使用过程中产生内存泄漏的场景以及对应的解决方案。\n\n# 目录\n[![OEUUXD.png](https://s1.ax1x.com/2022/05/04/OEUUXD.png)](https://s1.ax1x.com/2022/05/04/OEUUXD.png)\n\n# 问题描述\n* Android中使用Handler导致内存泄漏原因分析。当一个对象已经不再被使用时，本该被回收但却因为有另外一个正在使用的对象持有它的引用从而导致它不能被回收，导致了内存泄漏。\n\n# 原因详解\n* 在Handler消息队列还有未处理的消息 / 正在处理消息时，消息队列中的Message持有Handler实例的引用，由于Handler = 非静态内部类 & 匿名内部类又默认持有外部类的引用。如图\n\n[![示例1.png](https://s1.ax1x.com/2022/05/04/OE88YT.png)](https://s1.ax1x.com/2022/05/04/OE88YT.png)\n\n# 解决方案\n* 静态内部类+弱引用\n* 静态内部类 不默认持有外部类的引用，从而使得 “未被处理&正处理的消息 -> Handler实例 -> 外部类”的引用关系不复存在。\n* 使用WeakReference弱引用持有Activity实例的原因：弱引用的对象拥有短暂的生命周期。在垃圾回收器线程扫描时，一旦发现了只具有弱引用的对象，不管当前内存空间足够与否，都会回收它的内存\n\n* 工具类封装\n``` java\npackage com.linked.business.handler;\n\nimport android.os.Handler;\nimport android.os.Looper;\nimport android.os.Message;\n\nimport java.lang.ref.WeakReference;\n\npublic class ArrestLeakHandler extends Handler {\n    private final WeakReference<MessageHandler> reference;\n\n    public ArrestLeakHandler(MessageHandler messageHandler) {\n        reference = new WeakReference<>(messageHandler);\n    }\n\n    public ArrestLeakHandler(MessageHandler messageHandler, Looper looper) {\n        super(looper);\n        reference = new WeakReference<>(messageHandler);\n    }\n\n    /**\n     * 复写handlerMessage 做更新UI的操作\n     */\n    @Override\n    public void handleMessage(Message msg) {\n        MessageHandler messageHandler = reference.get();\n        if (messageHandler != null) {\n            messageHandler.handleMessage(msg);\n        }\n    }\n\n    public interface MessageHandler {\n        void handleMessage(Message msg);\n    }\n}\n\n```\n* 具体 java\n```java\n\npublic class HandlerLeakActivity extends BaseActivity<ActivtyHandlerLeakBinding, BasePresenter> implements ArrestLeakHandler.MessageHandler {\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        initViews();\n        initHandler();\n    }\n\n    @Override\n    protected void initViews() {\n        //发送消息A\n        vBinding.tvA.setOnClickListener(view -> {\n            Message msg = new Message();\n            msg.obj = \"我是消息A\";\n            msg.what = 1;\n            mHandler.sendMessage(msg);\n        });\n\n        //发送消息B\n        vBinding.tvB.setOnClickListener(view -> {\n            Message msg = new Message();\n            msg.obj = \"我是消息B\";\n            msg.what = 2;\n            mHandler.sendMessage(msg);\n        });\n    }\n\n    @Override\n    protected BasePresenter initPresenter() {\n        return null;\n    }\n\n    @Override\n    public void onBackPressed() {\n        super.onBackPressed();\n        finish();\n    }\n\n    static ArrestLeakHandler mHandler, mMainHandler;\n    HandlerThread mHandlerThread;\n\n    private void initHandler() {\n        //①创建子线程\n        mHandlerThread = new HandlerThread(\"handlerThread\");\n        //②开启线程\n        mHandlerThread.start();\n        //③建立与主线程关联Handler\n        mMainHandler = new ArrestLeakHandler(this);\n        mHandler = new ArrestLeakHandler(this, mHandlerThread.getLooper());\n    }\n\n    @Override\n    public void handleMessage(Message msg) {\n        switch (msg.what) {\n            case 1:\n            case 2:\n                String str = (String) msg.obj;\n                try {\n                    Thread.sleep(1500);\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n                LogUtils.v(\"Handler Message--->\" + str);\n                mMainHandler.post(() -> vBinding.tvShowMessage.setText(str));\n                break;\n            default:\n                break;\n        }\n    }\n\n    @Override\n    protected void onDestroy() {\n        super.onDestroy();\n        mHandler.removeCallbacksAndMessages(null);\n        mHandler = null;\n    }\n}\n\n```\n* 注:当外部类（Activity为例）结束生命周期时（onDestroy），应当清除Handler消息队列里的所有消息（调用removeCallbacksAndMessages(null)）方法。\n```java\n@Override\n    protected void onDestroy() {\n        super.onDestroy();\n        mHandler.removeCallbacksAndMessages(null);\n        mHandler = null;\n    }\n```\n# 总结\n* 当Handler消息队列中存在未处理或正在处理的消息时，并且存在引用关系:未被处理&正处理的消息->Handler实例->外部类\n  当Handler的生命周期>外部类的生命周期时（当外部类需销毁时(Handler消息队列中还有未处理或正在处理消息)),将使得外部类无法被垃圾回收器(GC)回收，既造成内存泄露。\n\n### <font color=#9dc2af>如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻</font>\n","slug":"Handler-内存泄漏解决方案","published":1,"relaxed":"android","updated":"2022-05-05T06:05:33.485Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl2vhlmfs0009t6fy0vjt6joq","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><ul>\n<li>Android开发中，内存泄漏是经常发生的，今天来详细聊一聊Handler使用过程中产生内存泄漏的场景以及对应的解决方案。</li>\n</ul>\n<h1 id=\"目录\"><a href=\"#目录\" class=\"headerlink\" title=\"目录\"></a>目录</h1><p><a href=\"https://s1.ax1x.com/2022/05/04/OEUUXD.png\"><img src=\"https://s1.ax1x.com/2022/05/04/OEUUXD.png\" alt=\"OEUUXD.png\"></a></p>\n<h1 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h1><ul>\n<li>Android中使用Handler导致内存泄漏原因分析。当一个对象已经不再被使用时，本该被回收但却因为有另外一个正在使用的对象持有它的引用从而导致它不能被回收，导致了内存泄漏。</li>\n</ul>\n<h1 id=\"原因详解\"><a href=\"#原因详解\" class=\"headerlink\" title=\"原因详解\"></a>原因详解</h1><ul>\n<li>在Handler消息队列还有未处理的消息 / 正在处理消息时，消息队列中的Message持有Handler实例的引用，由于Handler = 非静态内部类 &amp; 匿名内部类又默认持有外部类的引用。如图</li>\n</ul>\n<p><a href=\"https://s1.ax1x.com/2022/05/04/OE88YT.png\"><img src=\"https://s1.ax1x.com/2022/05/04/OE88YT.png\" alt=\"示例1.png\"></a></p>\n<h1 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h1><ul>\n<li><p>静态内部类+弱引用</p>\n</li>\n<li><p>静态内部类 不默认持有外部类的引用，从而使得 “未被处理&amp;正处理的消息 -&gt; Handler实例 -&gt; 外部类”的引用关系不复存在。</p>\n</li>\n<li><p>使用WeakReference弱引用持有Activity实例的原因：弱引用的对象拥有短暂的生命周期。在垃圾回收器线程扫描时，一旦发现了只具有弱引用的对象，不管当前内存空间足够与否，都会回收它的内存</p>\n</li>\n<li><p>工具类封装</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.linked.business.handler;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> android.os.Handler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.os.Looper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.os.Message;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.ref.WeakReference;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ArrestLeakHandler</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Handler</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> WeakReference&lt;MessageHandler&gt; reference;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ArrestLeakHandler</span><span class=\"params\">(MessageHandler messageHandler)</span> &#123;</span><br><span class=\"line\">        reference = <span class=\"keyword\">new</span> <span class=\"title class_\">WeakReference</span>&lt;&gt;(messageHandler);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ArrestLeakHandler</span><span class=\"params\">(MessageHandler messageHandler, Looper looper)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(looper);</span><br><span class=\"line\">        reference = <span class=\"keyword\">new</span> <span class=\"title class_\">WeakReference</span>&lt;&gt;(messageHandler);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 复写handlerMessage 做更新UI的操作</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleMessage</span><span class=\"params\">(Message msg)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">MessageHandler</span> <span class=\"variable\">messageHandler</span> <span class=\"operator\">=</span> reference.get();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (messageHandler != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            messageHandler.handleMessage(msg);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">MessageHandler</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">void</span> <span class=\"title function_\">handleMessage</span><span class=\"params\">(Message msg)</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n<li><p>具体 java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HandlerLeakActivity</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">BaseActivity</span>&lt;ActivtyHandlerLeakBinding, BasePresenter&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">ArrestLeakHandler</span>.MessageHandler &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onCreate</span><span class=\"params\">(<span class=\"meta\">@Nullable</span> Bundle savedInstanceState)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>.onCreate(savedInstanceState);</span><br><span class=\"line\">        initViews();</span><br><span class=\"line\">        initHandler();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">initViews</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//发送消息A</span></span><br><span class=\"line\">        vBinding.tvA.setOnClickListener(view -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">Message</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Message</span>();</span><br><span class=\"line\">            msg.obj = <span class=\"string\">&quot;我是消息A&quot;</span>;</span><br><span class=\"line\">            msg.what = <span class=\"number\">1</span>;</span><br><span class=\"line\">            mHandler.sendMessage(msg);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//发送消息B</span></span><br><span class=\"line\">        vBinding.tvB.setOnClickListener(view -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">Message</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Message</span>();</span><br><span class=\"line\">            msg.obj = <span class=\"string\">&quot;我是消息B&quot;</span>;</span><br><span class=\"line\">            msg.what = <span class=\"number\">2</span>;</span><br><span class=\"line\">            mHandler.sendMessage(msg);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> BasePresenter <span class=\"title function_\">initPresenter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onBackPressed</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>.onBackPressed();</span><br><span class=\"line\">        finish();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> ArrestLeakHandler mHandler, mMainHandler;</span><br><span class=\"line\">    HandlerThread mHandlerThread;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">initHandler</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//①创建子线程</span></span><br><span class=\"line\">        mHandlerThread = <span class=\"keyword\">new</span> <span class=\"title class_\">HandlerThread</span>(<span class=\"string\">&quot;handlerThread&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//②开启线程</span></span><br><span class=\"line\">        mHandlerThread.start();</span><br><span class=\"line\">        <span class=\"comment\">//③建立与主线程关联Handler</span></span><br><span class=\"line\">        mMainHandler = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrestLeakHandler</span>(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        mHandler = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrestLeakHandler</span>(<span class=\"built_in\">this</span>, mHandlerThread.getLooper());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleMessage</span><span class=\"params\">(Message msg)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (msg.what) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> (String) msg.obj;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    Thread.sleep(<span class=\"number\">1500</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                LogUtils.v(<span class=\"string\">&quot;Handler Message---&gt;&quot;</span> + str);</span><br><span class=\"line\">                mMainHandler.post(() -&gt; vBinding.tvShowMessage.setText(str));</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onDestroy</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>.onDestroy();</span><br><span class=\"line\">        mHandler.removeCallbacksAndMessages(<span class=\"literal\">null</span>);</span><br><span class=\"line\">        mHandler = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n<li><p>注:当外部类（Activity为例）结束生命周期时（onDestroy），应当清除Handler消息队列里的所有消息（调用removeCallbacksAndMessages(null)）方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onDestroy</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>.onDestroy();</span><br><span class=\"line\">        mHandler.removeCallbacksAndMessages(<span class=\"literal\">null</span>);</span><br><span class=\"line\">        mHandler = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1></li>\n<li><p>当Handler消息队列中存在未处理或正在处理的消息时，并且存在引用关系:未被处理&amp;正处理的消息-&gt;Handler实例-&gt;外部类<br>当Handler的生命周期&gt;外部类的生命周期时（当外部类需销毁时(Handler消息队列中还有未处理或正在处理消息)),将使得外部类无法被垃圾回收器(GC)回收，既造成内存泄露。</p>\n</li>\n</ul>\n<h3 id=\"如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻\"><a href=\"#如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻\" class=\"headerlink\" title=\"如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻\"></a><font color=#9dc2af>如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻</font></h3>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><ul>\n<li>Android开发中，内存泄漏是经常发生的，今天来详细聊一聊Handler使用过程中产生内存泄漏的场景以及对应的解决方案。</li>\n</ul>\n<h1 id=\"目录\"><a href=\"#目录\" class=\"headerlink\" title=\"目录\"></a>目录</h1><p><a href=\"https://s1.ax1x.com/2022/05/04/OEUUXD.png\"><img src=\"https://s1.ax1x.com/2022/05/04/OEUUXD.png\" alt=\"OEUUXD.png\"></a></p>\n<h1 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h1><ul>\n<li>Android中使用Handler导致内存泄漏原因分析。当一个对象已经不再被使用时，本该被回收但却因为有另外一个正在使用的对象持有它的引用从而导致它不能被回收，导致了内存泄漏。</li>\n</ul>\n<h1 id=\"原因详解\"><a href=\"#原因详解\" class=\"headerlink\" title=\"原因详解\"></a>原因详解</h1><ul>\n<li>在Handler消息队列还有未处理的消息 / 正在处理消息时，消息队列中的Message持有Handler实例的引用，由于Handler = 非静态内部类 &amp; 匿名内部类又默认持有外部类的引用。如图</li>\n</ul>\n<p><a href=\"https://s1.ax1x.com/2022/05/04/OE88YT.png\"><img src=\"https://s1.ax1x.com/2022/05/04/OE88YT.png\" alt=\"示例1.png\"></a></p>\n<h1 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h1><ul>\n<li><p>静态内部类+弱引用</p>\n</li>\n<li><p>静态内部类 不默认持有外部类的引用，从而使得 “未被处理&amp;正处理的消息 -&gt; Handler实例 -&gt; 外部类”的引用关系不复存在。</p>\n</li>\n<li><p>使用WeakReference弱引用持有Activity实例的原因：弱引用的对象拥有短暂的生命周期。在垃圾回收器线程扫描时，一旦发现了只具有弱引用的对象，不管当前内存空间足够与否，都会回收它的内存</p>\n</li>\n<li><p>工具类封装</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.linked.business.handler;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> android.os.Handler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.os.Looper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.os.Message;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.ref.WeakReference;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ArrestLeakHandler</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Handler</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> WeakReference&lt;MessageHandler&gt; reference;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ArrestLeakHandler</span><span class=\"params\">(MessageHandler messageHandler)</span> &#123;</span><br><span class=\"line\">        reference = <span class=\"keyword\">new</span> <span class=\"title class_\">WeakReference</span>&lt;&gt;(messageHandler);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ArrestLeakHandler</span><span class=\"params\">(MessageHandler messageHandler, Looper looper)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(looper);</span><br><span class=\"line\">        reference = <span class=\"keyword\">new</span> <span class=\"title class_\">WeakReference</span>&lt;&gt;(messageHandler);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 复写handlerMessage 做更新UI的操作</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleMessage</span><span class=\"params\">(Message msg)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">MessageHandler</span> <span class=\"variable\">messageHandler</span> <span class=\"operator\">=</span> reference.get();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (messageHandler != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            messageHandler.handleMessage(msg);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">MessageHandler</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">void</span> <span class=\"title function_\">handleMessage</span><span class=\"params\">(Message msg)</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n<li><p>具体 java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HandlerLeakActivity</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">BaseActivity</span>&lt;ActivtyHandlerLeakBinding, BasePresenter&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">ArrestLeakHandler</span>.MessageHandler &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onCreate</span><span class=\"params\">(<span class=\"meta\">@Nullable</span> Bundle savedInstanceState)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>.onCreate(savedInstanceState);</span><br><span class=\"line\">        initViews();</span><br><span class=\"line\">        initHandler();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">initViews</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//发送消息A</span></span><br><span class=\"line\">        vBinding.tvA.setOnClickListener(view -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">Message</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Message</span>();</span><br><span class=\"line\">            msg.obj = <span class=\"string\">&quot;我是消息A&quot;</span>;</span><br><span class=\"line\">            msg.what = <span class=\"number\">1</span>;</span><br><span class=\"line\">            mHandler.sendMessage(msg);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//发送消息B</span></span><br><span class=\"line\">        vBinding.tvB.setOnClickListener(view -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">Message</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Message</span>();</span><br><span class=\"line\">            msg.obj = <span class=\"string\">&quot;我是消息B&quot;</span>;</span><br><span class=\"line\">            msg.what = <span class=\"number\">2</span>;</span><br><span class=\"line\">            mHandler.sendMessage(msg);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> BasePresenter <span class=\"title function_\">initPresenter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onBackPressed</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>.onBackPressed();</span><br><span class=\"line\">        finish();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> ArrestLeakHandler mHandler, mMainHandler;</span><br><span class=\"line\">    HandlerThread mHandlerThread;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">initHandler</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//①创建子线程</span></span><br><span class=\"line\">        mHandlerThread = <span class=\"keyword\">new</span> <span class=\"title class_\">HandlerThread</span>(<span class=\"string\">&quot;handlerThread&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//②开启线程</span></span><br><span class=\"line\">        mHandlerThread.start();</span><br><span class=\"line\">        <span class=\"comment\">//③建立与主线程关联Handler</span></span><br><span class=\"line\">        mMainHandler = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrestLeakHandler</span>(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        mHandler = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrestLeakHandler</span>(<span class=\"built_in\">this</span>, mHandlerThread.getLooper());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleMessage</span><span class=\"params\">(Message msg)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (msg.what) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> (String) msg.obj;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    Thread.sleep(<span class=\"number\">1500</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                LogUtils.v(<span class=\"string\">&quot;Handler Message---&gt;&quot;</span> + str);</span><br><span class=\"line\">                mMainHandler.post(() -&gt; vBinding.tvShowMessage.setText(str));</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onDestroy</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>.onDestroy();</span><br><span class=\"line\">        mHandler.removeCallbacksAndMessages(<span class=\"literal\">null</span>);</span><br><span class=\"line\">        mHandler = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n<li><p>注:当外部类（Activity为例）结束生命周期时（onDestroy），应当清除Handler消息队列里的所有消息（调用removeCallbacksAndMessages(null)）方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onDestroy</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>.onDestroy();</span><br><span class=\"line\">        mHandler.removeCallbacksAndMessages(<span class=\"literal\">null</span>);</span><br><span class=\"line\">        mHandler = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1></li>\n<li><p>当Handler消息队列中存在未处理或正在处理的消息时，并且存在引用关系:未被处理&amp;正处理的消息-&gt;Handler实例-&gt;外部类<br>当Handler的生命周期&gt;外部类的生命周期时（当外部类需销毁时(Handler消息队列中还有未处理或正在处理消息)),将使得外部类无法被垃圾回收器(GC)回收，既造成内存泄露。</p>\n</li>\n</ul>\n<h3 id=\"如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻\"><a href=\"#如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻\" class=\"headerlink\" title=\"如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻\"></a><font color=#9dc2af>如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻</font></h3>"},{"title":"Glide-缓存那些事儿","date":"2022-03-23T15:29:41.000Z","cover":"https://s1.ax1x.com/2022/03/23/q3s3Oe.jpg","_content":"\n# 前言：\n &ensp;在我们开发的时候对图片加载是必须使用的 这篇文章我们就聊聊Glide缓存。\n\n## Glide 缓存分几种\n答：缓存分为两种：内存缓存、磁盘缓存\n\n内存缓存：\n内存缓存又分为两种：一种是：弱引用缓存、一种是： Lrucache缓存。\n往下看Glide内存缓存是如何实现的，源码如下：\n```java\npublic <R> LoadStatus load(\n      GlideContext glideContext,\n      Object model,\n      Key signature,\n      int width,\n      int height,\n      Class<?> resourceClass,\n      Class<R> transcodeClass,\n      Priority priority,\n      DiskCacheStrategy diskCacheStrategy,\n      Map<Class<?>, Transformation<?>> transformations,\n      boolean isTransformationRequired,\n      boolean isScaleOnlyOrNoTransform,\n      Options options,\n      boolean isMemoryCacheable,\n      boolean useUnlimitedSourceExecutorPool,\n      boolean useAnimationPool,\n      boolean onlyRetrieveFromCache,\n      ResourceCallback cb,\n      Executor callbackExecutor) {\n    long startTime = VERBOSE_IS_LOGGABLE ? LogTime.getLogTime() : 0;\n\n    // 生成key\n    EngineKey key =\n        keyFactory.buildKey(\n            model,\n            signature,\n            width,\n            height,\n            transformations,\n            resourceClass,\n            transcodeClass,\n            options);\n\n    EngineResource<?> memoryResource;\n    synchronized (this) {\n    //进到loadFromMemory方法里面看看做了什么\n      memoryResource = loadFromMemory(key, isMemoryCacheable, startTime);\n\n     ...\n\n @Nullable\n  private EngineResource<?> loadFromMemory(\n      EngineKey key, boolean isMemoryCacheable, long startTime) {\n    if (!isMemoryCacheable) {\n      return null;\n    }\n\n  // 弱引用\n    EngineResource<?> active = loadFromActiveResources(key);\n    if (active != null) {\n      if (VERBOSE_IS_LOGGABLE) {\n        logWithTimeAndKey(\"Loaded resource from active resources\", startTime, key);\n      }\n      return active;\n    }\n\n   // LruCaChe\n    EngineResource<?> cached = loadFromCache(key);\n    if (cached != null) {\n      if (VERBOSE_IS_LOGGABLE) {\n        logWithTimeAndKey(\"Loaded resource from cache\", startTime, key);\n      }\n      return cached;\n    }\n\n  // 如果返回null ，从网络或其它地方获取\n    return null;\n  }\n\n```\n可以看到，Engine类中load方法图片加载策略，其中生成key的参数中包含width 、height\n ```java\n  EngineKey key = keyFactory.buildKey(model, signature, width, height, transformations,\n        resourceClass, transcodeClass, options);\n ```\n*  width  & height 就是ImageView的尺寸，生成key时为什么会传入ImageView的尺寸呢？\n* 注：Glide 通过key读取缓存图片时，会校验当前的图片尺寸是否与imageView的尺寸相等，如果相等直接取出来显示，如果不相等，会重新生成新的缓存数据。\n\n### 弱引用缓存：\n &ensp;接着往下看，首先从弱引用中获取数据：\n  ```\n  EngineResource<?> active = loadFromActiveResources(key, isMemoryCacheable);\n  //方法内部实现\n @Nullable\n  private EngineResource<?> loadFromActiveResources(Key key) {\n    EngineResource<?> active = activeResources.get(key);\n    if (active != null) {\n      active.acquire();\n    }\n\n    return active;\n  }\n//方法 acquire\nsynchronized void acquire() {\n    if (isRecycled) {\n      throw new IllegalStateException(\"Cannot acquire a recycled resource\");\n    }\n    ++acquired;\n  }\n\n  ```\n* 注：如果弱引用中获取到数据，计数器acquired+1，如果获取不到active对象在合适的时机被回收，走LruCaChe缓存，接着往下看：\n\n### LruCaChe缓存：\n弱引用中未获取到数据，则通过LruCaChe获取，源码如下：\n```java\nprivate EngineResource<?> loadFromCache(Key key) {\n    EngineResource<?> cached = getEngineResourceFromCache(key);\n    if (cached != null) {\n      cached.acquire();\n      activeResources.activate(key, cached);\n    }\n    return cached;\n  }\n```\n* 注：如果cached对象不为空，则调用activeResources.activate方法将其加入弱引用缓存中，且计数器acquired+1\n\n进入getEngineResourceFromCache方法看下具体实现：\n```java\n  private EngineResource<?> getEngineResourceFromCache(Key key) {\n    Resource<?> cached = cache.remove(key);\n\n    final EngineResource<?> result;\n    if (cached == null) {\n      result = null;\n    } else if (cached instanceof EngineResource) {\n      // Save an object allocation if we've cached an EngineResource (the typical case).\n      result = (EngineResource<?>) cached;\n    } else {\n      result =\n          new EngineResource<>(\n              cached, /*isMemoryCacheable=*/ true, /*isRecyclable=*/ true, key, /*listener=*/ this);\n    }\n    return result;\n  }\n```\n总结：之所以采用内存缓存是为防止应用重复将图片读入到内存，造成内存资源浪费。\n* 注：从上面源码中我们看到，读内存缓存的流程为：先从弱引用中取数据，如果取到，计数器acquired+1返回，如果不存在，则从LruCaChe中取，如果取到，计数器acquired+1返回。如果LruCaChe中不存key对应在数据，则会走磁盘缓存，往下看：\n\n### 磁盘缓存：\n先了解以下磁盘缓存的策略有哪些?\n* ALL:缓存原图(SOURCE)和处理图(RESULT)\n* NONE:什么都不缓存\n* SOURCE:只缓存原图(SOURCE)\n* RESULT:只缓存处理图(RESULT) ---默认值\n\n上面讲的是内存读取数据，如果内存没有取到，则Glide会从磁盘缓存取数据，通过EngineJob开启线程池去加载图片。这里有2个关键类：DecodeJob 和EngineJob。\n一个图片的加载在 DecodeJob 这个类中，这个任务由 EngineJob 这个线程池去执行的。去到 run 方法，源码如下：\n```java\nprivate void runWrapped() {\n    switch (runReason) {\n      case INITIALIZE:\n        stage = getNextStage(Stage.INITIALIZE);\n        currentGenerator = getNextGenerator();\n        runGenerators();\n        break;\n      case SWITCH_TO_SOURCE_SERVICE:\n        runGenerators();\n        break;\n      case DECODE_DATA:\n        decodeFromRetrievedData();\n        break;\n      default:\n        throw new IllegalStateException(\"Unrecognized run reason: \" + runReason);\n    }\n  }\n```\nEngineJob 内部维护了线程池，用来管理资源加载，当资源加载完毕的时候通知回调；\nDecodeJob是线程池中的一个任务。\n&ensp;磁盘缓存是通过DiskLruCache来管理的,根据不同的缓存策略，会有2种类型的图片：\n* DATA：原始图片\n*  RESOURCE：转换后的图片\n磁盘缓存依次通过ResourcesCacheGenerator（转换过的缓存数据）、SourceGenerator（未经转换的原始的缓存数据）、DataCacheGenerator（网络获取图片数据后根据缓存策略的不同去缓存不同的图片到磁盘上）来获取缓存数据。\n总结：防止应用重复的从网络或者其他地方下载和读取数据\n\n关于LruCache源码请看：{% post_link LinkedHashMap-原理分析 LinkedHashMap原理分析 %}\n关于LinedHashMap原理请看： {% post_link LruCache-原理分析 LruCache原理分析 %}\n\n\n## Glide读取图片，获取顺序\n答： 弱引用--> LruCache算法--> 磁盘缓存(DiskLruCache)\n\n> 我们APP中加载某张图片时，先去弱引用（WeakReference）中寻找，如果弱引用（WeakReference）中有，则从WeakReference中取出图片使用，如果WeakReference中没有图片则去LruCache中寻找图片，如果LruCache中有，则取出来使用，并将该图片放入WeakReference中，如果LruCache中没有，则从磁盘缓存/网络中加载图片。\n\n\n## Glide缓存图片，写入顺序\n答：弱引用 --> LruCache算法 --> 磁盘缓存中(DiskLruCache)\n>当图片不存在的时候，会先从网络下载，然后将图片存入弱引用中，Glide会采用一个acquired变量用来记录图片被引用的次数\n当acquired变量大于0的时候，说明图片正在使用中，也就是将图片放到弱引用缓存当中。\n如果acquired变量等于0了，说明图片已经不再被使用了，那么此时会调用方法来释放资源，首先会将缓存图片从弱引用中移除，然后再将它put到LruResourceCache当中。\n这样也就实现了正在使用中的图片使用弱引用来进行缓存，不在使用中的图片使用LruCache来进行缓存的功能。\n上面磁盘缓存分析中我们知道，当图片资源加载到DecodeJob这个类中，任务是有EngineJob线程池去执行的，假设我们将缓存策略设置为 DiskCacheStrategy.ALL 分析下源码中是如何执行的，下面先看runWrapped方法：\n```java\nprivate void runWrapped() {\n    switch (runReason) {\n      case INITIALIZE:\n        stage = getNextStage(Stage.INITIALIZE);\n        currentGenerator = getNextGenerator();\n        runGenerators();\n        break;\n      case SWITCH_TO_SOURCE_SERVICE:\n        runGenerators();\n        break;\n      case DECODE_DATA:\n        decodeFromRetrievedData();\n        break;\n      default:\n        throw new IllegalStateException(\"Unrecognized run reason: \" + runReason);\n    }\n  }\n```\n注：由于我们的策略为DiskCacheStrategy.ALL 所以diskCacheStrategy.decodeCachedResource() 为true，即会解析解码的流程，所以 State 被赋值为 Stage.RESOURCE_CACHE，如下：\n进入getNextStage方法：\n```java\nprivate Stage getNextStage(Stage current) {\n    switch (current) {\n      case INITIALIZE:\n        return diskCacheStrategy.decodeCachedResource()\n            ? Stage.RESOURCE_CACHE\n            : getNextStage(Stage.RESOURCE_CACHE);\n      case RESOURCE_CACHE:\n        return diskCacheStrategy.decodeCachedData()\n            ? Stage.DATA_CACHE\n            : getNextStage(Stage.DATA_CACHE);\n      case DATA_CACHE:\n        // Skip loading from source if the user opted to only retrieve the resource from cache.\n        return onlyRetrieveFromCache ? Stage.FINISHED : Stage.SOURCE;\n      case SOURCE:\n      case FINISHED:\n        return Stage.FINISHED;\n      default:\n        throw new IllegalArgumentException(\"Unrecognized stage: \" + current);\n    }\n  }\n```\n注：currentGenerator = getNextGenerator() 拿到当前的解码器为 ResourceCacheGenerator然后 调用 runGenerators() 方法。看下里面具体实现。\n```java\nprivate void runGenerators() {\n    currentThread = Thread.currentThread();\n    startFetchTime = LogTime.getLogTime();\n    boolean isStarted = false;\n    while (!isCancelled\n        && currentGenerator != null\n        && !(isStarted = currentGenerator.startNext())) {\n      stage = getNextStage(stage);\n      currentGenerator = getNextGenerator();\n\n      //stage == Stage.SOURCE)时退出,并调用reschedule\n      if (stage == Stage.SOURCE) {\n        reschedule();\n        return;\n      }\n    }\n    // We've run out of stages and generators, give up.\n    if ((stage == Stage.FINISHED || isCancelled) && !isStarted) {\n      notifyFailed();\n    }\n\n    // Otherwise a generator started a new load and we expect to be called back in\n    // onDataFetcherReady.\n  }\n```\n注：while循环不断通过startNext()解析不同的缓存策略，直到stage == Stage.SOURCE 后退出。\n\n下面进入startNext看下源码：\n```java\n @Override\n  public boolean startNext() {\n    List<Key> sourceIds = helper.getCacheKeys();\n    ...\n  //由于第一次拿不到key，while会一直查找\n    while (modelLoaders == null || !hasNextModelLoader()) {\n      resourceClassIndex++;\n      if (resourceClassIndex >= resourceClasses.size()) {\n        sourceIdIndex++;\n    //直到返回false\n        if (sourceIdIndex >= sourceIds.size()) {\n          return false;\n        }\n        resourceClassIndex = 0;\n      }\n\n      Key sourceId = sourceIds.get(sourceIdIndex);\n     ...\n      currentKey =\n          new ResourceCacheKey( // NOPMD AvoidInstantiatingObjectsInLoops\n              helper.getArrayPool(),\n              sourceId,\n              helper.getSignature(),\n              helper.getWidth(),\n              helper.getHeight(),\n              transformation,\n              resourceClass,\n              helper.getOptions());\n      cacheFile = helper.getDiskCache().get(currentKey);\n      if (cacheFile != null) {\n        sourceKey = sourceId;\n        modelLoaders = helper.getModelLoaders(cacheFile);\n        modelLoaderIndex = 0;\n      }\n    }\n\n    loadData = null;\n    boolean started = false;\n    while (!started && hasNextModelLoader()) {\n      ModelLoader<File, ?> modelLoader = modelLoaders.get(modelLoaderIndex++);\n      loadData =\n          modelLoader.buildLoadData(\n              cacheFile, helper.getWidth(), helper.getHeight(), helper.getOptions());\n      if (loadData != null && helper.hasLoadPath(loadData.fetcher.getDataClass())) {\n        started = true;\n        loadData.fetcher.loadData(helper.getPriority(), this);\n      }\n    }\n\n    return started;\n  }\n```\n下面看下reschedule()方法源码：\n```java\n  @Override\n  public void reschedule() {\n    runReason = RunReason.SWITCH_TO_SOURCE_SERVICE;\n    callback.reschedule(this);\n  }\n```\n注：重复调用 runWrapped() 方法，但此时的 runReason 已经变成了 SWITCH_TO_SOURCE_SERVICE，所以它会执行 runGenerators() 方法\n```java\n private void runGenerators() {\n    currentThread = Thread.currentThread();\n    startFetchTime = LogTime.getLogTime();\n    boolean isStarted = false;\n    while (!isCancelled\n        && currentGenerator != null\n        && !(isStarted = currentGenerator.startNext())) {\n      stage = getNextStage(stage);\n      currentGenerator = getNextGenerator();\n\n      if (stage == Stage.SOURCE) {\n        reschedule();\n        return;\n      }\n    }\n    if ((stage == Stage.FINISHED || isCancelled) && !isStarted) {\n      notifyFailed();\n    }\n  }\n```\n注：此时 currentGenerator 为 SourceGennerator 已经不为null。\n\n接着看SourceGennerator类中startNext：\n```java\n@Override\n  public boolean startNext() {\n    if (dataToCache != null) {\n      Object data = dataToCache;\n      dataToCache = null;\n      // 存储到 DiskLruCache\n      cacheData(data);\n    }\n\n    if (sourceCacheGenerator != null && sourceCacheGenerator.startNext()) {\n      return true;\n    }\n    sourceCacheGenerator = null;\n\n    loadData = null;\n    boolean started = false;\n    while (!started && hasNextModelLoader()) {\n      loadData = helper.getLoadData().get(loadDataListIndex++);\n      if (loadData != null\n          && (helper.getDiskCacheStrategy().isDataCacheable(loadData.fetcher.getDataSource())\n              || helper.hasLoadPath(loadData.fetcher.getDataClass()))) {\n        started = true;\n        /加载数据\n        startNextLoad(loadData);\n      }\n    }\n    return started;\n  }\n```\n> 硬盘缓存时通过在 EngineJob 中的 DecodeJob 中完成的，先通过ResourcesCacheGenerator、DataCacheGenerator 看是否能从 DiskLruCache 拿到数据，如果不能，从SourceGenerator去解析数据，并把数据存储到 DiskLruCache 中，后面通过 DataCacheGenerator 的 startNext() 去分发 fetcher 。\n最后会回调 EngineJob 的 onResourceReady() 方法了，该方法会加载图片，并把数据存到弱引用中\n","source":"_posts/2022/android/glide-缓存那些事儿.md","raw":"---\ntitle: Glide-缓存那些事儿\ndate: 2022-03-23 23:29:41\ncategories:\n - Android\ntags:\n - Android\ncover: https://s1.ax1x.com/2022/03/23/q3s3Oe.jpg\n---\n\n# 前言：\n &ensp;在我们开发的时候对图片加载是必须使用的 这篇文章我们就聊聊Glide缓存。\n\n## Glide 缓存分几种\n答：缓存分为两种：内存缓存、磁盘缓存\n\n内存缓存：\n内存缓存又分为两种：一种是：弱引用缓存、一种是： Lrucache缓存。\n往下看Glide内存缓存是如何实现的，源码如下：\n```java\npublic <R> LoadStatus load(\n      GlideContext glideContext,\n      Object model,\n      Key signature,\n      int width,\n      int height,\n      Class<?> resourceClass,\n      Class<R> transcodeClass,\n      Priority priority,\n      DiskCacheStrategy diskCacheStrategy,\n      Map<Class<?>, Transformation<?>> transformations,\n      boolean isTransformationRequired,\n      boolean isScaleOnlyOrNoTransform,\n      Options options,\n      boolean isMemoryCacheable,\n      boolean useUnlimitedSourceExecutorPool,\n      boolean useAnimationPool,\n      boolean onlyRetrieveFromCache,\n      ResourceCallback cb,\n      Executor callbackExecutor) {\n    long startTime = VERBOSE_IS_LOGGABLE ? LogTime.getLogTime() : 0;\n\n    // 生成key\n    EngineKey key =\n        keyFactory.buildKey(\n            model,\n            signature,\n            width,\n            height,\n            transformations,\n            resourceClass,\n            transcodeClass,\n            options);\n\n    EngineResource<?> memoryResource;\n    synchronized (this) {\n    //进到loadFromMemory方法里面看看做了什么\n      memoryResource = loadFromMemory(key, isMemoryCacheable, startTime);\n\n     ...\n\n @Nullable\n  private EngineResource<?> loadFromMemory(\n      EngineKey key, boolean isMemoryCacheable, long startTime) {\n    if (!isMemoryCacheable) {\n      return null;\n    }\n\n  // 弱引用\n    EngineResource<?> active = loadFromActiveResources(key);\n    if (active != null) {\n      if (VERBOSE_IS_LOGGABLE) {\n        logWithTimeAndKey(\"Loaded resource from active resources\", startTime, key);\n      }\n      return active;\n    }\n\n   // LruCaChe\n    EngineResource<?> cached = loadFromCache(key);\n    if (cached != null) {\n      if (VERBOSE_IS_LOGGABLE) {\n        logWithTimeAndKey(\"Loaded resource from cache\", startTime, key);\n      }\n      return cached;\n    }\n\n  // 如果返回null ，从网络或其它地方获取\n    return null;\n  }\n\n```\n可以看到，Engine类中load方法图片加载策略，其中生成key的参数中包含width 、height\n ```java\n  EngineKey key = keyFactory.buildKey(model, signature, width, height, transformations,\n        resourceClass, transcodeClass, options);\n ```\n*  width  & height 就是ImageView的尺寸，生成key时为什么会传入ImageView的尺寸呢？\n* 注：Glide 通过key读取缓存图片时，会校验当前的图片尺寸是否与imageView的尺寸相等，如果相等直接取出来显示，如果不相等，会重新生成新的缓存数据。\n\n### 弱引用缓存：\n &ensp;接着往下看，首先从弱引用中获取数据：\n  ```\n  EngineResource<?> active = loadFromActiveResources(key, isMemoryCacheable);\n  //方法内部实现\n @Nullable\n  private EngineResource<?> loadFromActiveResources(Key key) {\n    EngineResource<?> active = activeResources.get(key);\n    if (active != null) {\n      active.acquire();\n    }\n\n    return active;\n  }\n//方法 acquire\nsynchronized void acquire() {\n    if (isRecycled) {\n      throw new IllegalStateException(\"Cannot acquire a recycled resource\");\n    }\n    ++acquired;\n  }\n\n  ```\n* 注：如果弱引用中获取到数据，计数器acquired+1，如果获取不到active对象在合适的时机被回收，走LruCaChe缓存，接着往下看：\n\n### LruCaChe缓存：\n弱引用中未获取到数据，则通过LruCaChe获取，源码如下：\n```java\nprivate EngineResource<?> loadFromCache(Key key) {\n    EngineResource<?> cached = getEngineResourceFromCache(key);\n    if (cached != null) {\n      cached.acquire();\n      activeResources.activate(key, cached);\n    }\n    return cached;\n  }\n```\n* 注：如果cached对象不为空，则调用activeResources.activate方法将其加入弱引用缓存中，且计数器acquired+1\n\n进入getEngineResourceFromCache方法看下具体实现：\n```java\n  private EngineResource<?> getEngineResourceFromCache(Key key) {\n    Resource<?> cached = cache.remove(key);\n\n    final EngineResource<?> result;\n    if (cached == null) {\n      result = null;\n    } else if (cached instanceof EngineResource) {\n      // Save an object allocation if we've cached an EngineResource (the typical case).\n      result = (EngineResource<?>) cached;\n    } else {\n      result =\n          new EngineResource<>(\n              cached, /*isMemoryCacheable=*/ true, /*isRecyclable=*/ true, key, /*listener=*/ this);\n    }\n    return result;\n  }\n```\n总结：之所以采用内存缓存是为防止应用重复将图片读入到内存，造成内存资源浪费。\n* 注：从上面源码中我们看到，读内存缓存的流程为：先从弱引用中取数据，如果取到，计数器acquired+1返回，如果不存在，则从LruCaChe中取，如果取到，计数器acquired+1返回。如果LruCaChe中不存key对应在数据，则会走磁盘缓存，往下看：\n\n### 磁盘缓存：\n先了解以下磁盘缓存的策略有哪些?\n* ALL:缓存原图(SOURCE)和处理图(RESULT)\n* NONE:什么都不缓存\n* SOURCE:只缓存原图(SOURCE)\n* RESULT:只缓存处理图(RESULT) ---默认值\n\n上面讲的是内存读取数据，如果内存没有取到，则Glide会从磁盘缓存取数据，通过EngineJob开启线程池去加载图片。这里有2个关键类：DecodeJob 和EngineJob。\n一个图片的加载在 DecodeJob 这个类中，这个任务由 EngineJob 这个线程池去执行的。去到 run 方法，源码如下：\n```java\nprivate void runWrapped() {\n    switch (runReason) {\n      case INITIALIZE:\n        stage = getNextStage(Stage.INITIALIZE);\n        currentGenerator = getNextGenerator();\n        runGenerators();\n        break;\n      case SWITCH_TO_SOURCE_SERVICE:\n        runGenerators();\n        break;\n      case DECODE_DATA:\n        decodeFromRetrievedData();\n        break;\n      default:\n        throw new IllegalStateException(\"Unrecognized run reason: \" + runReason);\n    }\n  }\n```\nEngineJob 内部维护了线程池，用来管理资源加载，当资源加载完毕的时候通知回调；\nDecodeJob是线程池中的一个任务。\n&ensp;磁盘缓存是通过DiskLruCache来管理的,根据不同的缓存策略，会有2种类型的图片：\n* DATA：原始图片\n*  RESOURCE：转换后的图片\n磁盘缓存依次通过ResourcesCacheGenerator（转换过的缓存数据）、SourceGenerator（未经转换的原始的缓存数据）、DataCacheGenerator（网络获取图片数据后根据缓存策略的不同去缓存不同的图片到磁盘上）来获取缓存数据。\n总结：防止应用重复的从网络或者其他地方下载和读取数据\n\n关于LruCache源码请看：{% post_link LinkedHashMap-原理分析 LinkedHashMap原理分析 %}\n关于LinedHashMap原理请看： {% post_link LruCache-原理分析 LruCache原理分析 %}\n\n\n## Glide读取图片，获取顺序\n答： 弱引用--> LruCache算法--> 磁盘缓存(DiskLruCache)\n\n> 我们APP中加载某张图片时，先去弱引用（WeakReference）中寻找，如果弱引用（WeakReference）中有，则从WeakReference中取出图片使用，如果WeakReference中没有图片则去LruCache中寻找图片，如果LruCache中有，则取出来使用，并将该图片放入WeakReference中，如果LruCache中没有，则从磁盘缓存/网络中加载图片。\n\n\n## Glide缓存图片，写入顺序\n答：弱引用 --> LruCache算法 --> 磁盘缓存中(DiskLruCache)\n>当图片不存在的时候，会先从网络下载，然后将图片存入弱引用中，Glide会采用一个acquired变量用来记录图片被引用的次数\n当acquired变量大于0的时候，说明图片正在使用中，也就是将图片放到弱引用缓存当中。\n如果acquired变量等于0了，说明图片已经不再被使用了，那么此时会调用方法来释放资源，首先会将缓存图片从弱引用中移除，然后再将它put到LruResourceCache当中。\n这样也就实现了正在使用中的图片使用弱引用来进行缓存，不在使用中的图片使用LruCache来进行缓存的功能。\n上面磁盘缓存分析中我们知道，当图片资源加载到DecodeJob这个类中，任务是有EngineJob线程池去执行的，假设我们将缓存策略设置为 DiskCacheStrategy.ALL 分析下源码中是如何执行的，下面先看runWrapped方法：\n```java\nprivate void runWrapped() {\n    switch (runReason) {\n      case INITIALIZE:\n        stage = getNextStage(Stage.INITIALIZE);\n        currentGenerator = getNextGenerator();\n        runGenerators();\n        break;\n      case SWITCH_TO_SOURCE_SERVICE:\n        runGenerators();\n        break;\n      case DECODE_DATA:\n        decodeFromRetrievedData();\n        break;\n      default:\n        throw new IllegalStateException(\"Unrecognized run reason: \" + runReason);\n    }\n  }\n```\n注：由于我们的策略为DiskCacheStrategy.ALL 所以diskCacheStrategy.decodeCachedResource() 为true，即会解析解码的流程，所以 State 被赋值为 Stage.RESOURCE_CACHE，如下：\n进入getNextStage方法：\n```java\nprivate Stage getNextStage(Stage current) {\n    switch (current) {\n      case INITIALIZE:\n        return diskCacheStrategy.decodeCachedResource()\n            ? Stage.RESOURCE_CACHE\n            : getNextStage(Stage.RESOURCE_CACHE);\n      case RESOURCE_CACHE:\n        return diskCacheStrategy.decodeCachedData()\n            ? Stage.DATA_CACHE\n            : getNextStage(Stage.DATA_CACHE);\n      case DATA_CACHE:\n        // Skip loading from source if the user opted to only retrieve the resource from cache.\n        return onlyRetrieveFromCache ? Stage.FINISHED : Stage.SOURCE;\n      case SOURCE:\n      case FINISHED:\n        return Stage.FINISHED;\n      default:\n        throw new IllegalArgumentException(\"Unrecognized stage: \" + current);\n    }\n  }\n```\n注：currentGenerator = getNextGenerator() 拿到当前的解码器为 ResourceCacheGenerator然后 调用 runGenerators() 方法。看下里面具体实现。\n```java\nprivate void runGenerators() {\n    currentThread = Thread.currentThread();\n    startFetchTime = LogTime.getLogTime();\n    boolean isStarted = false;\n    while (!isCancelled\n        && currentGenerator != null\n        && !(isStarted = currentGenerator.startNext())) {\n      stage = getNextStage(stage);\n      currentGenerator = getNextGenerator();\n\n      //stage == Stage.SOURCE)时退出,并调用reschedule\n      if (stage == Stage.SOURCE) {\n        reschedule();\n        return;\n      }\n    }\n    // We've run out of stages and generators, give up.\n    if ((stage == Stage.FINISHED || isCancelled) && !isStarted) {\n      notifyFailed();\n    }\n\n    // Otherwise a generator started a new load and we expect to be called back in\n    // onDataFetcherReady.\n  }\n```\n注：while循环不断通过startNext()解析不同的缓存策略，直到stage == Stage.SOURCE 后退出。\n\n下面进入startNext看下源码：\n```java\n @Override\n  public boolean startNext() {\n    List<Key> sourceIds = helper.getCacheKeys();\n    ...\n  //由于第一次拿不到key，while会一直查找\n    while (modelLoaders == null || !hasNextModelLoader()) {\n      resourceClassIndex++;\n      if (resourceClassIndex >= resourceClasses.size()) {\n        sourceIdIndex++;\n    //直到返回false\n        if (sourceIdIndex >= sourceIds.size()) {\n          return false;\n        }\n        resourceClassIndex = 0;\n      }\n\n      Key sourceId = sourceIds.get(sourceIdIndex);\n     ...\n      currentKey =\n          new ResourceCacheKey( // NOPMD AvoidInstantiatingObjectsInLoops\n              helper.getArrayPool(),\n              sourceId,\n              helper.getSignature(),\n              helper.getWidth(),\n              helper.getHeight(),\n              transformation,\n              resourceClass,\n              helper.getOptions());\n      cacheFile = helper.getDiskCache().get(currentKey);\n      if (cacheFile != null) {\n        sourceKey = sourceId;\n        modelLoaders = helper.getModelLoaders(cacheFile);\n        modelLoaderIndex = 0;\n      }\n    }\n\n    loadData = null;\n    boolean started = false;\n    while (!started && hasNextModelLoader()) {\n      ModelLoader<File, ?> modelLoader = modelLoaders.get(modelLoaderIndex++);\n      loadData =\n          modelLoader.buildLoadData(\n              cacheFile, helper.getWidth(), helper.getHeight(), helper.getOptions());\n      if (loadData != null && helper.hasLoadPath(loadData.fetcher.getDataClass())) {\n        started = true;\n        loadData.fetcher.loadData(helper.getPriority(), this);\n      }\n    }\n\n    return started;\n  }\n```\n下面看下reschedule()方法源码：\n```java\n  @Override\n  public void reschedule() {\n    runReason = RunReason.SWITCH_TO_SOURCE_SERVICE;\n    callback.reschedule(this);\n  }\n```\n注：重复调用 runWrapped() 方法，但此时的 runReason 已经变成了 SWITCH_TO_SOURCE_SERVICE，所以它会执行 runGenerators() 方法\n```java\n private void runGenerators() {\n    currentThread = Thread.currentThread();\n    startFetchTime = LogTime.getLogTime();\n    boolean isStarted = false;\n    while (!isCancelled\n        && currentGenerator != null\n        && !(isStarted = currentGenerator.startNext())) {\n      stage = getNextStage(stage);\n      currentGenerator = getNextGenerator();\n\n      if (stage == Stage.SOURCE) {\n        reschedule();\n        return;\n      }\n    }\n    if ((stage == Stage.FINISHED || isCancelled) && !isStarted) {\n      notifyFailed();\n    }\n  }\n```\n注：此时 currentGenerator 为 SourceGennerator 已经不为null。\n\n接着看SourceGennerator类中startNext：\n```java\n@Override\n  public boolean startNext() {\n    if (dataToCache != null) {\n      Object data = dataToCache;\n      dataToCache = null;\n      // 存储到 DiskLruCache\n      cacheData(data);\n    }\n\n    if (sourceCacheGenerator != null && sourceCacheGenerator.startNext()) {\n      return true;\n    }\n    sourceCacheGenerator = null;\n\n    loadData = null;\n    boolean started = false;\n    while (!started && hasNextModelLoader()) {\n      loadData = helper.getLoadData().get(loadDataListIndex++);\n      if (loadData != null\n          && (helper.getDiskCacheStrategy().isDataCacheable(loadData.fetcher.getDataSource())\n              || helper.hasLoadPath(loadData.fetcher.getDataClass()))) {\n        started = true;\n        /加载数据\n        startNextLoad(loadData);\n      }\n    }\n    return started;\n  }\n```\n> 硬盘缓存时通过在 EngineJob 中的 DecodeJob 中完成的，先通过ResourcesCacheGenerator、DataCacheGenerator 看是否能从 DiskLruCache 拿到数据，如果不能，从SourceGenerator去解析数据，并把数据存储到 DiskLruCache 中，后面通过 DataCacheGenerator 的 startNext() 去分发 fetcher 。\n最后会回调 EngineJob 的 onResourceReady() 方法了，该方法会加载图片，并把数据存到弱引用中\n","slug":"glide-缓存那些事儿","published":1,"relaxed":"android","updated":"2022-03-31T02:12:13.178Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl2vhlmft000at6fy23fs3ume","content":"<h1 id=\"前言：\"><a href=\"#前言：\" class=\"headerlink\" title=\"前言：\"></a>前言：</h1><p> &ensp;在我们开发的时候对图片加载是必须使用的 这篇文章我们就聊聊Glide缓存。</p>\n<h2 id=\"Glide-缓存分几种\"><a href=\"#Glide-缓存分几种\" class=\"headerlink\" title=\"Glide 缓存分几种\"></a>Glide 缓存分几种</h2><p>答：缓存分为两种：内存缓存、磁盘缓存</p>\n<p>内存缓存：<br>内存缓存又分为两种：一种是：弱引用缓存、一种是： Lrucache缓存。<br>往下看Glide内存缓存是如何实现的，源码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> &lt;R&gt; LoadStatus <span class=\"title function_\">load</span><span class=\"params\">(</span></span><br><span class=\"line\"><span class=\"params\">      GlideContext glideContext,</span></span><br><span class=\"line\"><span class=\"params\">      Object model,</span></span><br><span class=\"line\"><span class=\"params\">      Key signature,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">int</span> width,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">int</span> height,</span></span><br><span class=\"line\"><span class=\"params\">      Class&lt;?&gt; resourceClass,</span></span><br><span class=\"line\"><span class=\"params\">      Class&lt;R&gt; transcodeClass,</span></span><br><span class=\"line\"><span class=\"params\">      Priority priority,</span></span><br><span class=\"line\"><span class=\"params\">      DiskCacheStrategy diskCacheStrategy,</span></span><br><span class=\"line\"><span class=\"params\">      Map&lt;Class&lt;?&gt;, Transformation&lt;?&gt;&gt; transformations,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">boolean</span> isTransformationRequired,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">boolean</span> isScaleOnlyOrNoTransform,</span></span><br><span class=\"line\"><span class=\"params\">      Options options,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">boolean</span> isMemoryCacheable,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">boolean</span> useUnlimitedSourceExecutorPool,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">boolean</span> useAnimationPool,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">boolean</span> onlyRetrieveFromCache,</span></span><br><span class=\"line\"><span class=\"params\">      ResourceCallback cb,</span></span><br><span class=\"line\"><span class=\"params\">      Executor callbackExecutor)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">long</span> <span class=\"variable\">startTime</span> <span class=\"operator\">=</span> VERBOSE_IS_LOGGABLE ? LogTime.getLogTime() : <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 生成key</span></span><br><span class=\"line\">    <span class=\"type\">EngineKey</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span></span><br><span class=\"line\">        keyFactory.buildKey(</span><br><span class=\"line\">            model,</span><br><span class=\"line\">            signature,</span><br><span class=\"line\">            width,</span><br><span class=\"line\">            height,</span><br><span class=\"line\">            transformations,</span><br><span class=\"line\">            resourceClass,</span><br><span class=\"line\">            transcodeClass,</span><br><span class=\"line\">            options);</span><br><span class=\"line\"></span><br><span class=\"line\">    EngineResource&lt;?&gt; memoryResource;</span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span> (<span class=\"built_in\">this</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//进到loadFromMemory方法里面看看做了什么</span></span><br><span class=\"line\">      memoryResource = loadFromMemory(key, isMemoryCacheable, startTime);</span><br><span class=\"line\"></span><br><span class=\"line\">     ...</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"meta\">@Nullable</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> EngineResource&lt;?&gt; loadFromMemory(</span><br><span class=\"line\">      EngineKey key, <span class=\"type\">boolean</span> isMemoryCacheable, <span class=\"type\">long</span> startTime) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isMemoryCacheable) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 弱引用</span></span><br><span class=\"line\">    EngineResource&lt;?&gt; active = loadFromActiveResources(key);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (active != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (VERBOSE_IS_LOGGABLE) &#123;</span><br><span class=\"line\">        logWithTimeAndKey(<span class=\"string\">&quot;Loaded resource from active resources&quot;</span>, startTime, key);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> active;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">// LruCaChe</span></span><br><span class=\"line\">    EngineResource&lt;?&gt; cached = loadFromCache(key);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cached != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (VERBOSE_IS_LOGGABLE) &#123;</span><br><span class=\"line\">        logWithTimeAndKey(<span class=\"string\">&quot;Loaded resource from cache&quot;</span>, startTime, key);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> cached;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 如果返回null ，从网络或其它地方获取</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>可以看到，Engine类中load方法图片加载策略，其中生成key的参数中包含width 、height<br> <figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">EngineKey</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> keyFactory.buildKey(model, signature, width, height, transformations,</span><br><span class=\"line\">      resourceClass, transcodeClass, options);</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li> width  &amp; height 就是ImageView的尺寸，生成key时为什么会传入ImageView的尺寸呢？</li>\n<li>注：Glide 通过key读取缓存图片时，会校验当前的图片尺寸是否与imageView的尺寸相等，如果相等直接取出来显示，如果不相等，会重新生成新的缓存数据。</li>\n</ul>\n<h3 id=\"弱引用缓存：\"><a href=\"#弱引用缓存：\" class=\"headerlink\" title=\"弱引用缓存：\"></a>弱引用缓存：</h3><p> &ensp;接着往下看，首先从弱引用中获取数据：<br>  <figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">  EngineResource&lt;?&gt; active = loadFromActiveResources(key, isMemoryCacheable);</span><br><span class=\"line\">  //方法内部实现</span><br><span class=\"line\"> @Nullable</span><br><span class=\"line\">  private EngineResource&lt;?&gt; loadFromActiveResources(Key key) &#123;</span><br><span class=\"line\">    EngineResource&lt;?&gt; active = activeResources.get(key);</span><br><span class=\"line\">    if (active != null) &#123;</span><br><span class=\"line\">      active.acquire();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return active;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">//方法 acquire</span><br><span class=\"line\">synchronized void acquire() &#123;</span><br><span class=\"line\">    if (isRecycled) &#123;</span><br><span class=\"line\">      throw new IllegalStateException(&quot;Cannot acquire a recycled resource&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ++acquired;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>注：如果弱引用中获取到数据，计数器acquired+1，如果获取不到active对象在合适的时机被回收，走LruCaChe缓存，接着往下看：</li>\n</ul>\n<h3 id=\"LruCaChe缓存：\"><a href=\"#LruCaChe缓存：\" class=\"headerlink\" title=\"LruCaChe缓存：\"></a>LruCaChe缓存：</h3><p>弱引用中未获取到数据，则通过LruCaChe获取，源码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> EngineResource&lt;?&gt; loadFromCache(Key key) &#123;</span><br><span class=\"line\">    EngineResource&lt;?&gt; cached = getEngineResourceFromCache(key);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cached != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      cached.acquire();</span><br><span class=\"line\">      activeResources.activate(key, cached);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cached;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>注：如果cached对象不为空，则调用activeResources.activate方法将其加入弱引用缓存中，且计数器acquired+1</li>\n</ul>\n<p>进入getEngineResourceFromCache方法看下具体实现：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> EngineResource&lt;?&gt; getEngineResourceFromCache(Key key) &#123;</span><br><span class=\"line\">  Resource&lt;?&gt; cached = cache.remove(key);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">final</span> EngineResource&lt;?&gt; result;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (cached == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    result = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (cached <span class=\"keyword\">instanceof</span> EngineResource) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Save an object allocation if we&#x27;ve cached an EngineResource (the typical case).</span></span><br><span class=\"line\">    result = (EngineResource&lt;?&gt;) cached;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    result =</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">EngineResource</span>&lt;&gt;(</span><br><span class=\"line\">            cached, <span class=\"comment\">/*isMemoryCacheable=*/</span> <span class=\"literal\">true</span>, <span class=\"comment\">/*isRecyclable=*/</span> <span class=\"literal\">true</span>, key, <span class=\"comment\">/*listener=*/</span> <span class=\"built_in\">this</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>总结：之所以采用内存缓存是为防止应用重复将图片读入到内存，造成内存资源浪费。</p>\n<ul>\n<li>注：从上面源码中我们看到，读内存缓存的流程为：先从弱引用中取数据，如果取到，计数器acquired+1返回，如果不存在，则从LruCaChe中取，如果取到，计数器acquired+1返回。如果LruCaChe中不存key对应在数据，则会走磁盘缓存，往下看：</li>\n</ul>\n<h3 id=\"磁盘缓存：\"><a href=\"#磁盘缓存：\" class=\"headerlink\" title=\"磁盘缓存：\"></a>磁盘缓存：</h3><p>先了解以下磁盘缓存的策略有哪些?</p>\n<ul>\n<li>ALL:缓存原图(SOURCE)和处理图(RESULT)</li>\n<li>NONE:什么都不缓存</li>\n<li>SOURCE:只缓存原图(SOURCE)</li>\n<li>RESULT:只缓存处理图(RESULT) —默认值</li>\n</ul>\n<p>上面讲的是内存读取数据，如果内存没有取到，则Glide会从磁盘缓存取数据，通过EngineJob开启线程池去加载图片。这里有2个关键类：DecodeJob 和EngineJob。<br>一个图片的加载在 DecodeJob 这个类中，这个任务由 EngineJob 这个线程池去执行的。去到 run 方法，源码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">runWrapped</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (runReason) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> INITIALIZE:</span><br><span class=\"line\">        stage = getNextStage(Stage.INITIALIZE);</span><br><span class=\"line\">        currentGenerator = getNextGenerator();</span><br><span class=\"line\">        runGenerators();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> SWITCH_TO_SOURCE_SERVICE:</span><br><span class=\"line\">        runGenerators();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> DECODE_DATA:</span><br><span class=\"line\">        decodeFromRetrievedData();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">default</span>:</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;Unrecognized run reason: &quot;</span> + runReason);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>EngineJob 内部维护了线程池，用来管理资源加载，当资源加载完毕的时候通知回调；<br>DecodeJob是线程池中的一个任务。<br>&ensp;磁盘缓存是通过DiskLruCache来管理的,根据不同的缓存策略，会有2种类型的图片：</p>\n<ul>\n<li>DATA：原始图片</li>\n<li> RESOURCE：转换后的图片<br>磁盘缓存依次通过ResourcesCacheGenerator（转换过的缓存数据）、SourceGenerator（未经转换的原始的缓存数据）、DataCacheGenerator（网络获取图片数据后根据缓存策略的不同去缓存不同的图片到磁盘上）来获取缓存数据。<br>总结：防止应用重复的从网络或者其他地方下载和读取数据</li>\n</ul>\n<p>关于LruCache源码请看：<a href=\"/relaxed/LinkedHashMap-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/\" title=\"LinkedHashMap原理分析\">LinkedHashMap原理分析</a><br>关于LinedHashMap原理请看： <a href=\"/relaxed/LruCache-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/\" title=\"LruCache原理分析\">LruCache原理分析</a></p>\n<h2 id=\"Glide读取图片，获取顺序\"><a href=\"#Glide读取图片，获取顺序\" class=\"headerlink\" title=\"Glide读取图片，获取顺序\"></a>Glide读取图片，获取顺序</h2><p>答： 弱引用–&gt; LruCache算法–&gt; 磁盘缓存(DiskLruCache)</p>\n<blockquote>\n<p>我们APP中加载某张图片时，先去弱引用（WeakReference）中寻找，如果弱引用（WeakReference）中有，则从WeakReference中取出图片使用，如果WeakReference中没有图片则去LruCache中寻找图片，如果LruCache中有，则取出来使用，并将该图片放入WeakReference中，如果LruCache中没有，则从磁盘缓存/网络中加载图片。</p>\n</blockquote>\n<h2 id=\"Glide缓存图片，写入顺序\"><a href=\"#Glide缓存图片，写入顺序\" class=\"headerlink\" title=\"Glide缓存图片，写入顺序\"></a>Glide缓存图片，写入顺序</h2><p>答：弱引用 –&gt; LruCache算法 –&gt; 磁盘缓存中(DiskLruCache)</p>\n<blockquote>\n<p>当图片不存在的时候，会先从网络下载，然后将图片存入弱引用中，Glide会采用一个acquired变量用来记录图片被引用的次数<br>当acquired变量大于0的时候，说明图片正在使用中，也就是将图片放到弱引用缓存当中。<br>如果acquired变量等于0了，说明图片已经不再被使用了，那么此时会调用方法来释放资源，首先会将缓存图片从弱引用中移除，然后再将它put到LruResourceCache当中。<br>这样也就实现了正在使用中的图片使用弱引用来进行缓存，不在使用中的图片使用LruCache来进行缓存的功能。<br>上面磁盘缓存分析中我们知道，当图片资源加载到DecodeJob这个类中，任务是有EngineJob线程池去执行的，假设我们将缓存策略设置为 DiskCacheStrategy.ALL 分析下源码中是如何执行的，下面先看runWrapped方法：</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">runWrapped</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (runReason) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> INITIALIZE:</span><br><span class=\"line\">        stage = getNextStage(Stage.INITIALIZE);</span><br><span class=\"line\">        currentGenerator = getNextGenerator();</span><br><span class=\"line\">        runGenerators();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> SWITCH_TO_SOURCE_SERVICE:</span><br><span class=\"line\">        runGenerators();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> DECODE_DATA:</span><br><span class=\"line\">        decodeFromRetrievedData();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">default</span>:</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;Unrecognized run reason: &quot;</span> + runReason);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>注：由于我们的策略为DiskCacheStrategy.ALL 所以diskCacheStrategy.decodeCachedResource() 为true，即会解析解码的流程，所以 State 被赋值为 Stage.RESOURCE_CACHE，如下：<br>进入getNextStage方法：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> Stage <span class=\"title function_\">getNextStage</span><span class=\"params\">(Stage current)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (current) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> INITIALIZE:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> diskCacheStrategy.decodeCachedResource()</span><br><span class=\"line\">            ? Stage.RESOURCE_CACHE</span><br><span class=\"line\">            : getNextStage(Stage.RESOURCE_CACHE);</span><br><span class=\"line\">      <span class=\"keyword\">case</span> RESOURCE_CACHE:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> diskCacheStrategy.decodeCachedData()</span><br><span class=\"line\">            ? Stage.DATA_CACHE</span><br><span class=\"line\">            : getNextStage(Stage.DATA_CACHE);</span><br><span class=\"line\">      <span class=\"keyword\">case</span> DATA_CACHE:</span><br><span class=\"line\">        <span class=\"comment\">// Skip loading from source if the user opted to only retrieve the resource from cache.</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> onlyRetrieveFromCache ? Stage.FINISHED : Stage.SOURCE;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> SOURCE:</span><br><span class=\"line\">      <span class=\"keyword\">case</span> FINISHED:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Stage.FINISHED;</span><br><span class=\"line\">      <span class=\"keyword\">default</span>:</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;Unrecognized stage: &quot;</span> + current);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>注：currentGenerator = getNextGenerator() 拿到当前的解码器为 ResourceCacheGenerator然后 调用 runGenerators() 方法。看下里面具体实现。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">runGenerators</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    currentThread = Thread.currentThread();</span><br><span class=\"line\">    startFetchTime = LogTime.getLogTime();</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"variable\">isStarted</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!isCancelled</span><br><span class=\"line\">        &amp;&amp; currentGenerator != <span class=\"literal\">null</span></span><br><span class=\"line\">        &amp;&amp; !(isStarted = currentGenerator.startNext())) &#123;</span><br><span class=\"line\">      stage = getNextStage(stage);</span><br><span class=\"line\">      currentGenerator = getNextGenerator();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//stage == Stage.SOURCE)时退出,并调用reschedule</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (stage == Stage.SOURCE) &#123;</span><br><span class=\"line\">        reschedule();</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// We&#x27;ve run out of stages and generators, give up.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((stage == Stage.FINISHED || isCancelled) &amp;&amp; !isStarted) &#123;</span><br><span class=\"line\">      notifyFailed();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Otherwise a generator started a new load and we expect to be called back in</span></span><br><span class=\"line\">    <span class=\"comment\">// onDataFetcherReady.</span></span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>注：while循环不断通过startNext()解析不同的缓存策略，直到stage == Stage.SOURCE 后退出。</p>\n<p>下面进入startNext看下源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"> <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">startNext</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">   List&lt;Key&gt; sourceIds = helper.getCacheKeys();</span><br><span class=\"line\">   ...</span><br><span class=\"line\"> <span class=\"comment\">//由于第一次拿不到key，while会一直查找</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> (modelLoaders == <span class=\"literal\">null</span> || !hasNextModelLoader()) &#123;</span><br><span class=\"line\">     resourceClassIndex++;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (resourceClassIndex &gt;= resourceClasses.size()) &#123;</span><br><span class=\"line\">       sourceIdIndex++;</span><br><span class=\"line\">   <span class=\"comment\">//直到返回false</span></span><br><span class=\"line\">       <span class=\"keyword\">if</span> (sourceIdIndex &gt;= sourceIds.size()) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       resourceClassIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"type\">Key</span> <span class=\"variable\">sourceId</span> <span class=\"operator\">=</span> sourceIds.get(sourceIdIndex);</span><br><span class=\"line\">    ...</span><br><span class=\"line\">     currentKey =</span><br><span class=\"line\">         <span class=\"keyword\">new</span> <span class=\"title class_\">ResourceCacheKey</span>( <span class=\"comment\">// NOPMD AvoidInstantiatingObjectsInLoops</span></span><br><span class=\"line\">             helper.getArrayPool(),</span><br><span class=\"line\">             sourceId,</span><br><span class=\"line\">             helper.getSignature(),</span><br><span class=\"line\">             helper.getWidth(),</span><br><span class=\"line\">             helper.getHeight(),</span><br><span class=\"line\">             transformation,</span><br><span class=\"line\">             resourceClass,</span><br><span class=\"line\">             helper.getOptions());</span><br><span class=\"line\">     cacheFile = helper.getDiskCache().get(currentKey);</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (cacheFile != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">       sourceKey = sourceId;</span><br><span class=\"line\">       modelLoaders = helper.getModelLoaders(cacheFile);</span><br><span class=\"line\">       modelLoaderIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   loadData = <span class=\"literal\">null</span>;</span><br><span class=\"line\">   <span class=\"type\">boolean</span> <span class=\"variable\">started</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">   <span class=\"keyword\">while</span> (!started &amp;&amp; hasNextModelLoader()) &#123;</span><br><span class=\"line\">     ModelLoader&lt;File, ?&gt; modelLoader = modelLoaders.get(modelLoaderIndex++);</span><br><span class=\"line\">     loadData =</span><br><span class=\"line\">         modelLoader.buildLoadData(</span><br><span class=\"line\">             cacheFile, helper.getWidth(), helper.getHeight(), helper.getOptions());</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (loadData != <span class=\"literal\">null</span> &amp;&amp; helper.hasLoadPath(loadData.fetcher.getDataClass())) &#123;</span><br><span class=\"line\">       started = <span class=\"literal\">true</span>;</span><br><span class=\"line\">       loadData.fetcher.loadData(helper.getPriority(), <span class=\"built_in\">this</span>);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">return</span> started;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p>下面看下reschedule()方法源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">reschedule</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  runReason = RunReason.SWITCH_TO_SOURCE_SERVICE;</span><br><span class=\"line\">  callback.reschedule(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>注：重复调用 runWrapped() 方法，但此时的 runReason 已经变成了 SWITCH_TO_SOURCE_SERVICE，所以它会执行 runGenerators() 方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">runGenerators</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">   currentThread = Thread.currentThread();</span><br><span class=\"line\">   startFetchTime = LogTime.getLogTime();</span><br><span class=\"line\">   <span class=\"type\">boolean</span> <span class=\"variable\">isStarted</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">   <span class=\"keyword\">while</span> (!isCancelled</span><br><span class=\"line\">       &amp;&amp; currentGenerator != <span class=\"literal\">null</span></span><br><span class=\"line\">       &amp;&amp; !(isStarted = currentGenerator.startNext())) &#123;</span><br><span class=\"line\">     stage = getNextStage(stage);</span><br><span class=\"line\">     currentGenerator = getNextGenerator();</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">if</span> (stage == Stage.SOURCE) &#123;</span><br><span class=\"line\">       reschedule();</span><br><span class=\"line\">       <span class=\"keyword\">return</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   <span class=\"keyword\">if</span> ((stage == Stage.FINISHED || isCancelled) &amp;&amp; !isStarted) &#123;</span><br><span class=\"line\">     notifyFailed();</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p>注：此时 currentGenerator 为 SourceGennerator 已经不为null。</p>\n<p>接着看SourceGennerator类中startNext：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">startNext</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dataToCache != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"type\">Object</span> <span class=\"variable\">data</span> <span class=\"operator\">=</span> dataToCache;</span><br><span class=\"line\">      dataToCache = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"comment\">// 存储到 DiskLruCache</span></span><br><span class=\"line\">      cacheData(data);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (sourceCacheGenerator != <span class=\"literal\">null</span> &amp;&amp; sourceCacheGenerator.startNext()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sourceCacheGenerator = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    loadData = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"variable\">started</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!started &amp;&amp; hasNextModelLoader()) &#123;</span><br><span class=\"line\">      loadData = helper.getLoadData().get(loadDataListIndex++);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (loadData != <span class=\"literal\">null</span></span><br><span class=\"line\">          &amp;&amp; (helper.getDiskCacheStrategy().isDataCacheable(loadData.fetcher.getDataSource())</span><br><span class=\"line\">              || helper.hasLoadPath(loadData.fetcher.getDataClass()))) &#123;</span><br><span class=\"line\">        started = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        /加载数据</span><br><span class=\"line\">        startNextLoad(loadData);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> started;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>硬盘缓存时通过在 EngineJob 中的 DecodeJob 中完成的，先通过ResourcesCacheGenerator、DataCacheGenerator 看是否能从 DiskLruCache 拿到数据，如果不能，从SourceGenerator去解析数据，并把数据存储到 DiskLruCache 中，后面通过 DataCacheGenerator 的 startNext() 去分发 fetcher 。<br>最后会回调 EngineJob 的 onResourceReady() 方法了，该方法会加载图片，并把数据存到弱引用中</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"前言：\"><a href=\"#前言：\" class=\"headerlink\" title=\"前言：\"></a>前言：</h1><p> &ensp;在我们开发的时候对图片加载是必须使用的 这篇文章我们就聊聊Glide缓存。</p>\n<h2 id=\"Glide-缓存分几种\"><a href=\"#Glide-缓存分几种\" class=\"headerlink\" title=\"Glide 缓存分几种\"></a>Glide 缓存分几种</h2><p>答：缓存分为两种：内存缓存、磁盘缓存</p>\n<p>内存缓存：<br>内存缓存又分为两种：一种是：弱引用缓存、一种是： Lrucache缓存。<br>往下看Glide内存缓存是如何实现的，源码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> &lt;R&gt; LoadStatus <span class=\"title function_\">load</span><span class=\"params\">(</span></span><br><span class=\"line\"><span class=\"params\">      GlideContext glideContext,</span></span><br><span class=\"line\"><span class=\"params\">      Object model,</span></span><br><span class=\"line\"><span class=\"params\">      Key signature,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">int</span> width,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">int</span> height,</span></span><br><span class=\"line\"><span class=\"params\">      Class&lt;?&gt; resourceClass,</span></span><br><span class=\"line\"><span class=\"params\">      Class&lt;R&gt; transcodeClass,</span></span><br><span class=\"line\"><span class=\"params\">      Priority priority,</span></span><br><span class=\"line\"><span class=\"params\">      DiskCacheStrategy diskCacheStrategy,</span></span><br><span class=\"line\"><span class=\"params\">      Map&lt;Class&lt;?&gt;, Transformation&lt;?&gt;&gt; transformations,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">boolean</span> isTransformationRequired,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">boolean</span> isScaleOnlyOrNoTransform,</span></span><br><span class=\"line\"><span class=\"params\">      Options options,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">boolean</span> isMemoryCacheable,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">boolean</span> useUnlimitedSourceExecutorPool,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">boolean</span> useAnimationPool,</span></span><br><span class=\"line\"><span class=\"params\">      <span class=\"type\">boolean</span> onlyRetrieveFromCache,</span></span><br><span class=\"line\"><span class=\"params\">      ResourceCallback cb,</span></span><br><span class=\"line\"><span class=\"params\">      Executor callbackExecutor)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">long</span> <span class=\"variable\">startTime</span> <span class=\"operator\">=</span> VERBOSE_IS_LOGGABLE ? LogTime.getLogTime() : <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 生成key</span></span><br><span class=\"line\">    <span class=\"type\">EngineKey</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span></span><br><span class=\"line\">        keyFactory.buildKey(</span><br><span class=\"line\">            model,</span><br><span class=\"line\">            signature,</span><br><span class=\"line\">            width,</span><br><span class=\"line\">            height,</span><br><span class=\"line\">            transformations,</span><br><span class=\"line\">            resourceClass,</span><br><span class=\"line\">            transcodeClass,</span><br><span class=\"line\">            options);</span><br><span class=\"line\"></span><br><span class=\"line\">    EngineResource&lt;?&gt; memoryResource;</span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span> (<span class=\"built_in\">this</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//进到loadFromMemory方法里面看看做了什么</span></span><br><span class=\"line\">      memoryResource = loadFromMemory(key, isMemoryCacheable, startTime);</span><br><span class=\"line\"></span><br><span class=\"line\">     ...</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"meta\">@Nullable</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> EngineResource&lt;?&gt; loadFromMemory(</span><br><span class=\"line\">      EngineKey key, <span class=\"type\">boolean</span> isMemoryCacheable, <span class=\"type\">long</span> startTime) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isMemoryCacheable) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 弱引用</span></span><br><span class=\"line\">    EngineResource&lt;?&gt; active = loadFromActiveResources(key);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (active != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (VERBOSE_IS_LOGGABLE) &#123;</span><br><span class=\"line\">        logWithTimeAndKey(<span class=\"string\">&quot;Loaded resource from active resources&quot;</span>, startTime, key);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> active;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">// LruCaChe</span></span><br><span class=\"line\">    EngineResource&lt;?&gt; cached = loadFromCache(key);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cached != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (VERBOSE_IS_LOGGABLE) &#123;</span><br><span class=\"line\">        logWithTimeAndKey(<span class=\"string\">&quot;Loaded resource from cache&quot;</span>, startTime, key);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> cached;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 如果返回null ，从网络或其它地方获取</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>可以看到，Engine类中load方法图片加载策略，其中生成key的参数中包含width 、height<br> <figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">EngineKey</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> keyFactory.buildKey(model, signature, width, height, transformations,</span><br><span class=\"line\">      resourceClass, transcodeClass, options);</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li> width  &amp; height 就是ImageView的尺寸，生成key时为什么会传入ImageView的尺寸呢？</li>\n<li>注：Glide 通过key读取缓存图片时，会校验当前的图片尺寸是否与imageView的尺寸相等，如果相等直接取出来显示，如果不相等，会重新生成新的缓存数据。</li>\n</ul>\n<h3 id=\"弱引用缓存：\"><a href=\"#弱引用缓存：\" class=\"headerlink\" title=\"弱引用缓存：\"></a>弱引用缓存：</h3><p> &ensp;接着往下看，首先从弱引用中获取数据：<br>  <figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">  EngineResource&lt;?&gt; active = loadFromActiveResources(key, isMemoryCacheable);</span><br><span class=\"line\">  //方法内部实现</span><br><span class=\"line\"> @Nullable</span><br><span class=\"line\">  private EngineResource&lt;?&gt; loadFromActiveResources(Key key) &#123;</span><br><span class=\"line\">    EngineResource&lt;?&gt; active = activeResources.get(key);</span><br><span class=\"line\">    if (active != null) &#123;</span><br><span class=\"line\">      active.acquire();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return active;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">//方法 acquire</span><br><span class=\"line\">synchronized void acquire() &#123;</span><br><span class=\"line\">    if (isRecycled) &#123;</span><br><span class=\"line\">      throw new IllegalStateException(&quot;Cannot acquire a recycled resource&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ++acquired;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>注：如果弱引用中获取到数据，计数器acquired+1，如果获取不到active对象在合适的时机被回收，走LruCaChe缓存，接着往下看：</li>\n</ul>\n<h3 id=\"LruCaChe缓存：\"><a href=\"#LruCaChe缓存：\" class=\"headerlink\" title=\"LruCaChe缓存：\"></a>LruCaChe缓存：</h3><p>弱引用中未获取到数据，则通过LruCaChe获取，源码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> EngineResource&lt;?&gt; loadFromCache(Key key) &#123;</span><br><span class=\"line\">    EngineResource&lt;?&gt; cached = getEngineResourceFromCache(key);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cached != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      cached.acquire();</span><br><span class=\"line\">      activeResources.activate(key, cached);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cached;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>注：如果cached对象不为空，则调用activeResources.activate方法将其加入弱引用缓存中，且计数器acquired+1</li>\n</ul>\n<p>进入getEngineResourceFromCache方法看下具体实现：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> EngineResource&lt;?&gt; getEngineResourceFromCache(Key key) &#123;</span><br><span class=\"line\">  Resource&lt;?&gt; cached = cache.remove(key);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">final</span> EngineResource&lt;?&gt; result;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (cached == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    result = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (cached <span class=\"keyword\">instanceof</span> EngineResource) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Save an object allocation if we&#x27;ve cached an EngineResource (the typical case).</span></span><br><span class=\"line\">    result = (EngineResource&lt;?&gt;) cached;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    result =</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">EngineResource</span>&lt;&gt;(</span><br><span class=\"line\">            cached, <span class=\"comment\">/*isMemoryCacheable=*/</span> <span class=\"literal\">true</span>, <span class=\"comment\">/*isRecyclable=*/</span> <span class=\"literal\">true</span>, key, <span class=\"comment\">/*listener=*/</span> <span class=\"built_in\">this</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>总结：之所以采用内存缓存是为防止应用重复将图片读入到内存，造成内存资源浪费。</p>\n<ul>\n<li>注：从上面源码中我们看到，读内存缓存的流程为：先从弱引用中取数据，如果取到，计数器acquired+1返回，如果不存在，则从LruCaChe中取，如果取到，计数器acquired+1返回。如果LruCaChe中不存key对应在数据，则会走磁盘缓存，往下看：</li>\n</ul>\n<h3 id=\"磁盘缓存：\"><a href=\"#磁盘缓存：\" class=\"headerlink\" title=\"磁盘缓存：\"></a>磁盘缓存：</h3><p>先了解以下磁盘缓存的策略有哪些?</p>\n<ul>\n<li>ALL:缓存原图(SOURCE)和处理图(RESULT)</li>\n<li>NONE:什么都不缓存</li>\n<li>SOURCE:只缓存原图(SOURCE)</li>\n<li>RESULT:只缓存处理图(RESULT) —默认值</li>\n</ul>\n<p>上面讲的是内存读取数据，如果内存没有取到，则Glide会从磁盘缓存取数据，通过EngineJob开启线程池去加载图片。这里有2个关键类：DecodeJob 和EngineJob。<br>一个图片的加载在 DecodeJob 这个类中，这个任务由 EngineJob 这个线程池去执行的。去到 run 方法，源码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">runWrapped</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (runReason) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> INITIALIZE:</span><br><span class=\"line\">        stage = getNextStage(Stage.INITIALIZE);</span><br><span class=\"line\">        currentGenerator = getNextGenerator();</span><br><span class=\"line\">        runGenerators();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> SWITCH_TO_SOURCE_SERVICE:</span><br><span class=\"line\">        runGenerators();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> DECODE_DATA:</span><br><span class=\"line\">        decodeFromRetrievedData();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">default</span>:</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;Unrecognized run reason: &quot;</span> + runReason);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>EngineJob 内部维护了线程池，用来管理资源加载，当资源加载完毕的时候通知回调；<br>DecodeJob是线程池中的一个任务。<br>&ensp;磁盘缓存是通过DiskLruCache来管理的,根据不同的缓存策略，会有2种类型的图片：</p>\n<ul>\n<li>DATA：原始图片</li>\n<li> RESOURCE：转换后的图片<br>磁盘缓存依次通过ResourcesCacheGenerator（转换过的缓存数据）、SourceGenerator（未经转换的原始的缓存数据）、DataCacheGenerator（网络获取图片数据后根据缓存策略的不同去缓存不同的图片到磁盘上）来获取缓存数据。<br>总结：防止应用重复的从网络或者其他地方下载和读取数据</li>\n</ul>\n<p>关于LruCache源码请看：<a href=\"/relaxed/LinkedHashMap-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/\" title=\"LinkedHashMap原理分析\">LinkedHashMap原理分析</a><br>关于LinedHashMap原理请看： <a href=\"/relaxed/LruCache-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/\" title=\"LruCache原理分析\">LruCache原理分析</a></p>\n<h2 id=\"Glide读取图片，获取顺序\"><a href=\"#Glide读取图片，获取顺序\" class=\"headerlink\" title=\"Glide读取图片，获取顺序\"></a>Glide读取图片，获取顺序</h2><p>答： 弱引用–&gt; LruCache算法–&gt; 磁盘缓存(DiskLruCache)</p>\n<blockquote>\n<p>我们APP中加载某张图片时，先去弱引用（WeakReference）中寻找，如果弱引用（WeakReference）中有，则从WeakReference中取出图片使用，如果WeakReference中没有图片则去LruCache中寻找图片，如果LruCache中有，则取出来使用，并将该图片放入WeakReference中，如果LruCache中没有，则从磁盘缓存/网络中加载图片。</p>\n</blockquote>\n<h2 id=\"Glide缓存图片，写入顺序\"><a href=\"#Glide缓存图片，写入顺序\" class=\"headerlink\" title=\"Glide缓存图片，写入顺序\"></a>Glide缓存图片，写入顺序</h2><p>答：弱引用 –&gt; LruCache算法 –&gt; 磁盘缓存中(DiskLruCache)</p>\n<blockquote>\n<p>当图片不存在的时候，会先从网络下载，然后将图片存入弱引用中，Glide会采用一个acquired变量用来记录图片被引用的次数<br>当acquired变量大于0的时候，说明图片正在使用中，也就是将图片放到弱引用缓存当中。<br>如果acquired变量等于0了，说明图片已经不再被使用了，那么此时会调用方法来释放资源，首先会将缓存图片从弱引用中移除，然后再将它put到LruResourceCache当中。<br>这样也就实现了正在使用中的图片使用弱引用来进行缓存，不在使用中的图片使用LruCache来进行缓存的功能。<br>上面磁盘缓存分析中我们知道，当图片资源加载到DecodeJob这个类中，任务是有EngineJob线程池去执行的，假设我们将缓存策略设置为 DiskCacheStrategy.ALL 分析下源码中是如何执行的，下面先看runWrapped方法：</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">runWrapped</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (runReason) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> INITIALIZE:</span><br><span class=\"line\">        stage = getNextStage(Stage.INITIALIZE);</span><br><span class=\"line\">        currentGenerator = getNextGenerator();</span><br><span class=\"line\">        runGenerators();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> SWITCH_TO_SOURCE_SERVICE:</span><br><span class=\"line\">        runGenerators();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> DECODE_DATA:</span><br><span class=\"line\">        decodeFromRetrievedData();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">default</span>:</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;Unrecognized run reason: &quot;</span> + runReason);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>注：由于我们的策略为DiskCacheStrategy.ALL 所以diskCacheStrategy.decodeCachedResource() 为true，即会解析解码的流程，所以 State 被赋值为 Stage.RESOURCE_CACHE，如下：<br>进入getNextStage方法：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> Stage <span class=\"title function_\">getNextStage</span><span class=\"params\">(Stage current)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (current) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> INITIALIZE:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> diskCacheStrategy.decodeCachedResource()</span><br><span class=\"line\">            ? Stage.RESOURCE_CACHE</span><br><span class=\"line\">            : getNextStage(Stage.RESOURCE_CACHE);</span><br><span class=\"line\">      <span class=\"keyword\">case</span> RESOURCE_CACHE:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> diskCacheStrategy.decodeCachedData()</span><br><span class=\"line\">            ? Stage.DATA_CACHE</span><br><span class=\"line\">            : getNextStage(Stage.DATA_CACHE);</span><br><span class=\"line\">      <span class=\"keyword\">case</span> DATA_CACHE:</span><br><span class=\"line\">        <span class=\"comment\">// Skip loading from source if the user opted to only retrieve the resource from cache.</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> onlyRetrieveFromCache ? Stage.FINISHED : Stage.SOURCE;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> SOURCE:</span><br><span class=\"line\">      <span class=\"keyword\">case</span> FINISHED:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Stage.FINISHED;</span><br><span class=\"line\">      <span class=\"keyword\">default</span>:</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;Unrecognized stage: &quot;</span> + current);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>注：currentGenerator = getNextGenerator() 拿到当前的解码器为 ResourceCacheGenerator然后 调用 runGenerators() 方法。看下里面具体实现。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">runGenerators</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    currentThread = Thread.currentThread();</span><br><span class=\"line\">    startFetchTime = LogTime.getLogTime();</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"variable\">isStarted</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!isCancelled</span><br><span class=\"line\">        &amp;&amp; currentGenerator != <span class=\"literal\">null</span></span><br><span class=\"line\">        &amp;&amp; !(isStarted = currentGenerator.startNext())) &#123;</span><br><span class=\"line\">      stage = getNextStage(stage);</span><br><span class=\"line\">      currentGenerator = getNextGenerator();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//stage == Stage.SOURCE)时退出,并调用reschedule</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (stage == Stage.SOURCE) &#123;</span><br><span class=\"line\">        reschedule();</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// We&#x27;ve run out of stages and generators, give up.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((stage == Stage.FINISHED || isCancelled) &amp;&amp; !isStarted) &#123;</span><br><span class=\"line\">      notifyFailed();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Otherwise a generator started a new load and we expect to be called back in</span></span><br><span class=\"line\">    <span class=\"comment\">// onDataFetcherReady.</span></span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>注：while循环不断通过startNext()解析不同的缓存策略，直到stage == Stage.SOURCE 后退出。</p>\n<p>下面进入startNext看下源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"> <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">startNext</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">   List&lt;Key&gt; sourceIds = helper.getCacheKeys();</span><br><span class=\"line\">   ...</span><br><span class=\"line\"> <span class=\"comment\">//由于第一次拿不到key，while会一直查找</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> (modelLoaders == <span class=\"literal\">null</span> || !hasNextModelLoader()) &#123;</span><br><span class=\"line\">     resourceClassIndex++;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (resourceClassIndex &gt;= resourceClasses.size()) &#123;</span><br><span class=\"line\">       sourceIdIndex++;</span><br><span class=\"line\">   <span class=\"comment\">//直到返回false</span></span><br><span class=\"line\">       <span class=\"keyword\">if</span> (sourceIdIndex &gt;= sourceIds.size()) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       resourceClassIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"type\">Key</span> <span class=\"variable\">sourceId</span> <span class=\"operator\">=</span> sourceIds.get(sourceIdIndex);</span><br><span class=\"line\">    ...</span><br><span class=\"line\">     currentKey =</span><br><span class=\"line\">         <span class=\"keyword\">new</span> <span class=\"title class_\">ResourceCacheKey</span>( <span class=\"comment\">// NOPMD AvoidInstantiatingObjectsInLoops</span></span><br><span class=\"line\">             helper.getArrayPool(),</span><br><span class=\"line\">             sourceId,</span><br><span class=\"line\">             helper.getSignature(),</span><br><span class=\"line\">             helper.getWidth(),</span><br><span class=\"line\">             helper.getHeight(),</span><br><span class=\"line\">             transformation,</span><br><span class=\"line\">             resourceClass,</span><br><span class=\"line\">             helper.getOptions());</span><br><span class=\"line\">     cacheFile = helper.getDiskCache().get(currentKey);</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (cacheFile != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">       sourceKey = sourceId;</span><br><span class=\"line\">       modelLoaders = helper.getModelLoaders(cacheFile);</span><br><span class=\"line\">       modelLoaderIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   loadData = <span class=\"literal\">null</span>;</span><br><span class=\"line\">   <span class=\"type\">boolean</span> <span class=\"variable\">started</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">   <span class=\"keyword\">while</span> (!started &amp;&amp; hasNextModelLoader()) &#123;</span><br><span class=\"line\">     ModelLoader&lt;File, ?&gt; modelLoader = modelLoaders.get(modelLoaderIndex++);</span><br><span class=\"line\">     loadData =</span><br><span class=\"line\">         modelLoader.buildLoadData(</span><br><span class=\"line\">             cacheFile, helper.getWidth(), helper.getHeight(), helper.getOptions());</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (loadData != <span class=\"literal\">null</span> &amp;&amp; helper.hasLoadPath(loadData.fetcher.getDataClass())) &#123;</span><br><span class=\"line\">       started = <span class=\"literal\">true</span>;</span><br><span class=\"line\">       loadData.fetcher.loadData(helper.getPriority(), <span class=\"built_in\">this</span>);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">return</span> started;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p>下面看下reschedule()方法源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">reschedule</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  runReason = RunReason.SWITCH_TO_SOURCE_SERVICE;</span><br><span class=\"line\">  callback.reschedule(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>注：重复调用 runWrapped() 方法，但此时的 runReason 已经变成了 SWITCH_TO_SOURCE_SERVICE，所以它会执行 runGenerators() 方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">runGenerators</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">   currentThread = Thread.currentThread();</span><br><span class=\"line\">   startFetchTime = LogTime.getLogTime();</span><br><span class=\"line\">   <span class=\"type\">boolean</span> <span class=\"variable\">isStarted</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">   <span class=\"keyword\">while</span> (!isCancelled</span><br><span class=\"line\">       &amp;&amp; currentGenerator != <span class=\"literal\">null</span></span><br><span class=\"line\">       &amp;&amp; !(isStarted = currentGenerator.startNext())) &#123;</span><br><span class=\"line\">     stage = getNextStage(stage);</span><br><span class=\"line\">     currentGenerator = getNextGenerator();</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">if</span> (stage == Stage.SOURCE) &#123;</span><br><span class=\"line\">       reschedule();</span><br><span class=\"line\">       <span class=\"keyword\">return</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   <span class=\"keyword\">if</span> ((stage == Stage.FINISHED || isCancelled) &amp;&amp; !isStarted) &#123;</span><br><span class=\"line\">     notifyFailed();</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p>注：此时 currentGenerator 为 SourceGennerator 已经不为null。</p>\n<p>接着看SourceGennerator类中startNext：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">startNext</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dataToCache != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"type\">Object</span> <span class=\"variable\">data</span> <span class=\"operator\">=</span> dataToCache;</span><br><span class=\"line\">      dataToCache = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"comment\">// 存储到 DiskLruCache</span></span><br><span class=\"line\">      cacheData(data);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (sourceCacheGenerator != <span class=\"literal\">null</span> &amp;&amp; sourceCacheGenerator.startNext()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sourceCacheGenerator = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    loadData = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"variable\">started</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!started &amp;&amp; hasNextModelLoader()) &#123;</span><br><span class=\"line\">      loadData = helper.getLoadData().get(loadDataListIndex++);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (loadData != <span class=\"literal\">null</span></span><br><span class=\"line\">          &amp;&amp; (helper.getDiskCacheStrategy().isDataCacheable(loadData.fetcher.getDataSource())</span><br><span class=\"line\">              || helper.hasLoadPath(loadData.fetcher.getDataClass()))) &#123;</span><br><span class=\"line\">        started = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        /加载数据</span><br><span class=\"line\">        startNextLoad(loadData);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> started;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>硬盘缓存时通过在 EngineJob 中的 DecodeJob 中完成的，先通过ResourcesCacheGenerator、DataCacheGenerator 看是否能从 DiskLruCache 拿到数据，如果不能，从SourceGenerator去解析数据，并把数据存储到 DiskLruCache 中，后面通过 DataCacheGenerator 的 startNext() 去分发 fetcher 。<br>最后会回调 EngineJob 的 onResourceReady() 方法了，该方法会加载图片，并把数据存到弱引用中</p>\n</blockquote>\n"},{"title":"Handler-消息通讯机制详解","date":"2022-04-19T08:25:10.000Z","cover":"https://s1.ax1x.com/2022/03/23/q3s3Oe.jpg","_content":"\n# 前言\n* Android开发中，Handler媒介机制十分常用，今天我们来详细聊一聊Handler通讯机制是如何实现的。\n\n# 目录\n\n[![Omb4mt.png](https://s1.ax1x.com/2022/05/05/Omb4mt.png)](https://s1.ax1x.com/2022/05/05/Omb4mt.png)\n\n# 使用场景\n在多线程的应用场景中，将工作线程中需更新UI的操作信息 传递到 UI主线程，从而实现工作线程对UI线程的更新，最终实现异步消息的处理。\n\n# 概念描述\nHandler、Message、MessageQueue、Looper相关概念如下图。\n<!--MarkDown 不支持单元格合并，即使用Html -->\n<table>\n<!--this is title-->\n    <tr align = \"center\" bgcolor = \"#91bdb6\">\n        <td>概念</td>\n        <td>定义</td>\n        <td>作用</td>\n        <!-- <td>备注</td> -->\n    </tr>\n    <!--this is Main-->\n    <tr align=\"center\">\n        <td>主线程<br/><font color = \"#91bdb6\">( UI线程、Main Thread )</font></td>\n        <td>系统首次启动，会创建主线程</td>\n        <td>处理UI相关操作<br/><font color = \"#91bdb6\">( 如：更新UI )</font></td>\n        <!-- <td rowspan=\"2\">主线程与子线程<br/>通讯媒介Handler</td> -->\n    </tr>\n      <!--this is Thread-->\n    <tr align=\"center\">\n        <td>子线程<br/><font color = \"#91bdb6\">（ 工作线程 ）</font></td>\n        <td>人为开启的线程</td>\n        <td>执行耗时任务<br/><font color = \"#91bdb6\">( 如 网络请求、数据加载等 )</font></td>\n    </tr>\n      <!--this is Message-->\n    <tr align=\"center\">\n      <td>消息<br/><font color = \"#91bdb6\">（ Message ）</font></td>\n      <td>线程间通讯数据单元<br/><font color = \"#91bdb6\">（handler接收&处理消息对象）</font></td>\n      <td>存储业务操作信息<br/><font color = \"#91bdb6\">（ Message ）</font></td>\n    </tr>\n      <!--this is Message Queue-->\n    <tr align=\"center\">\n        <td>消息队列<br/><font color = \"#91bdb6\">（ Message Queue ）</font></td>\n        <td>数据结构<br/><font color = \"#91bdb6\">（ 以时间顺序排列 ）</font></td>\n        <td>存储Handler发送的消息<br/><font color = \"#91bdb6\">（ Message ）</font></td>\n    </tr>\n      <!--this is Handler-->\n    <tr align=\"center\">\n        <td>处理着<br/><font color = \"#91bdb6\">（ Handler ）</font></td>\n        <td>主线程与子线程通讯的媒介<br/>线程消息的处理者</td>\n        <td>将消息( Message ）添加到<br/>消息队列( Message Queue )中<br/> 处理循环器（ Looper ）分派的消息</td>\n    </tr>\n    <tr align=\"center\">\n        <td>循环器<br/><font color = \"#91bdb6\">（ Looper ）</font></td>\n        <td>消息队列( Message Queue )<br/>与处理者 （ Handler ）<br/>通讯媒介</td>\n        <td>消息循环 即：<br/><font color = \"#91bdb6\"> 消息获取：循环取出消息队列<br/>（ Message Queue ）中的<br/>消息（ Message ）<br/> 消息分发：将取出来的消息<br/>（ Message ）发送给对应的<br/>处理者（ Handler ）</font></td>\n    </tr>\n</table>\n\n# 机制说明\nHandler消息传递机制:多个线程并发更新UI时，保证线程安全\n[![示例图.png](https://s1.ax1x.com/2022/05/06/OmxK4P.png)](https://s1.ax1x.com/2022/05/06/OmxK4P.png)\n注：[图解Java线程安全](https://juejin.cn/post/6844903890224152584)\n\n# 原理解析\n### 相关概念\n  * 异步通信( 主线程中创建 )\n\n    >> 处理者（ Handler ）对象\n    >>> 注：Handler会自定绑定主线程中的Looper&MessageQueue\n\n    >> 处理器（ Looper ）对象\n      >>> 注：Looper & MessageQueue都是在主线程中\n\n    >> 消息队列（ Message Queue ）对象\n      >>>注： 创建MessageQueue后，Looper会自动进入循环状态，有消息则循环取，没有，则阻塞状态，发现消息后会被唤醒继续循环读取。\n\n  * 消息入队列\n  > 工作线程中通过Handler的sendMessage()方法发送消息（ Message ）到消息队列（ MessageQueue ）中，这是消息完成入队列操作。\n  >> 注：此消息内容就是工作线程对UI主线程的操作\n\n  * 消息循环\n  > 第一步：消息出队列：Looper循环取出消息队列（ MessageQueue ）中的消息（ Message ）交给第二步消息分发。\n  > 第二步：消息分发：Looper将取出来的消息（ Message ）发送给创建消息的处理者（ Handler ）\n  >> 注：循环器( Looper )循环取消息时，若发现消息队列（ MessageQueue ）中为空，则会线程阻塞，待又消息时再次被唤醒继续循环读取。\n\n  * 消息处理\n  >处理者( Handler ) 在接收处理器（ Looper ）发送过来的消息（ Message ）会进行UI操作。\n\n[![示意图.png](https://s1.ax1x.com/2022/05/06/OuFqzR.png)](https://s1.ax1x.com/2022/05/06/OuFqzR.png)\n\n# 总结\nAndroid开发中，UI操作在主线程中进行，但是主线程又不能进行耗时操作，否则会阻塞线程，产生我们常见的ANR异常，所以常常把耗时操作放到其它子线程进行。如果在子线程中需要更新UI，一般是通过 Handler发送消息( message ），主线程接收消息并且进行相应的处理。以上就是Handler通讯消息传递机制的详解。\n\n### <font color=#9dc2af>如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻</font>\n","source":"_posts/2022/android/Handler-消息通讯机制详解.md","raw":"---\ntitle: Handler-消息通讯机制详解\ndate: 2022-04-19 16:25:10\ncategories:\n - Android\ntags:\n - Handler\ncover: https://s1.ax1x.com/2022/03/23/q3s3Oe.jpg\n---\n\n# 前言\n* Android开发中，Handler媒介机制十分常用，今天我们来详细聊一聊Handler通讯机制是如何实现的。\n\n# 目录\n\n[![Omb4mt.png](https://s1.ax1x.com/2022/05/05/Omb4mt.png)](https://s1.ax1x.com/2022/05/05/Omb4mt.png)\n\n# 使用场景\n在多线程的应用场景中，将工作线程中需更新UI的操作信息 传递到 UI主线程，从而实现工作线程对UI线程的更新，最终实现异步消息的处理。\n\n# 概念描述\nHandler、Message、MessageQueue、Looper相关概念如下图。\n<!--MarkDown 不支持单元格合并，即使用Html -->\n<table>\n<!--this is title-->\n    <tr align = \"center\" bgcolor = \"#91bdb6\">\n        <td>概念</td>\n        <td>定义</td>\n        <td>作用</td>\n        <!-- <td>备注</td> -->\n    </tr>\n    <!--this is Main-->\n    <tr align=\"center\">\n        <td>主线程<br/><font color = \"#91bdb6\">( UI线程、Main Thread )</font></td>\n        <td>系统首次启动，会创建主线程</td>\n        <td>处理UI相关操作<br/><font color = \"#91bdb6\">( 如：更新UI )</font></td>\n        <!-- <td rowspan=\"2\">主线程与子线程<br/>通讯媒介Handler</td> -->\n    </tr>\n      <!--this is Thread-->\n    <tr align=\"center\">\n        <td>子线程<br/><font color = \"#91bdb6\">（ 工作线程 ）</font></td>\n        <td>人为开启的线程</td>\n        <td>执行耗时任务<br/><font color = \"#91bdb6\">( 如 网络请求、数据加载等 )</font></td>\n    </tr>\n      <!--this is Message-->\n    <tr align=\"center\">\n      <td>消息<br/><font color = \"#91bdb6\">（ Message ）</font></td>\n      <td>线程间通讯数据单元<br/><font color = \"#91bdb6\">（handler接收&处理消息对象）</font></td>\n      <td>存储业务操作信息<br/><font color = \"#91bdb6\">（ Message ）</font></td>\n    </tr>\n      <!--this is Message Queue-->\n    <tr align=\"center\">\n        <td>消息队列<br/><font color = \"#91bdb6\">（ Message Queue ）</font></td>\n        <td>数据结构<br/><font color = \"#91bdb6\">（ 以时间顺序排列 ）</font></td>\n        <td>存储Handler发送的消息<br/><font color = \"#91bdb6\">（ Message ）</font></td>\n    </tr>\n      <!--this is Handler-->\n    <tr align=\"center\">\n        <td>处理着<br/><font color = \"#91bdb6\">（ Handler ）</font></td>\n        <td>主线程与子线程通讯的媒介<br/>线程消息的处理者</td>\n        <td>将消息( Message ）添加到<br/>消息队列( Message Queue )中<br/> 处理循环器（ Looper ）分派的消息</td>\n    </tr>\n    <tr align=\"center\">\n        <td>循环器<br/><font color = \"#91bdb6\">（ Looper ）</font></td>\n        <td>消息队列( Message Queue )<br/>与处理者 （ Handler ）<br/>通讯媒介</td>\n        <td>消息循环 即：<br/><font color = \"#91bdb6\"> 消息获取：循环取出消息队列<br/>（ Message Queue ）中的<br/>消息（ Message ）<br/> 消息分发：将取出来的消息<br/>（ Message ）发送给对应的<br/>处理者（ Handler ）</font></td>\n    </tr>\n</table>\n\n# 机制说明\nHandler消息传递机制:多个线程并发更新UI时，保证线程安全\n[![示例图.png](https://s1.ax1x.com/2022/05/06/OmxK4P.png)](https://s1.ax1x.com/2022/05/06/OmxK4P.png)\n注：[图解Java线程安全](https://juejin.cn/post/6844903890224152584)\n\n# 原理解析\n### 相关概念\n  * 异步通信( 主线程中创建 )\n\n    >> 处理者（ Handler ）对象\n    >>> 注：Handler会自定绑定主线程中的Looper&MessageQueue\n\n    >> 处理器（ Looper ）对象\n      >>> 注：Looper & MessageQueue都是在主线程中\n\n    >> 消息队列（ Message Queue ）对象\n      >>>注： 创建MessageQueue后，Looper会自动进入循环状态，有消息则循环取，没有，则阻塞状态，发现消息后会被唤醒继续循环读取。\n\n  * 消息入队列\n  > 工作线程中通过Handler的sendMessage()方法发送消息（ Message ）到消息队列（ MessageQueue ）中，这是消息完成入队列操作。\n  >> 注：此消息内容就是工作线程对UI主线程的操作\n\n  * 消息循环\n  > 第一步：消息出队列：Looper循环取出消息队列（ MessageQueue ）中的消息（ Message ）交给第二步消息分发。\n  > 第二步：消息分发：Looper将取出来的消息（ Message ）发送给创建消息的处理者（ Handler ）\n  >> 注：循环器( Looper )循环取消息时，若发现消息队列（ MessageQueue ）中为空，则会线程阻塞，待又消息时再次被唤醒继续循环读取。\n\n  * 消息处理\n  >处理者( Handler ) 在接收处理器（ Looper ）发送过来的消息（ Message ）会进行UI操作。\n\n[![示意图.png](https://s1.ax1x.com/2022/05/06/OuFqzR.png)](https://s1.ax1x.com/2022/05/06/OuFqzR.png)\n\n# 总结\nAndroid开发中，UI操作在主线程中进行，但是主线程又不能进行耗时操作，否则会阻塞线程，产生我们常见的ANR异常，所以常常把耗时操作放到其它子线程进行。如果在子线程中需要更新UI，一般是通过 Handler发送消息( message ），主线程接收消息并且进行相应的处理。以上就是Handler通讯消息传递机制的详解。\n\n### <font color=#9dc2af>如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻</font>\n","slug":"Handler-消息通讯机制详解","published":1,"relaxed":"android","updated":"2022-05-07T04:31:38.929Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl2vhlmfw000et6fyfqma6rq4","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><ul>\n<li>Android开发中，Handler媒介机制十分常用，今天我们来详细聊一聊Handler通讯机制是如何实现的。</li>\n</ul>\n<h1 id=\"目录\"><a href=\"#目录\" class=\"headerlink\" title=\"目录\"></a>目录</h1><p><a href=\"https://s1.ax1x.com/2022/05/05/Omb4mt.png\"><img src=\"https://s1.ax1x.com/2022/05/05/Omb4mt.png\" alt=\"Omb4mt.png\"></a></p>\n<h1 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h1><p>在多线程的应用场景中，将工作线程中需更新UI的操作信息 传递到 UI主线程，从而实现工作线程对UI线程的更新，最终实现异步消息的处理。</p>\n<h1 id=\"概念描述\"><a href=\"#概念描述\" class=\"headerlink\" title=\"概念描述\"></a>概念描述</h1><p>Handler、Message、MessageQueue、Looper相关概念如下图。</p>\n<!--MarkDown 不支持单元格合并，即使用Html -->\n<table>\n<!--this is title-->\n    <tr align = \"center\" bgcolor = \"#91bdb6\">\n        <td>概念</td>\n        <td>定义</td>\n        <td>作用</td>\n        <!-- <td>备注</td> -->\n    </tr>\n    <!--this is Main-->\n    <tr align=\"center\">\n        <td>主线程<br/><font color = \"#91bdb6\">( UI线程、Main Thread )</font></td>\n        <td>系统首次启动，会创建主线程</td>\n        <td>处理UI相关操作<br/><font color = \"#91bdb6\">( 如：更新UI )</font></td>\n        <!-- <td rowspan=\"2\">主线程与子线程<br/>通讯媒介Handler</td> -->\n    </tr>\n      <!--this is Thread-->\n    <tr align=\"center\">\n        <td>子线程<br/><font color = \"#91bdb6\">（ 工作线程 ）</font></td>\n        <td>人为开启的线程</td>\n        <td>执行耗时任务<br/><font color = \"#91bdb6\">( 如 网络请求、数据加载等 )</font></td>\n    </tr>\n      <!--this is Message-->\n    <tr align=\"center\">\n      <td>消息<br/><font color = \"#91bdb6\">（ Message ）</font></td>\n      <td>线程间通讯数据单元<br/><font color = \"#91bdb6\">（handler接收&处理消息对象）</font></td>\n      <td>存储业务操作信息<br/><font color = \"#91bdb6\">（ Message ）</font></td>\n    </tr>\n      <!--this is Message Queue-->\n    <tr align=\"center\">\n        <td>消息队列<br/><font color = \"#91bdb6\">（ Message Queue ）</font></td>\n        <td>数据结构<br/><font color = \"#91bdb6\">（ 以时间顺序排列 ）</font></td>\n        <td>存储Handler发送的消息<br/><font color = \"#91bdb6\">（ Message ）</font></td>\n    </tr>\n      <!--this is Handler-->\n    <tr align=\"center\">\n        <td>处理着<br/><font color = \"#91bdb6\">（ Handler ）</font></td>\n        <td>主线程与子线程通讯的媒介<br/>线程消息的处理者</td>\n        <td>将消息( Message ）添加到<br/>消息队列( Message Queue )中<br/> 处理循环器（ Looper ）分派的消息</td>\n    </tr>\n    <tr align=\"center\">\n        <td>循环器<br/><font color = \"#91bdb6\">（ Looper ）</font></td>\n        <td>消息队列( Message Queue )<br/>与处理者 （ Handler ）<br/>通讯媒介</td>\n        <td>消息循环 即：<br/><font color = \"#91bdb6\"> 消息获取：循环取出消息队列<br/>（ Message Queue ）中的<br/>消息（ Message ）<br/> 消息分发：将取出来的消息<br/>（ Message ）发送给对应的<br/>处理者（ Handler ）</font></td>\n    </tr>\n</table>\n\n<h1 id=\"机制说明\"><a href=\"#机制说明\" class=\"headerlink\" title=\"机制说明\"></a>机制说明</h1><p>Handler消息传递机制:多个线程并发更新UI时，保证线程安全<br><a href=\"https://s1.ax1x.com/2022/05/06/OmxK4P.png\"><img src=\"https://s1.ax1x.com/2022/05/06/OmxK4P.png\" alt=\"示例图.png\"></a><br>注：<a href=\"https://juejin.cn/post/6844903890224152584\">图解Java线程安全</a></p>\n<h1 id=\"原理解析\"><a href=\"#原理解析\" class=\"headerlink\" title=\"原理解析\"></a>原理解析</h1><h3 id=\"相关概念\"><a href=\"#相关概念\" class=\"headerlink\" title=\"相关概念\"></a>相关概念</h3><ul>\n<li><p>异步通信( 主线程中创建 )</p>\n<blockquote>\n<blockquote>\n<p>处理者（ Handler ）对象</p>\n<blockquote>\n<p>注：Handler会自定绑定主线程中的Looper&amp;MessageQueue</p>\n</blockquote>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>处理器（ Looper ）对象</p>\n<blockquote>\n<p>注：Looper &amp; MessageQueue都是在主线程中</p>\n</blockquote>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>消息队列（ Message Queue ）对象</p>\n<blockquote>\n<p>注： 创建MessageQueue后，Looper会自动进入循环状态，有消息则循环取，没有，则阻塞状态，发现消息后会被唤醒继续循环读取。</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</li>\n<li><p>消息入队列</p>\n<blockquote>\n<p>工作线程中通过Handler的sendMessage()方法发送消息（ Message ）到消息队列（ MessageQueue ）中，这是消息完成入队列操作。</p>\n<blockquote>\n<p>注：此消息内容就是工作线程对UI主线程的操作</p>\n</blockquote>\n</blockquote>\n</li>\n<li><p>消息循环</p>\n<blockquote>\n<p>第一步：消息出队列：Looper循环取出消息队列（ MessageQueue ）中的消息（ Message ）交给第二步消息分发。<br>第二步：消息分发：Looper将取出来的消息（ Message ）发送给创建消息的处理者（ Handler ）</p>\n<blockquote>\n<p>注：循环器( Looper )循环取消息时，若发现消息队列（ MessageQueue ）中为空，则会线程阻塞，待又消息时再次被唤醒继续循环读取。</p>\n</blockquote>\n</blockquote>\n</li>\n<li><p>消息处理</p>\n<blockquote>\n<p>处理者( Handler ) 在接收处理器（ Looper ）发送过来的消息（ Message ）会进行UI操作。</p>\n</blockquote>\n</li>\n</ul>\n<p><a href=\"https://s1.ax1x.com/2022/05/06/OuFqzR.png\"><img src=\"https://s1.ax1x.com/2022/05/06/OuFqzR.png\" alt=\"示意图.png\"></a></p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>Android开发中，UI操作在主线程中进行，但是主线程又不能进行耗时操作，否则会阻塞线程，产生我们常见的ANR异常，所以常常把耗时操作放到其它子线程进行。如果在子线程中需要更新UI，一般是通过 Handler发送消息( message ），主线程接收消息并且进行相应的处理。以上就是Handler通讯消息传递机制的详解。</p>\n<h3 id=\"如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻\"><a href=\"#如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻\" class=\"headerlink\" title=\"如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻\"></a><font color=#9dc2af>如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻</font></h3>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><ul>\n<li>Android开发中，Handler媒介机制十分常用，今天我们来详细聊一聊Handler通讯机制是如何实现的。</li>\n</ul>\n<h1 id=\"目录\"><a href=\"#目录\" class=\"headerlink\" title=\"目录\"></a>目录</h1><p><a href=\"https://s1.ax1x.com/2022/05/05/Omb4mt.png\"><img src=\"https://s1.ax1x.com/2022/05/05/Omb4mt.png\" alt=\"Omb4mt.png\"></a></p>\n<h1 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h1><p>在多线程的应用场景中，将工作线程中需更新UI的操作信息 传递到 UI主线程，从而实现工作线程对UI线程的更新，最终实现异步消息的处理。</p>\n<h1 id=\"概念描述\"><a href=\"#概念描述\" class=\"headerlink\" title=\"概念描述\"></a>概念描述</h1><p>Handler、Message、MessageQueue、Looper相关概念如下图。</p>\n<!--MarkDown 不支持单元格合并，即使用Html -->\n<table>\n<!--this is title-->\n    <tr align = \"center\" bgcolor = \"#91bdb6\">\n        <td>概念</td>\n        <td>定义</td>\n        <td>作用</td>\n        <!-- <td>备注</td> -->\n    </tr>\n    <!--this is Main-->\n    <tr align=\"center\">\n        <td>主线程<br/><font color = \"#91bdb6\">( UI线程、Main Thread )</font></td>\n        <td>系统首次启动，会创建主线程</td>\n        <td>处理UI相关操作<br/><font color = \"#91bdb6\">( 如：更新UI )</font></td>\n        <!-- <td rowspan=\"2\">主线程与子线程<br/>通讯媒介Handler</td> -->\n    </tr>\n      <!--this is Thread-->\n    <tr align=\"center\">\n        <td>子线程<br/><font color = \"#91bdb6\">（ 工作线程 ）</font></td>\n        <td>人为开启的线程</td>\n        <td>执行耗时任务<br/><font color = \"#91bdb6\">( 如 网络请求、数据加载等 )</font></td>\n    </tr>\n      <!--this is Message-->\n    <tr align=\"center\">\n      <td>消息<br/><font color = \"#91bdb6\">（ Message ）</font></td>\n      <td>线程间通讯数据单元<br/><font color = \"#91bdb6\">（handler接收&处理消息对象）</font></td>\n      <td>存储业务操作信息<br/><font color = \"#91bdb6\">（ Message ）</font></td>\n    </tr>\n      <!--this is Message Queue-->\n    <tr align=\"center\">\n        <td>消息队列<br/><font color = \"#91bdb6\">（ Message Queue ）</font></td>\n        <td>数据结构<br/><font color = \"#91bdb6\">（ 以时间顺序排列 ）</font></td>\n        <td>存储Handler发送的消息<br/><font color = \"#91bdb6\">（ Message ）</font></td>\n    </tr>\n      <!--this is Handler-->\n    <tr align=\"center\">\n        <td>处理着<br/><font color = \"#91bdb6\">（ Handler ）</font></td>\n        <td>主线程与子线程通讯的媒介<br/>线程消息的处理者</td>\n        <td>将消息( Message ）添加到<br/>消息队列( Message Queue )中<br/> 处理循环器（ Looper ）分派的消息</td>\n    </tr>\n    <tr align=\"center\">\n        <td>循环器<br/><font color = \"#91bdb6\">（ Looper ）</font></td>\n        <td>消息队列( Message Queue )<br/>与处理者 （ Handler ）<br/>通讯媒介</td>\n        <td>消息循环 即：<br/><font color = \"#91bdb6\"> 消息获取：循环取出消息队列<br/>（ Message Queue ）中的<br/>消息（ Message ）<br/> 消息分发：将取出来的消息<br/>（ Message ）发送给对应的<br/>处理者（ Handler ）</font></td>\n    </tr>\n</table>\n\n<h1 id=\"机制说明\"><a href=\"#机制说明\" class=\"headerlink\" title=\"机制说明\"></a>机制说明</h1><p>Handler消息传递机制:多个线程并发更新UI时，保证线程安全<br><a href=\"https://s1.ax1x.com/2022/05/06/OmxK4P.png\"><img src=\"https://s1.ax1x.com/2022/05/06/OmxK4P.png\" alt=\"示例图.png\"></a><br>注：<a href=\"https://juejin.cn/post/6844903890224152584\">图解Java线程安全</a></p>\n<h1 id=\"原理解析\"><a href=\"#原理解析\" class=\"headerlink\" title=\"原理解析\"></a>原理解析</h1><h3 id=\"相关概念\"><a href=\"#相关概念\" class=\"headerlink\" title=\"相关概念\"></a>相关概念</h3><ul>\n<li><p>异步通信( 主线程中创建 )</p>\n<blockquote>\n<blockquote>\n<p>处理者（ Handler ）对象</p>\n<blockquote>\n<p>注：Handler会自定绑定主线程中的Looper&amp;MessageQueue</p>\n</blockquote>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>处理器（ Looper ）对象</p>\n<blockquote>\n<p>注：Looper &amp; MessageQueue都是在主线程中</p>\n</blockquote>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>消息队列（ Message Queue ）对象</p>\n<blockquote>\n<p>注： 创建MessageQueue后，Looper会自动进入循环状态，有消息则循环取，没有，则阻塞状态，发现消息后会被唤醒继续循环读取。</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</li>\n<li><p>消息入队列</p>\n<blockquote>\n<p>工作线程中通过Handler的sendMessage()方法发送消息（ Message ）到消息队列（ MessageQueue ）中，这是消息完成入队列操作。</p>\n<blockquote>\n<p>注：此消息内容就是工作线程对UI主线程的操作</p>\n</blockquote>\n</blockquote>\n</li>\n<li><p>消息循环</p>\n<blockquote>\n<p>第一步：消息出队列：Looper循环取出消息队列（ MessageQueue ）中的消息（ Message ）交给第二步消息分发。<br>第二步：消息分发：Looper将取出来的消息（ Message ）发送给创建消息的处理者（ Handler ）</p>\n<blockquote>\n<p>注：循环器( Looper )循环取消息时，若发现消息队列（ MessageQueue ）中为空，则会线程阻塞，待又消息时再次被唤醒继续循环读取。</p>\n</blockquote>\n</blockquote>\n</li>\n<li><p>消息处理</p>\n<blockquote>\n<p>处理者( Handler ) 在接收处理器（ Looper ）发送过来的消息（ Message ）会进行UI操作。</p>\n</blockquote>\n</li>\n</ul>\n<p><a href=\"https://s1.ax1x.com/2022/05/06/OuFqzR.png\"><img src=\"https://s1.ax1x.com/2022/05/06/OuFqzR.png\" alt=\"示意图.png\"></a></p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>Android开发中，UI操作在主线程中进行，但是主线程又不能进行耗时操作，否则会阻塞线程，产生我们常见的ANR异常，所以常常把耗时操作放到其它子线程进行。如果在子线程中需要更新UI，一般是通过 Handler发送消息( message ），主线程接收消息并且进行相应的处理。以上就是Handler通讯消息传递机制的详解。</p>\n<h3 id=\"如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻\"><a href=\"#如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻\" class=\"headerlink\" title=\"如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻\"></a><font color=#9dc2af>如果觉得此文章对你有所帮助，👍🏻请点个赞👍🏻</font></h3>"},{"title":"LinkedHashMap-原理分析","date":"2022-03-23T15:40:39.000Z","cover":"https://s1.ax1x.com/2022/03/23/q3c9JI.jpg","_content":"## 前言：\n\nLinkedHashMap 是如何做到LruCache ，下面我们从源码中看一看\n\n## LinkedHashMap构造函数\n```java\n/**\n     * Constructs an empty insertion-ordered <tt>LinkedHashMap</tt> instance\n     * with the specified initial capacity and load factor.\n     *\n     * @param  initialCapacity the initial capacity\n     * @param  loadFactor      the load factor\n     * @throws IllegalArgumentException if the initial capacity is negative\n     *         or the load factor is nonpositive\n     */\n    public LinkedHashMap(int initialCapacity, float loadFactor) {\n        super(initialCapacity, loadFactor);\n        accessOrder = false;\n    }\n\n    /**\n     * Constructs an empty insertion-ordered <tt>LinkedHashMap</tt> instance\n     * with the specified initial capacity and a default load factor (0.75).\n     *\n     * @param  initialCapacity the initial capacity\n     * @throws IllegalArgumentException if the initial capacity is negative\n     */\n    public LinkedHashMap(int initialCapacity) {\n        super(initialCapacity);\n        accessOrder = false;\n    }\n\n    /**\n     * Constructs an empty insertion-ordered <tt>LinkedHashMap</tt> instance\n     * with the default initial capacity (16) and load factor (0.75).\n     */\n    public LinkedHashMap() {\n        super();\n        accessOrder = false;\n    }\n\n    /**\n     * Constructs an insertion-ordered <tt>LinkedHashMap</tt> instance with\n     * the same mappings as the specified map.  The <tt>LinkedHashMap</tt>\n     * instance is created with a default load factor (0.75) and an initial\n     * capacity sufficient to hold the mappings in the specified map.\n     *\n     * @param  m the map whose mappings are to be placed in this map\n     * @throws NullPointerException if the specified map is null\n     */\n    public LinkedHashMap(Map<? extends K, ? extends V> m) {\n        super();\n        accessOrder = false;\n        putMapEntries(m, false);\n    }\n\n    /**\n     * Constructs an empty <tt>LinkedHashMap</tt> instance with the\n     * specified initial capacity, load factor and ordering mode.\n     *\n     * @param  initialCapacity the initial capacity\n     * @param  loadFactor      the load factor\n     * @param  accessOrder     the ordering mode - <tt>true</tt> for\n     *         access-order, <tt>false</tt> for insertion-order\n     * @throws IllegalArgumentException if the initial capacity is negative\n     *         or the load factor is nonpositive\n     */\n    public LinkedHashMap(int initialCapacity,\n                         float loadFactor,\n                         boolean accessOrder) {\n        super(initialCapacity, loadFactor);\n        this.accessOrder = accessOrder;\n    }\n```\n\n先分别看下这三个参数：int initialCapacity、float loadFactor, boolean accessOrder\n\ninitialCapacity：表示是初始数组长度\n\nloadFactor：表示负载因子，表示数组的元素数量/数组长度超过这个比例，数组就要扩容\n\naccessOrder：false： 基于插入顺序(默认) true： 基于访问顺序\n\n关于插入顺序，访问顺序可以看我的另一篇文章： {% post_link java-链表 java链表(单向，循环、双向)%}\n\n下面看下LinkedHashMap 最常用的get，put 以及afterNodeAccess、afterNodeInsertion方法\n\n## get\n\nLinkedHashMap 重写了get方法，实现了LrucaChe\n```java\n/**Returns the value to which the specified key is mapped, or null if this map contains no mapping for the key.\nMore formally, if this map contains a mapping from a key k to a value v such that (key==null ? k==null : key.equals(k)), then this method returns v; otherwise it returns null. (There can be at most one such mapping.)\nA return value of null does not necessarily indicate that the map contains no mapping for the key; it's also possible that the map explicitly maps the key to null. The containsKey operation may be used to distinguish these two cases*/\n<P>\n返回指定键映射到的值，如果此映射不包含该键的映射，则返回null。\n更正式地说，如果这个映射包含从键k到值v的映射，使得（键==null？k==null:key.equals（k）），那么这个方法返回v；否则返回null。（最多可以有一个这样的映射。）\n空映射不一定包含空映射的返回值；映射也可能显式地将密钥映射为null。containsKey操作可用于区分这两种情况\n</p>\npublic V get(Object key) {\n        Node<K,V> e;\n        if ((e = getNode(hash(key), key)) == null)\n            return null;\n        // accessOder为true时，被访问的节点被置于双向链表尾部\n        if (accessOrder)\n            afterNodeAccess(e);\n        return e.value;\n    }\n\n/**Returns the value to which the specified key is mapped, or defaultValue if this map contains no mapping for the key.*/\n<p>返回指定键映射到的值，如果此映射不包含该键的映射，则返回defaultValue。</p>\n\n  public V getOrDefault(Object key, V defaultValue) {\n       Node<K,V> e;\n       if ((e = getNode(hash(key), key)) == null)\n           return defaultValue;\n       if (accessOrder)\n           afterNodeAccess(e);\n       return e.value;\n   }\n```\n可以看到在get 方法中调用了afterNodeAccess方法，下面看下这个方法干了什么\n\n## afterNodeAccess\n```java\nvoid afterNodeAccess(Node<K,V> e) { // move node to last\n    // 用 last 表示插入 e 前的尾节点\n    // 插入 e 后 e 是尾节点, 所以也是表示 e 的前一个节点\n    LinkedHashMap.Entry<K,V> last;\n    //如果是访问序，且当前节点并不是尾节点\n    //将该节点置为双向链表的尾部\n    if (accessOrder && (last = tail) != e) {\n        // p: 当前节点\n        // b: 前一个节点\n        // a: 后一个节点\n        LinkedHashMap.Entry<K,V> p =\n            (LinkedHashMap.Entry<K,V>)e, b = p.before, a = p.after;\n        // 因为要移动到链尾，所以先至尾指针为空\n        p.after = null;\n\n        //如果前面没有元素，则p之前为头结点，直接让a成为头结点\n        if (b == null)\n            head = a;\n        // 否则b的尾指针指向a\n        else\n            b.after = a;\n\n        if (a != null)\n        //如果a不为空，则a的头指针指向b\n            a.before = b;\n        else\n        //否则 p之前就为尾指针，则另b成为尾指针\n            last = b;\n\n        if (last == null)\n            head = p;\n        //如果双向链表中只有p一个节点，则令p即为头结点，也为尾节点\n        else {\n        //否则 将p插入链尾\n            p.before = last;\n            last.after = p;\n        }\n        tail = p;\n        ++modCount;\n    }\n}\n```\n## put\n\nLinkedHashMap 并没有重写HashMap的 put 方法，调用的还是HashMap得put方法\n```java\n/**\n     * Associates the specified value with the specified key in this map.\n     * If the map previously contained a mapping for the key, the old\n     * value is replaced.\n     *\n     * @param key key with which the specified value is to be associated\n     * @param value value to be associated with the specified key\n     * @return the previous value associated with <tt>key</tt>, or\n     *         <tt>null</tt> if there was no mapping for <tt>key</tt>.\n     *         (A <tt>null</tt> return can also indicate that the map\n     *         previously associated <tt>null</tt> with <tt>key</tt>.)\n     */\n    public V put(K key, V value) {\n        return putVal(hash(key), key, value, false, true);\n    }\n\n    /**\n     * Implements Map.put and related methods.\n     *\n     * @param hash hash for key\n     * @param key the key\n     * @param value the value to put\n     * @param onlyIfAbsent if true, don't change existing value\n     * @param evict if false, the table is in creation mode.\n     * @return previous value, or null if none\n     */\n    final V putVal(int hash, K key, V value, boolean onlyIfAbsent,\n                   boolean evict) {\n        Node<K,V>[] tab; Node<K,V> p; int n, i;\n        if ((tab = table) == null || (n = tab.length) == 0)\n            n = (tab = resize()).length;\n        if ((p = tab[i = (n - 1) & hash]) == null)\n            tab[i] = newNode(hash, key, value, null);\n        else {\n            Node<K,V> e; K k;\n            if (p.hash == hash &&\n                ((k = p.key) == key || (key != null && key.equals(k))))\n                e = p;\n            else if (p instanceof TreeNode)\n                e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);\n            else {\n                for (int binCount = 0; ; ++binCount) {\n                    if ((e = p.next) == null) {\n                        p.next = newNode(hash, key, value, null);\n                        if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st\n                            treeifyBin(tab, hash);\n                        break;\n                    }\n                    if (e.hash == hash &&\n                        ((k = e.key) == key || (key != null && key.equals(k))))\n                        break;\n                    p = e;\n                }\n            }\n            if (e != null) { // existing mapping for key\n                V oldValue = e.value;\n                if (!onlyIfAbsent || oldValue == null)\n                    e.value = value;\n                afterNodeAccess(e);\n                return oldValue;\n            }\n        }\n        ++modCount;\n        if (++size > threshold)\n            resize();\n        afterNodeInsertion(evict);\n        return null;\n    }\n```\n此外HashMap的putVal()方法，还调用了afterNodeInsertion()方法，\n\n## afterNodeInsertion\n\n当插入数据时，将双向链表的头结点移除，这几个方法让LinkedHashMap实现了LRU算法。不过removeEldestEntry()默认是返回false的，需要子类继承重写removeEldestEntry()方法。\n```java\nvoid afterNodeInsertion(boolean evict) { // possibly remove eldest\n        LinkedHashMap.Entry<K,V> first;\n        if (evict && (first = head) != null && removeEldestEntry(first)) {\n            K key = first.key;\n            removeNode(hash(key), key, null, false, true);\n        }\n    }\n```\n\nLinkedHashMap的remove()方法也是调用的HashMap的remove()方法，\n```java\n/**\n     * Removes the mapping for the specified key from this map if present.\n     *\n     * @param  key key whose mapping is to be removed from the map\n     * @return the previous value associated with <tt>key</tt>, or\n     *         <tt>null</tt> if there was no mapping for <tt>key</tt>.\n     *         (A <tt>null</tt> return can also indicate that the map\n     *         previously associated <tt>null</tt> with <tt>key</tt>.)\n     */\n    public V remove(Object key) {\n        Node<K,V> e;\n        return (e = removeNode(hashLkey), key, null, false, true)) == null ?\n            null : e.value;\n    }\n\n\n/**\n     * Implements Map.remove and related methods.\n     *\n     * @param hash hash for key\n     * @param key the key\n     * @param value the value to match if matchValue, else ignored\n     * @param matchValue if true only remove if value is equal\n     * @param movable if false do not move other nodes while removing\n     * @return the node, or null if none\n     */\n    final Node<K,V> removeNode(int hash, Object key, Object value,\n                               boolean matchValue, boolean movable) {\n        Node<K,V>[] tab; Node<K,V> p; int n, index;\n        if ((tab = table) != null && (n = tab.length) > 0 &&\n            (p = tab[index = (n - 1) & hash]) != null) {\n            Node<K,V> node = null, e; K k; V v;\n            if (p.hash == hash &&\n                ((k = p.key) == key || (key != null && key.equals(k))))\n                node = p;\n            else if ((e = p.next) != null) {\n                if (p instanceof TreeNode)\n                    node = ((TreeNode<K,V>)p).getTreeNode(hash, key);\n                else {\n                    do {\n                        if (e.hash == hash &&\n                            ((k = e.key) == key ||\n                             (key != null && key.equals(k)))) {\n                            node = e;\n                            break;\n                        }\n                        p = e;\n                    } while ((e = e.next) != null);\n                }\n            }\n            if (node != null && (!matchValue || (v = node.value) == value ||\n                                 (value != null && value.equals(v)))) {\n                if (node instanceof TreeNode)\n                    ((TreeNode<K,V>)node).removeTreeNode(this, tab, movable);\n                else if (node == p)\n                    tab[index] = node.next;\n                else\n                    p.next = node.next;\n                ++modCount;\n                --size;\n                afterNodeRemoval(node);\n                return node;\n            }\n        }\n        return null;\n    }\n```\n\n总结：\n\n*   LinkedHashMap 继承 HashMap，拥有 HashMap 的功能\n*   LinkedHashMap 维护了两个数据结构，一是 HashMap 的结构，二是用来做迭代的双向链表\n*   LinkedHashMap 独特的迭代器设计和一些函数的重写，导致迭代器按双向链表迭代，并且若没有设置 accessOrder，则按插入顺序迭代，否则，按访问顺序迭代\n*   通过重写removeEldestEntry可以实现 LruCache 的功能\n","source":"_posts/2022/java/LinkedHashMap-原理分析.md","raw":"---\ntitle: LinkedHashMap-原理分析\ndate: 2022-03-23 23:40:39\ncategories:\n - Java\ntags:\n - Java\ncover: https://s1.ax1x.com/2022/03/23/q3c9JI.jpg\n---\n## 前言：\n\nLinkedHashMap 是如何做到LruCache ，下面我们从源码中看一看\n\n## LinkedHashMap构造函数\n```java\n/**\n     * Constructs an empty insertion-ordered <tt>LinkedHashMap</tt> instance\n     * with the specified initial capacity and load factor.\n     *\n     * @param  initialCapacity the initial capacity\n     * @param  loadFactor      the load factor\n     * @throws IllegalArgumentException if the initial capacity is negative\n     *         or the load factor is nonpositive\n     */\n    public LinkedHashMap(int initialCapacity, float loadFactor) {\n        super(initialCapacity, loadFactor);\n        accessOrder = false;\n    }\n\n    /**\n     * Constructs an empty insertion-ordered <tt>LinkedHashMap</tt> instance\n     * with the specified initial capacity and a default load factor (0.75).\n     *\n     * @param  initialCapacity the initial capacity\n     * @throws IllegalArgumentException if the initial capacity is negative\n     */\n    public LinkedHashMap(int initialCapacity) {\n        super(initialCapacity);\n        accessOrder = false;\n    }\n\n    /**\n     * Constructs an empty insertion-ordered <tt>LinkedHashMap</tt> instance\n     * with the default initial capacity (16) and load factor (0.75).\n     */\n    public LinkedHashMap() {\n        super();\n        accessOrder = false;\n    }\n\n    /**\n     * Constructs an insertion-ordered <tt>LinkedHashMap</tt> instance with\n     * the same mappings as the specified map.  The <tt>LinkedHashMap</tt>\n     * instance is created with a default load factor (0.75) and an initial\n     * capacity sufficient to hold the mappings in the specified map.\n     *\n     * @param  m the map whose mappings are to be placed in this map\n     * @throws NullPointerException if the specified map is null\n     */\n    public LinkedHashMap(Map<? extends K, ? extends V> m) {\n        super();\n        accessOrder = false;\n        putMapEntries(m, false);\n    }\n\n    /**\n     * Constructs an empty <tt>LinkedHashMap</tt> instance with the\n     * specified initial capacity, load factor and ordering mode.\n     *\n     * @param  initialCapacity the initial capacity\n     * @param  loadFactor      the load factor\n     * @param  accessOrder     the ordering mode - <tt>true</tt> for\n     *         access-order, <tt>false</tt> for insertion-order\n     * @throws IllegalArgumentException if the initial capacity is negative\n     *         or the load factor is nonpositive\n     */\n    public LinkedHashMap(int initialCapacity,\n                         float loadFactor,\n                         boolean accessOrder) {\n        super(initialCapacity, loadFactor);\n        this.accessOrder = accessOrder;\n    }\n```\n\n先分别看下这三个参数：int initialCapacity、float loadFactor, boolean accessOrder\n\ninitialCapacity：表示是初始数组长度\n\nloadFactor：表示负载因子，表示数组的元素数量/数组长度超过这个比例，数组就要扩容\n\naccessOrder：false： 基于插入顺序(默认) true： 基于访问顺序\n\n关于插入顺序，访问顺序可以看我的另一篇文章： {% post_link java-链表 java链表(单向，循环、双向)%}\n\n下面看下LinkedHashMap 最常用的get，put 以及afterNodeAccess、afterNodeInsertion方法\n\n## get\n\nLinkedHashMap 重写了get方法，实现了LrucaChe\n```java\n/**Returns the value to which the specified key is mapped, or null if this map contains no mapping for the key.\nMore formally, if this map contains a mapping from a key k to a value v such that (key==null ? k==null : key.equals(k)), then this method returns v; otherwise it returns null. (There can be at most one such mapping.)\nA return value of null does not necessarily indicate that the map contains no mapping for the key; it's also possible that the map explicitly maps the key to null. The containsKey operation may be used to distinguish these two cases*/\n<P>\n返回指定键映射到的值，如果此映射不包含该键的映射，则返回null。\n更正式地说，如果这个映射包含从键k到值v的映射，使得（键==null？k==null:key.equals（k）），那么这个方法返回v；否则返回null。（最多可以有一个这样的映射。）\n空映射不一定包含空映射的返回值；映射也可能显式地将密钥映射为null。containsKey操作可用于区分这两种情况\n</p>\npublic V get(Object key) {\n        Node<K,V> e;\n        if ((e = getNode(hash(key), key)) == null)\n            return null;\n        // accessOder为true时，被访问的节点被置于双向链表尾部\n        if (accessOrder)\n            afterNodeAccess(e);\n        return e.value;\n    }\n\n/**Returns the value to which the specified key is mapped, or defaultValue if this map contains no mapping for the key.*/\n<p>返回指定键映射到的值，如果此映射不包含该键的映射，则返回defaultValue。</p>\n\n  public V getOrDefault(Object key, V defaultValue) {\n       Node<K,V> e;\n       if ((e = getNode(hash(key), key)) == null)\n           return defaultValue;\n       if (accessOrder)\n           afterNodeAccess(e);\n       return e.value;\n   }\n```\n可以看到在get 方法中调用了afterNodeAccess方法，下面看下这个方法干了什么\n\n## afterNodeAccess\n```java\nvoid afterNodeAccess(Node<K,V> e) { // move node to last\n    // 用 last 表示插入 e 前的尾节点\n    // 插入 e 后 e 是尾节点, 所以也是表示 e 的前一个节点\n    LinkedHashMap.Entry<K,V> last;\n    //如果是访问序，且当前节点并不是尾节点\n    //将该节点置为双向链表的尾部\n    if (accessOrder && (last = tail) != e) {\n        // p: 当前节点\n        // b: 前一个节点\n        // a: 后一个节点\n        LinkedHashMap.Entry<K,V> p =\n            (LinkedHashMap.Entry<K,V>)e, b = p.before, a = p.after;\n        // 因为要移动到链尾，所以先至尾指针为空\n        p.after = null;\n\n        //如果前面没有元素，则p之前为头结点，直接让a成为头结点\n        if (b == null)\n            head = a;\n        // 否则b的尾指针指向a\n        else\n            b.after = a;\n\n        if (a != null)\n        //如果a不为空，则a的头指针指向b\n            a.before = b;\n        else\n        //否则 p之前就为尾指针，则另b成为尾指针\n            last = b;\n\n        if (last == null)\n            head = p;\n        //如果双向链表中只有p一个节点，则令p即为头结点，也为尾节点\n        else {\n        //否则 将p插入链尾\n            p.before = last;\n            last.after = p;\n        }\n        tail = p;\n        ++modCount;\n    }\n}\n```\n## put\n\nLinkedHashMap 并没有重写HashMap的 put 方法，调用的还是HashMap得put方法\n```java\n/**\n     * Associates the specified value with the specified key in this map.\n     * If the map previously contained a mapping for the key, the old\n     * value is replaced.\n     *\n     * @param key key with which the specified value is to be associated\n     * @param value value to be associated with the specified key\n     * @return the previous value associated with <tt>key</tt>, or\n     *         <tt>null</tt> if there was no mapping for <tt>key</tt>.\n     *         (A <tt>null</tt> return can also indicate that the map\n     *         previously associated <tt>null</tt> with <tt>key</tt>.)\n     */\n    public V put(K key, V value) {\n        return putVal(hash(key), key, value, false, true);\n    }\n\n    /**\n     * Implements Map.put and related methods.\n     *\n     * @param hash hash for key\n     * @param key the key\n     * @param value the value to put\n     * @param onlyIfAbsent if true, don't change existing value\n     * @param evict if false, the table is in creation mode.\n     * @return previous value, or null if none\n     */\n    final V putVal(int hash, K key, V value, boolean onlyIfAbsent,\n                   boolean evict) {\n        Node<K,V>[] tab; Node<K,V> p; int n, i;\n        if ((tab = table) == null || (n = tab.length) == 0)\n            n = (tab = resize()).length;\n        if ((p = tab[i = (n - 1) & hash]) == null)\n            tab[i] = newNode(hash, key, value, null);\n        else {\n            Node<K,V> e; K k;\n            if (p.hash == hash &&\n                ((k = p.key) == key || (key != null && key.equals(k))))\n                e = p;\n            else if (p instanceof TreeNode)\n                e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);\n            else {\n                for (int binCount = 0; ; ++binCount) {\n                    if ((e = p.next) == null) {\n                        p.next = newNode(hash, key, value, null);\n                        if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st\n                            treeifyBin(tab, hash);\n                        break;\n                    }\n                    if (e.hash == hash &&\n                        ((k = e.key) == key || (key != null && key.equals(k))))\n                        break;\n                    p = e;\n                }\n            }\n            if (e != null) { // existing mapping for key\n                V oldValue = e.value;\n                if (!onlyIfAbsent || oldValue == null)\n                    e.value = value;\n                afterNodeAccess(e);\n                return oldValue;\n            }\n        }\n        ++modCount;\n        if (++size > threshold)\n            resize();\n        afterNodeInsertion(evict);\n        return null;\n    }\n```\n此外HashMap的putVal()方法，还调用了afterNodeInsertion()方法，\n\n## afterNodeInsertion\n\n当插入数据时，将双向链表的头结点移除，这几个方法让LinkedHashMap实现了LRU算法。不过removeEldestEntry()默认是返回false的，需要子类继承重写removeEldestEntry()方法。\n```java\nvoid afterNodeInsertion(boolean evict) { // possibly remove eldest\n        LinkedHashMap.Entry<K,V> first;\n        if (evict && (first = head) != null && removeEldestEntry(first)) {\n            K key = first.key;\n            removeNode(hash(key), key, null, false, true);\n        }\n    }\n```\n\nLinkedHashMap的remove()方法也是调用的HashMap的remove()方法，\n```java\n/**\n     * Removes the mapping for the specified key from this map if present.\n     *\n     * @param  key key whose mapping is to be removed from the map\n     * @return the previous value associated with <tt>key</tt>, or\n     *         <tt>null</tt> if there was no mapping for <tt>key</tt>.\n     *         (A <tt>null</tt> return can also indicate that the map\n     *         previously associated <tt>null</tt> with <tt>key</tt>.)\n     */\n    public V remove(Object key) {\n        Node<K,V> e;\n        return (e = removeNode(hashLkey), key, null, false, true)) == null ?\n            null : e.value;\n    }\n\n\n/**\n     * Implements Map.remove and related methods.\n     *\n     * @param hash hash for key\n     * @param key the key\n     * @param value the value to match if matchValue, else ignored\n     * @param matchValue if true only remove if value is equal\n     * @param movable if false do not move other nodes while removing\n     * @return the node, or null if none\n     */\n    final Node<K,V> removeNode(int hash, Object key, Object value,\n                               boolean matchValue, boolean movable) {\n        Node<K,V>[] tab; Node<K,V> p; int n, index;\n        if ((tab = table) != null && (n = tab.length) > 0 &&\n            (p = tab[index = (n - 1) & hash]) != null) {\n            Node<K,V> node = null, e; K k; V v;\n            if (p.hash == hash &&\n                ((k = p.key) == key || (key != null && key.equals(k))))\n                node = p;\n            else if ((e = p.next) != null) {\n                if (p instanceof TreeNode)\n                    node = ((TreeNode<K,V>)p).getTreeNode(hash, key);\n                else {\n                    do {\n                        if (e.hash == hash &&\n                            ((k = e.key) == key ||\n                             (key != null && key.equals(k)))) {\n                            node = e;\n                            break;\n                        }\n                        p = e;\n                    } while ((e = e.next) != null);\n                }\n            }\n            if (node != null && (!matchValue || (v = node.value) == value ||\n                                 (value != null && value.equals(v)))) {\n                if (node instanceof TreeNode)\n                    ((TreeNode<K,V>)node).removeTreeNode(this, tab, movable);\n                else if (node == p)\n                    tab[index] = node.next;\n                else\n                    p.next = node.next;\n                ++modCount;\n                --size;\n                afterNodeRemoval(node);\n                return node;\n            }\n        }\n        return null;\n    }\n```\n\n总结：\n\n*   LinkedHashMap 继承 HashMap，拥有 HashMap 的功能\n*   LinkedHashMap 维护了两个数据结构，一是 HashMap 的结构，二是用来做迭代的双向链表\n*   LinkedHashMap 独特的迭代器设计和一些函数的重写，导致迭代器按双向链表迭代，并且若没有设置 accessOrder，则按插入顺序迭代，否则，按访问顺序迭代\n*   通过重写removeEldestEntry可以实现 LruCache 的功能\n","slug":"LinkedHashMap-原理分析","published":1,"relaxed":"java","updated":"2022-03-24T01:48:11.041Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl2vhlmfx000ft6fy1sam8s86","content":"<h2 id=\"前言：\"><a href=\"#前言：\" class=\"headerlink\" title=\"前言：\"></a>前言：</h2><p>LinkedHashMap 是如何做到LruCache ，下面我们从源码中看一看</p>\n<h2 id=\"LinkedHashMap构造函数\"><a href=\"#LinkedHashMap构造函数\" class=\"headerlink\" title=\"LinkedHashMap构造函数\"></a>LinkedHashMap构造函数</h2><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Constructs an empty insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance</span></span><br><span class=\"line\"><span class=\"comment\">     * with the specified initial capacity and load factor.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  initialCapacity the initial capacity</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  loadFactor      the load factor</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IllegalArgumentException if the initial capacity is negative</span></span><br><span class=\"line\"><span class=\"comment\">     *         or the load factor is nonpositive</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LinkedHashMap</span><span class=\"params\">(<span class=\"type\">int</span> initialCapacity, <span class=\"type\">float</span> loadFactor)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(initialCapacity, loadFactor);</span><br><span class=\"line\">        accessOrder = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Constructs an empty insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance</span></span><br><span class=\"line\"><span class=\"comment\">     * with the specified initial capacity and a default load factor (0.75).</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  initialCapacity the initial capacity</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IllegalArgumentException if the initial capacity is negative</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LinkedHashMap</span><span class=\"params\">(<span class=\"type\">int</span> initialCapacity)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(initialCapacity);</span><br><span class=\"line\">        accessOrder = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Constructs an empty insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance</span></span><br><span class=\"line\"><span class=\"comment\">     * with the default initial capacity (16) and load factor (0.75).</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LinkedHashMap</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>();</span><br><span class=\"line\">        accessOrder = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Constructs an insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance with</span></span><br><span class=\"line\"><span class=\"comment\">     * the same mappings as the specified map.  The &lt;tt&gt;LinkedHashMap&lt;/tt&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * instance is created with a default load factor (0.75) and an initial</span></span><br><span class=\"line\"><span class=\"comment\">     * capacity sufficient to hold the mappings in the specified map.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  m the map whose mappings are to be placed in this map</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> NullPointerException if the specified map is null</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LinkedHashMap</span><span class=\"params\">(Map&lt;? extends K, ? extends V&gt; m)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>();</span><br><span class=\"line\">        accessOrder = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        putMapEntries(m, <span class=\"literal\">false</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Constructs an empty &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance with the</span></span><br><span class=\"line\"><span class=\"comment\">     * specified initial capacity, load factor and ordering mode.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  initialCapacity the initial capacity</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  loadFactor      the load factor</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  accessOrder     the ordering mode - &lt;tt&gt;true&lt;/tt&gt; for</span></span><br><span class=\"line\"><span class=\"comment\">     *         access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IllegalArgumentException if the initial capacity is negative</span></span><br><span class=\"line\"><span class=\"comment\">     *         or the load factor is nonpositive</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LinkedHashMap</span><span class=\"params\">(<span class=\"type\">int</span> initialCapacity,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"type\">float</span> loadFactor,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"type\">boolean</span> accessOrder)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(initialCapacity, loadFactor);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.accessOrder = accessOrder;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>先分别看下这三个参数：int initialCapacity、float loadFactor, boolean accessOrder</p>\n<p>initialCapacity：表示是初始数组长度</p>\n<p>loadFactor：表示负载因子，表示数组的元素数量/数组长度超过这个比例，数组就要扩容</p>\n<p>accessOrder：false： 基于插入顺序(默认) true： 基于访问顺序</p>\n<p>关于插入顺序，访问顺序可以看我的另一篇文章： <a href=\"/relaxed/java-%E9%93%BE%E8%A1%A8/\" title=\"java链表(单向，循环、双向)\">java链表(单向，循环、双向)</a></p>\n<p>下面看下LinkedHashMap 最常用的get，put 以及afterNodeAccess、afterNodeInsertion方法</p>\n<h2 id=\"get\"><a href=\"#get\" class=\"headerlink\" title=\"get\"></a>get</h2><p>LinkedHashMap 重写了get方法，实现了LrucaChe</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**Returns the value to which the specified key is mapped, or null if this map contains no mapping for the key.</span></span><br><span class=\"line\"><span class=\"comment\">More formally, if this map contains a mapping from a key k to a value v such that (key==null ? k==null : key.equals(k)), then this method returns v; otherwise it returns null. (There can be at most one such mapping.)</span></span><br><span class=\"line\"><span class=\"comment\">A return value of null does not necessarily indicate that the map contains no mapping for the key; it&#x27;s also possible that the map explicitly maps the key to null. The containsKey operation may be used to distinguish these two cases*/</span></span><br><span class=\"line\">&lt;P&gt;</span><br><span class=\"line\">返回指定键映射到的值，如果此映射不包含该键的映射，则返回<span class=\"literal\">null</span>。</span><br><span class=\"line\">更正式地说，如果这个映射包含从键k到值v的映射，使得（键==<span class=\"literal\">null</span>？k==<span class=\"literal\">null</span>:key.equals（k）），那么这个方法返回v；否则返回<span class=\"literal\">null</span>。（最多可以有一个这样的映射。）</span><br><span class=\"line\">空映射不一定包含空映射的返回值；映射也可能显式地将密钥映射为<span class=\"literal\">null</span>。containsKey操作可用于区分这两种情况</span><br><span class=\"line\">&lt;/p&gt;</span><br><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">get</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt; e;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((e = getNode(hash(key), key)) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">// accessOder为true时，被访问的节点被置于双向链表尾部</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (accessOrder)</span><br><span class=\"line\">            afterNodeAccess(e);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> e.value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**Returns the value to which the specified key is mapped, or defaultValue if this map contains no mapping for the key.*/</span></span><br><span class=\"line\">&lt;p&gt;返回指定键映射到的值，如果此映射不包含该键的映射，则返回defaultValue。&lt;/p&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> V <span class=\"title function_\">getOrDefault</span><span class=\"params\">(Object key, V defaultValue)</span> &#123;</span><br><span class=\"line\">       Node&lt;K,V&gt; e;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> ((e = getNode(hash(key), key)) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">           <span class=\"keyword\">return</span> defaultValue;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> (accessOrder)</span><br><span class=\"line\">           afterNodeAccess(e);</span><br><span class=\"line\">       <span class=\"keyword\">return</span> e.value;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<p>可以看到在get 方法中调用了afterNodeAccess方法，下面看下这个方法干了什么</p>\n<h2 id=\"afterNodeAccess\"><a href=\"#afterNodeAccess\" class=\"headerlink\" title=\"afterNodeAccess\"></a>afterNodeAccess</h2><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">afterNodeAccess</span><span class=\"params\">(Node&lt;K,V&gt; e)</span> &#123; <span class=\"comment\">// move node to last</span></span><br><span class=\"line\">    <span class=\"comment\">// 用 last 表示插入 e 前的尾节点</span></span><br><span class=\"line\">    <span class=\"comment\">// 插入 e 后 e 是尾节点, 所以也是表示 e 的前一个节点</span></span><br><span class=\"line\">    LinkedHashMap.Entry&lt;K,V&gt; last;</span><br><span class=\"line\">    <span class=\"comment\">//如果是访问序，且当前节点并不是尾节点</span></span><br><span class=\"line\">    <span class=\"comment\">//将该节点置为双向链表的尾部</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (accessOrder &amp;&amp; (last = tail) != e) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// p: 当前节点</span></span><br><span class=\"line\">        <span class=\"comment\">// b: 前一个节点</span></span><br><span class=\"line\">        <span class=\"comment\">// a: 后一个节点</span></span><br><span class=\"line\">        LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class=\"line\">            (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after;</span><br><span class=\"line\">        <span class=\"comment\">// 因为要移动到链尾，所以先至尾指针为空</span></span><br><span class=\"line\">        p.after = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//如果前面没有元素，则p之前为头结点，直接让a成为头结点</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (b == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            head = a;</span><br><span class=\"line\">        <span class=\"comment\">// 否则b的尾指针指向a</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            b.after = a;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (a != <span class=\"literal\">null</span>)</span><br><span class=\"line\">        <span class=\"comment\">//如果a不为空，则a的头指针指向b</span></span><br><span class=\"line\">            a.before = b;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"comment\">//否则 p之前就为尾指针，则另b成为尾指针</span></span><br><span class=\"line\">            last = b;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (last == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            head = p;</span><br><span class=\"line\">        <span class=\"comment\">//如果双向链表中只有p一个节点，则令p即为头结点，也为尾节点</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//否则 将p插入链尾</span></span><br><span class=\"line\">            p.before = last;</span><br><span class=\"line\">            last.after = p;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        tail = p;</span><br><span class=\"line\">        ++modCount;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"put\"><a href=\"#put\" class=\"headerlink\" title=\"put\"></a>put</h2><p>LinkedHashMap 并没有重写HashMap的 put 方法，调用的还是HashMap得put方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Associates the specified value with the specified key in this map.</span></span><br><span class=\"line\"><span class=\"comment\">     * If the map previously contained a mapping for the key, the old</span></span><br><span class=\"line\"><span class=\"comment\">     * value is replaced.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key key with which the specified value is to be associated</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value value to be associated with the specified key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or</span></span><br><span class=\"line\"><span class=\"comment\">     *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;.</span></span><br><span class=\"line\"><span class=\"comment\">     *         (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map</span></span><br><span class=\"line\"><span class=\"comment\">     *         previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> V <span class=\"title function_\">put</span><span class=\"params\">(K key, V value)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> putVal(hash(key), key, value, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Implements Map.put and related methods.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> hash hash for key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key the key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value the value to put</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> onlyIfAbsent if true, don&#x27;t change existing value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> evict if false, the table is in creation mode.</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> previous value, or null if none</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> V <span class=\"title function_\">putVal</span><span class=\"params\">(<span class=\"type\">int</span> hash, K key, V value, <span class=\"type\">boolean</span> onlyIfAbsent,</span></span><br><span class=\"line\"><span class=\"params\">                   <span class=\"type\">boolean</span> evict)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class=\"type\">int</span> n, i;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((tab = table) == <span class=\"literal\">null</span> || (n = tab.length) == <span class=\"number\">0</span>)</span><br><span class=\"line\">            n = (tab = resize()).length;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((p = tab[i = (n - <span class=\"number\">1</span>) &amp; hash]) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            tab[i] = newNode(hash, key, value, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            Node&lt;K,V&gt; e; K k;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (p.hash == hash &amp;&amp;</span><br><span class=\"line\">                ((k = p.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                e = p;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (p <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class=\"built_in\">this</span>, tab, hash, key, value);</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">binCount</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; ; ++binCount) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> ((e = p.next) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        p.next = newNode(hash, key, value, <span class=\"literal\">null</span>);</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class=\"number\">1</span>) <span class=\"comment\">// -1 for 1st</span></span><br><span class=\"line\">                            treeifyBin(tab, hash);</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                        ((k = e.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    p = e;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (e != <span class=\"literal\">null</span>) &#123; <span class=\"comment\">// existing mapping for key</span></span><br><span class=\"line\">                <span class=\"type\">V</span> <span class=\"variable\">oldValue</span> <span class=\"operator\">=</span> e.value;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!onlyIfAbsent || oldValue == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                    e.value = value;</span><br><span class=\"line\">                afterNodeAccess(e);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ++modCount;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (++size &gt; threshold)</span><br><span class=\"line\">            resize();</span><br><span class=\"line\">        afterNodeInsertion(evict);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>此外HashMap的putVal()方法，还调用了afterNodeInsertion()方法，</p>\n<h2 id=\"afterNodeInsertion\"><a href=\"#afterNodeInsertion\" class=\"headerlink\" title=\"afterNodeInsertion\"></a>afterNodeInsertion</h2><p>当插入数据时，将双向链表的头结点移除，这几个方法让LinkedHashMap实现了LRU算法。不过removeEldestEntry()默认是返回false的，需要子类继承重写removeEldestEntry()方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">afterNodeInsertion</span><span class=\"params\">(<span class=\"type\">boolean</span> evict)</span> &#123; <span class=\"comment\">// possibly remove eldest</span></span><br><span class=\"line\">        LinkedHashMap.Entry&lt;K,V&gt; first;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (evict &amp;&amp; (first = head) != <span class=\"literal\">null</span> &amp;&amp; removeEldestEntry(first)) &#123;</span><br><span class=\"line\">            <span class=\"type\">K</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> first.key;</span><br><span class=\"line\">            removeNode(hash(key), key, <span class=\"literal\">null</span>, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>LinkedHashMap的remove()方法也是调用的HashMap的remove()方法，</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Removes the mapping for the specified key from this map if present.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  key key whose mapping is to be removed from the map</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or</span></span><br><span class=\"line\"><span class=\"comment\">     *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;.</span></span><br><span class=\"line\"><span class=\"comment\">     *         (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map</span></span><br><span class=\"line\"><span class=\"comment\">     *         previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> V <span class=\"title function_\">remove</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt; e;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (e = removeNode(hashLkey), key, <span class=\"literal\">null</span>, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>)) == <span class=\"literal\">null</span> ?</span><br><span class=\"line\">            <span class=\"literal\">null</span> : e.value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Implements Map.remove and related methods.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> hash hash for key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key the key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value the value to match if matchValue, else ignored</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> matchValue if true only remove if value is equal</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> movable if false do not move other nodes while removing</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> the node, or null if none</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;K,V&gt; <span class=\"title function_\">removeNode</span><span class=\"params\">(<span class=\"type\">int</span> hash, Object key, Object value,</span></span><br><span class=\"line\"><span class=\"params\">                               <span class=\"type\">boolean</span> matchValue, <span class=\"type\">boolean</span> movable)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class=\"type\">int</span> n, index;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((tab = table) != <span class=\"literal\">null</span> &amp;&amp; (n = tab.length) &gt; <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">            (p = tab[index = (n - <span class=\"number\">1</span>) &amp; hash]) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            Node&lt;K,V&gt; node = <span class=\"literal\">null</span>, e; K k; V v;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (p.hash == hash &amp;&amp;</span><br><span class=\"line\">                ((k = p.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                node = p;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((e = p.next) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (p <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">                    node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</span><br><span class=\"line\">                <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                            ((k = e.key) == key ||</span><br><span class=\"line\">                             (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k)))) &#123;</span><br><span class=\"line\">                            node = e;</span><br><span class=\"line\">                            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        p = e;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">while</span> ((e = e.next) != <span class=\"literal\">null</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (node != <span class=\"literal\">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||</span><br><span class=\"line\">                                 (value != <span class=\"literal\">null</span> &amp;&amp; value.equals(v)))) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (node <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">                    ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class=\"built_in\">this</span>, tab, movable);</span><br><span class=\"line\">                <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (node == p)</span><br><span class=\"line\">                    tab[index] = node.next;</span><br><span class=\"line\">                <span class=\"keyword\">else</span></span><br><span class=\"line\">                    p.next = node.next;</span><br><span class=\"line\">                ++modCount;</span><br><span class=\"line\">                --size;</span><br><span class=\"line\">                afterNodeRemoval(node);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> node;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>总结：</p>\n<ul>\n<li>  LinkedHashMap 继承 HashMap，拥有 HashMap 的功能</li>\n<li>  LinkedHashMap 维护了两个数据结构，一是 HashMap 的结构，二是用来做迭代的双向链表</li>\n<li>  LinkedHashMap 独特的迭代器设计和一些函数的重写，导致迭代器按双向链表迭代，并且若没有设置 accessOrder，则按插入顺序迭代，否则，按访问顺序迭代</li>\n<li>  通过重写removeEldestEntry可以实现 LruCache 的功能</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言：\"><a href=\"#前言：\" class=\"headerlink\" title=\"前言：\"></a>前言：</h2><p>LinkedHashMap 是如何做到LruCache ，下面我们从源码中看一看</p>\n<h2 id=\"LinkedHashMap构造函数\"><a href=\"#LinkedHashMap构造函数\" class=\"headerlink\" title=\"LinkedHashMap构造函数\"></a>LinkedHashMap构造函数</h2><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Constructs an empty insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance</span></span><br><span class=\"line\"><span class=\"comment\">     * with the specified initial capacity and load factor.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  initialCapacity the initial capacity</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  loadFactor      the load factor</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IllegalArgumentException if the initial capacity is negative</span></span><br><span class=\"line\"><span class=\"comment\">     *         or the load factor is nonpositive</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LinkedHashMap</span><span class=\"params\">(<span class=\"type\">int</span> initialCapacity, <span class=\"type\">float</span> loadFactor)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(initialCapacity, loadFactor);</span><br><span class=\"line\">        accessOrder = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Constructs an empty insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance</span></span><br><span class=\"line\"><span class=\"comment\">     * with the specified initial capacity and a default load factor (0.75).</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  initialCapacity the initial capacity</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IllegalArgumentException if the initial capacity is negative</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LinkedHashMap</span><span class=\"params\">(<span class=\"type\">int</span> initialCapacity)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(initialCapacity);</span><br><span class=\"line\">        accessOrder = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Constructs an empty insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance</span></span><br><span class=\"line\"><span class=\"comment\">     * with the default initial capacity (16) and load factor (0.75).</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LinkedHashMap</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>();</span><br><span class=\"line\">        accessOrder = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Constructs an insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance with</span></span><br><span class=\"line\"><span class=\"comment\">     * the same mappings as the specified map.  The &lt;tt&gt;LinkedHashMap&lt;/tt&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * instance is created with a default load factor (0.75) and an initial</span></span><br><span class=\"line\"><span class=\"comment\">     * capacity sufficient to hold the mappings in the specified map.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  m the map whose mappings are to be placed in this map</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> NullPointerException if the specified map is null</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LinkedHashMap</span><span class=\"params\">(Map&lt;? extends K, ? extends V&gt; m)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>();</span><br><span class=\"line\">        accessOrder = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        putMapEntries(m, <span class=\"literal\">false</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Constructs an empty &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance with the</span></span><br><span class=\"line\"><span class=\"comment\">     * specified initial capacity, load factor and ordering mode.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  initialCapacity the initial capacity</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  loadFactor      the load factor</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  accessOrder     the ordering mode - &lt;tt&gt;true&lt;/tt&gt; for</span></span><br><span class=\"line\"><span class=\"comment\">     *         access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IllegalArgumentException if the initial capacity is negative</span></span><br><span class=\"line\"><span class=\"comment\">     *         or the load factor is nonpositive</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LinkedHashMap</span><span class=\"params\">(<span class=\"type\">int</span> initialCapacity,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"type\">float</span> loadFactor,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"type\">boolean</span> accessOrder)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(initialCapacity, loadFactor);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.accessOrder = accessOrder;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>先分别看下这三个参数：int initialCapacity、float loadFactor, boolean accessOrder</p>\n<p>initialCapacity：表示是初始数组长度</p>\n<p>loadFactor：表示负载因子，表示数组的元素数量/数组长度超过这个比例，数组就要扩容</p>\n<p>accessOrder：false： 基于插入顺序(默认) true： 基于访问顺序</p>\n<p>关于插入顺序，访问顺序可以看我的另一篇文章： <a href=\"/relaxed/java-%E9%93%BE%E8%A1%A8/\" title=\"java链表(单向，循环、双向)\">java链表(单向，循环、双向)</a></p>\n<p>下面看下LinkedHashMap 最常用的get，put 以及afterNodeAccess、afterNodeInsertion方法</p>\n<h2 id=\"get\"><a href=\"#get\" class=\"headerlink\" title=\"get\"></a>get</h2><p>LinkedHashMap 重写了get方法，实现了LrucaChe</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**Returns the value to which the specified key is mapped, or null if this map contains no mapping for the key.</span></span><br><span class=\"line\"><span class=\"comment\">More formally, if this map contains a mapping from a key k to a value v such that (key==null ? k==null : key.equals(k)), then this method returns v; otherwise it returns null. (There can be at most one such mapping.)</span></span><br><span class=\"line\"><span class=\"comment\">A return value of null does not necessarily indicate that the map contains no mapping for the key; it&#x27;s also possible that the map explicitly maps the key to null. The containsKey operation may be used to distinguish these two cases*/</span></span><br><span class=\"line\">&lt;P&gt;</span><br><span class=\"line\">返回指定键映射到的值，如果此映射不包含该键的映射，则返回<span class=\"literal\">null</span>。</span><br><span class=\"line\">更正式地说，如果这个映射包含从键k到值v的映射，使得（键==<span class=\"literal\">null</span>？k==<span class=\"literal\">null</span>:key.equals（k）），那么这个方法返回v；否则返回<span class=\"literal\">null</span>。（最多可以有一个这样的映射。）</span><br><span class=\"line\">空映射不一定包含空映射的返回值；映射也可能显式地将密钥映射为<span class=\"literal\">null</span>。containsKey操作可用于区分这两种情况</span><br><span class=\"line\">&lt;/p&gt;</span><br><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">get</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt; e;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((e = getNode(hash(key), key)) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">// accessOder为true时，被访问的节点被置于双向链表尾部</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (accessOrder)</span><br><span class=\"line\">            afterNodeAccess(e);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> e.value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**Returns the value to which the specified key is mapped, or defaultValue if this map contains no mapping for the key.*/</span></span><br><span class=\"line\">&lt;p&gt;返回指定键映射到的值，如果此映射不包含该键的映射，则返回defaultValue。&lt;/p&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> V <span class=\"title function_\">getOrDefault</span><span class=\"params\">(Object key, V defaultValue)</span> &#123;</span><br><span class=\"line\">       Node&lt;K,V&gt; e;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> ((e = getNode(hash(key), key)) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">           <span class=\"keyword\">return</span> defaultValue;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> (accessOrder)</span><br><span class=\"line\">           afterNodeAccess(e);</span><br><span class=\"line\">       <span class=\"keyword\">return</span> e.value;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<p>可以看到在get 方法中调用了afterNodeAccess方法，下面看下这个方法干了什么</p>\n<h2 id=\"afterNodeAccess\"><a href=\"#afterNodeAccess\" class=\"headerlink\" title=\"afterNodeAccess\"></a>afterNodeAccess</h2><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">afterNodeAccess</span><span class=\"params\">(Node&lt;K,V&gt; e)</span> &#123; <span class=\"comment\">// move node to last</span></span><br><span class=\"line\">    <span class=\"comment\">// 用 last 表示插入 e 前的尾节点</span></span><br><span class=\"line\">    <span class=\"comment\">// 插入 e 后 e 是尾节点, 所以也是表示 e 的前一个节点</span></span><br><span class=\"line\">    LinkedHashMap.Entry&lt;K,V&gt; last;</span><br><span class=\"line\">    <span class=\"comment\">//如果是访问序，且当前节点并不是尾节点</span></span><br><span class=\"line\">    <span class=\"comment\">//将该节点置为双向链表的尾部</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (accessOrder &amp;&amp; (last = tail) != e) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// p: 当前节点</span></span><br><span class=\"line\">        <span class=\"comment\">// b: 前一个节点</span></span><br><span class=\"line\">        <span class=\"comment\">// a: 后一个节点</span></span><br><span class=\"line\">        LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class=\"line\">            (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after;</span><br><span class=\"line\">        <span class=\"comment\">// 因为要移动到链尾，所以先至尾指针为空</span></span><br><span class=\"line\">        p.after = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//如果前面没有元素，则p之前为头结点，直接让a成为头结点</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (b == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            head = a;</span><br><span class=\"line\">        <span class=\"comment\">// 否则b的尾指针指向a</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            b.after = a;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (a != <span class=\"literal\">null</span>)</span><br><span class=\"line\">        <span class=\"comment\">//如果a不为空，则a的头指针指向b</span></span><br><span class=\"line\">            a.before = b;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"comment\">//否则 p之前就为尾指针，则另b成为尾指针</span></span><br><span class=\"line\">            last = b;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (last == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            head = p;</span><br><span class=\"line\">        <span class=\"comment\">//如果双向链表中只有p一个节点，则令p即为头结点，也为尾节点</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//否则 将p插入链尾</span></span><br><span class=\"line\">            p.before = last;</span><br><span class=\"line\">            last.after = p;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        tail = p;</span><br><span class=\"line\">        ++modCount;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"put\"><a href=\"#put\" class=\"headerlink\" title=\"put\"></a>put</h2><p>LinkedHashMap 并没有重写HashMap的 put 方法，调用的还是HashMap得put方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Associates the specified value with the specified key in this map.</span></span><br><span class=\"line\"><span class=\"comment\">     * If the map previously contained a mapping for the key, the old</span></span><br><span class=\"line\"><span class=\"comment\">     * value is replaced.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key key with which the specified value is to be associated</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value value to be associated with the specified key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or</span></span><br><span class=\"line\"><span class=\"comment\">     *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;.</span></span><br><span class=\"line\"><span class=\"comment\">     *         (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map</span></span><br><span class=\"line\"><span class=\"comment\">     *         previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> V <span class=\"title function_\">put</span><span class=\"params\">(K key, V value)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> putVal(hash(key), key, value, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Implements Map.put and related methods.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> hash hash for key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key the key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value the value to put</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> onlyIfAbsent if true, don&#x27;t change existing value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> evict if false, the table is in creation mode.</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> previous value, or null if none</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> V <span class=\"title function_\">putVal</span><span class=\"params\">(<span class=\"type\">int</span> hash, K key, V value, <span class=\"type\">boolean</span> onlyIfAbsent,</span></span><br><span class=\"line\"><span class=\"params\">                   <span class=\"type\">boolean</span> evict)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class=\"type\">int</span> n, i;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((tab = table) == <span class=\"literal\">null</span> || (n = tab.length) == <span class=\"number\">0</span>)</span><br><span class=\"line\">            n = (tab = resize()).length;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((p = tab[i = (n - <span class=\"number\">1</span>) &amp; hash]) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            tab[i] = newNode(hash, key, value, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            Node&lt;K,V&gt; e; K k;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (p.hash == hash &amp;&amp;</span><br><span class=\"line\">                ((k = p.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                e = p;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (p <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class=\"built_in\">this</span>, tab, hash, key, value);</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">binCount</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; ; ++binCount) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> ((e = p.next) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        p.next = newNode(hash, key, value, <span class=\"literal\">null</span>);</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class=\"number\">1</span>) <span class=\"comment\">// -1 for 1st</span></span><br><span class=\"line\">                            treeifyBin(tab, hash);</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                        ((k = e.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    p = e;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (e != <span class=\"literal\">null</span>) &#123; <span class=\"comment\">// existing mapping for key</span></span><br><span class=\"line\">                <span class=\"type\">V</span> <span class=\"variable\">oldValue</span> <span class=\"operator\">=</span> e.value;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!onlyIfAbsent || oldValue == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                    e.value = value;</span><br><span class=\"line\">                afterNodeAccess(e);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ++modCount;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (++size &gt; threshold)</span><br><span class=\"line\">            resize();</span><br><span class=\"line\">        afterNodeInsertion(evict);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>此外HashMap的putVal()方法，还调用了afterNodeInsertion()方法，</p>\n<h2 id=\"afterNodeInsertion\"><a href=\"#afterNodeInsertion\" class=\"headerlink\" title=\"afterNodeInsertion\"></a>afterNodeInsertion</h2><p>当插入数据时，将双向链表的头结点移除，这几个方法让LinkedHashMap实现了LRU算法。不过removeEldestEntry()默认是返回false的，需要子类继承重写removeEldestEntry()方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">afterNodeInsertion</span><span class=\"params\">(<span class=\"type\">boolean</span> evict)</span> &#123; <span class=\"comment\">// possibly remove eldest</span></span><br><span class=\"line\">        LinkedHashMap.Entry&lt;K,V&gt; first;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (evict &amp;&amp; (first = head) != <span class=\"literal\">null</span> &amp;&amp; removeEldestEntry(first)) &#123;</span><br><span class=\"line\">            <span class=\"type\">K</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> first.key;</span><br><span class=\"line\">            removeNode(hash(key), key, <span class=\"literal\">null</span>, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>LinkedHashMap的remove()方法也是调用的HashMap的remove()方法，</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Removes the mapping for the specified key from this map if present.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  key key whose mapping is to be removed from the map</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or</span></span><br><span class=\"line\"><span class=\"comment\">     *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;.</span></span><br><span class=\"line\"><span class=\"comment\">     *         (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map</span></span><br><span class=\"line\"><span class=\"comment\">     *         previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> V <span class=\"title function_\">remove</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt; e;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (e = removeNode(hashLkey), key, <span class=\"literal\">null</span>, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>)) == <span class=\"literal\">null</span> ?</span><br><span class=\"line\">            <span class=\"literal\">null</span> : e.value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Implements Map.remove and related methods.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> hash hash for key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key the key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value the value to match if matchValue, else ignored</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> matchValue if true only remove if value is equal</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> movable if false do not move other nodes while removing</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> the node, or null if none</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;K,V&gt; <span class=\"title function_\">removeNode</span><span class=\"params\">(<span class=\"type\">int</span> hash, Object key, Object value,</span></span><br><span class=\"line\"><span class=\"params\">                               <span class=\"type\">boolean</span> matchValue, <span class=\"type\">boolean</span> movable)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class=\"type\">int</span> n, index;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((tab = table) != <span class=\"literal\">null</span> &amp;&amp; (n = tab.length) &gt; <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">            (p = tab[index = (n - <span class=\"number\">1</span>) &amp; hash]) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            Node&lt;K,V&gt; node = <span class=\"literal\">null</span>, e; K k; V v;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (p.hash == hash &amp;&amp;</span><br><span class=\"line\">                ((k = p.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                node = p;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((e = p.next) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (p <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">                    node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</span><br><span class=\"line\">                <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                            ((k = e.key) == key ||</span><br><span class=\"line\">                             (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k)))) &#123;</span><br><span class=\"line\">                            node = e;</span><br><span class=\"line\">                            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        p = e;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">while</span> ((e = e.next) != <span class=\"literal\">null</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (node != <span class=\"literal\">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||</span><br><span class=\"line\">                                 (value != <span class=\"literal\">null</span> &amp;&amp; value.equals(v)))) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (node <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">                    ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class=\"built_in\">this</span>, tab, movable);</span><br><span class=\"line\">                <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (node == p)</span><br><span class=\"line\">                    tab[index] = node.next;</span><br><span class=\"line\">                <span class=\"keyword\">else</span></span><br><span class=\"line\">                    p.next = node.next;</span><br><span class=\"line\">                ++modCount;</span><br><span class=\"line\">                --size;</span><br><span class=\"line\">                afterNodeRemoval(node);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> node;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>总结：</p>\n<ul>\n<li>  LinkedHashMap 继承 HashMap，拥有 HashMap 的功能</li>\n<li>  LinkedHashMap 维护了两个数据结构，一是 HashMap 的结构，二是用来做迭代的双向链表</li>\n<li>  LinkedHashMap 独特的迭代器设计和一些函数的重写，导致迭代器按双向链表迭代，并且若没有设置 accessOrder，则按插入顺序迭代，否则，按访问顺序迭代</li>\n<li>  通过重写removeEldestEntry可以实现 LruCache 的功能</li>\n</ul>\n"},{"title":"LruCache-原理分析","date":"2022-03-23T16:26:52.000Z","cover":"https://s1.ax1x.com/2022/03/24/q34Snx.jpg","_content":"\n1.LruCache原理是什么\n LruCache 采用最近最少使用算法，设定一个缓存大小，当缓存达到这个大小之后，会将最老的数据移除，避免图片占用内存过大导致OOM。\n\n2.Lrucache源码分析\n ```java\npublic class LruCache<K, V> {\n\t// 数据最终存在 LinkedHashMap 中\n    private final LinkedHashMap<K, V> map;\n\t...\n\tpublic LruCache(int maxSize) {\n        if (maxSize <= 0) {\n            throw new IllegalArgumentException(\"maxSize <= 0\");\n        }\n        this.maxSize = maxSize;\n\t\t// 创建一个LinkedHashMap，accessOrder 传true\n        this.map = new LinkedHashMap<K, V>(0, 0.75f, true);\n    }\n    ...\n```\nLruCache 构造方法里创建一个LinkedHashMap，accessOrder 参数传true，表示访问时重新排序，accessOrder 参数传false，表示插入时重新排序。（/* LruCache 核心工作原理就在此*/）\n\n\n插入顺序是什么意思？\n按照对象插入的顺序进行排列，可以简单说按照插入的时间先后顺序排列。\n依次放入1,2,3,4,5   那么按照插入顺序后LruCache中的对象顺序就是1,2,3,4,5\n\n那么访问顺序是什么意思呢？\n访问顺序意思就是LruCache中被访问过的子对象会重新排序，那么意味着我们先依次排序进行对象缓存1,2,3,4,5\n现阶段的对象顺序是1,2,3,4,5\n如果现在内存使用了2号缓存，那么就表示2号被访问了，重新排序 2,1,3,4,5\n如果现在内存再命中了4号缓存，那么就表示4号被访问了，重新排序 4,2,1,3,5\n内存再命中了5号缓存，那么就表示4号被访问了，重新排序 5,4,2,1,3\n.....\n.....\n\n所以每次使用过的缓存都会被重新排到缓存队列的最前面。\n\n那么意味着，队列越后面的缓存就使用得越少，当缓存队列容量达到阀值后，再往队列中添加新缓存时则可以将队列最后面的使用次数最少的缓存依次移除，插入新缓存，达到Lru算法的效果。\n","source":"_posts/2022/java/LruCache-原理分析.md","raw":"---\ntitle: LruCache-原理分析\ndate: 2022-03-24 00:26:52\ncategories:\n - Java\ntags:\n - Java\ncover: https://s1.ax1x.com/2022/03/24/q34Snx.jpg\n---\n\n1.LruCache原理是什么\n LruCache 采用最近最少使用算法，设定一个缓存大小，当缓存达到这个大小之后，会将最老的数据移除，避免图片占用内存过大导致OOM。\n\n2.Lrucache源码分析\n ```java\npublic class LruCache<K, V> {\n\t// 数据最终存在 LinkedHashMap 中\n    private final LinkedHashMap<K, V> map;\n\t...\n\tpublic LruCache(int maxSize) {\n        if (maxSize <= 0) {\n            throw new IllegalArgumentException(\"maxSize <= 0\");\n        }\n        this.maxSize = maxSize;\n\t\t// 创建一个LinkedHashMap，accessOrder 传true\n        this.map = new LinkedHashMap<K, V>(0, 0.75f, true);\n    }\n    ...\n```\nLruCache 构造方法里创建一个LinkedHashMap，accessOrder 参数传true，表示访问时重新排序，accessOrder 参数传false，表示插入时重新排序。（/* LruCache 核心工作原理就在此*/）\n\n\n插入顺序是什么意思？\n按照对象插入的顺序进行排列，可以简单说按照插入的时间先后顺序排列。\n依次放入1,2,3,4,5   那么按照插入顺序后LruCache中的对象顺序就是1,2,3,4,5\n\n那么访问顺序是什么意思呢？\n访问顺序意思就是LruCache中被访问过的子对象会重新排序，那么意味着我们先依次排序进行对象缓存1,2,3,4,5\n现阶段的对象顺序是1,2,3,4,5\n如果现在内存使用了2号缓存，那么就表示2号被访问了，重新排序 2,1,3,4,5\n如果现在内存再命中了4号缓存，那么就表示4号被访问了，重新排序 4,2,1,3,5\n内存再命中了5号缓存，那么就表示4号被访问了，重新排序 5,4,2,1,3\n.....\n.....\n\n所以每次使用过的缓存都会被重新排到缓存队列的最前面。\n\n那么意味着，队列越后面的缓存就使用得越少，当缓存队列容量达到阀值后，再往队列中添加新缓存时则可以将队列最后面的使用次数最少的缓存依次移除，插入新缓存，达到Lru算法的效果。\n","slug":"LruCache-原理分析","published":1,"relaxed":"java","updated":"2022-03-23T16:30:49.528Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl2vhlmfy000kt6fyfw13e4h5","content":"<p>1.LruCache原理是什么<br> LruCache 采用最近最少使用算法，设定一个缓存大小，当缓存达到这个大小之后，会将最老的数据移除，避免图片占用内存过大导致OOM。</p>\n<p>2.Lrucache源码分析<br> <figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LruCache</span>&lt;K, V&gt; &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 数据最终存在 LinkedHashMap 中</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> LinkedHashMap&lt;K, V&gt; map;</span><br><span class=\"line\">\t...</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"title function_\">LruCache</span><span class=\"params\">(<span class=\"type\">int</span> maxSize)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (maxSize &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;maxSize &lt;= 0&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.maxSize = maxSize;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 创建一个LinkedHashMap，accessOrder 传true</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.map = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;K, V&gt;(<span class=\"number\">0</span>, <span class=\"number\">0.75f</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ...</span><br></pre></td></tr></table></figure><br>LruCache 构造方法里创建一个LinkedHashMap，accessOrder 参数传true，表示访问时重新排序，accessOrder 参数传false，表示插入时重新排序。（/* LruCache 核心工作原理就在此*/）</p>\n<p>插入顺序是什么意思？<br>按照对象插入的顺序进行排列，可以简单说按照插入的时间先后顺序排列。<br>依次放入1,2,3,4,5   那么按照插入顺序后LruCache中的对象顺序就是1,2,3,4,5</p>\n<p>那么访问顺序是什么意思呢？<br>访问顺序意思就是LruCache中被访问过的子对象会重新排序，那么意味着我们先依次排序进行对象缓存1,2,3,4,5<br>现阶段的对象顺序是1,2,3,4,5<br>如果现在内存使用了2号缓存，那么就表示2号被访问了，重新排序 2,1,3,4,5<br>如果现在内存再命中了4号缓存，那么就表示4号被访问了，重新排序 4,2,1,3,5<br>内存再命中了5号缓存，那么就表示4号被访问了，重新排序 5,4,2,1,3<br>…..<br>…..</p>\n<p>所以每次使用过的缓存都会被重新排到缓存队列的最前面。</p>\n<p>那么意味着，队列越后面的缓存就使用得越少，当缓存队列容量达到阀值后，再往队列中添加新缓存时则可以将队列最后面的使用次数最少的缓存依次移除，插入新缓存，达到Lru算法的效果。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>1.LruCache原理是什么<br> LruCache 采用最近最少使用算法，设定一个缓存大小，当缓存达到这个大小之后，会将最老的数据移除，避免图片占用内存过大导致OOM。</p>\n<p>2.Lrucache源码分析<br> <figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LruCache</span>&lt;K, V&gt; &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 数据最终存在 LinkedHashMap 中</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> LinkedHashMap&lt;K, V&gt; map;</span><br><span class=\"line\">\t...</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"title function_\">LruCache</span><span class=\"params\">(<span class=\"type\">int</span> maxSize)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (maxSize &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;maxSize &lt;= 0&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.maxSize = maxSize;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 创建一个LinkedHashMap，accessOrder 传true</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.map = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;K, V&gt;(<span class=\"number\">0</span>, <span class=\"number\">0.75f</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ...</span><br></pre></td></tr></table></figure><br>LruCache 构造方法里创建一个LinkedHashMap，accessOrder 参数传true，表示访问时重新排序，accessOrder 参数传false，表示插入时重新排序。（/* LruCache 核心工作原理就在此*/）</p>\n<p>插入顺序是什么意思？<br>按照对象插入的顺序进行排列，可以简单说按照插入的时间先后顺序排列。<br>依次放入1,2,3,4,5   那么按照插入顺序后LruCache中的对象顺序就是1,2,3,4,5</p>\n<p>那么访问顺序是什么意思呢？<br>访问顺序意思就是LruCache中被访问过的子对象会重新排序，那么意味着我们先依次排序进行对象缓存1,2,3,4,5<br>现阶段的对象顺序是1,2,3,4,5<br>如果现在内存使用了2号缓存，那么就表示2号被访问了，重新排序 2,1,3,4,5<br>如果现在内存再命中了4号缓存，那么就表示4号被访问了，重新排序 4,2,1,3,5<br>内存再命中了5号缓存，那么就表示4号被访问了，重新排序 5,4,2,1,3<br>…..<br>…..</p>\n<p>所以每次使用过的缓存都会被重新排到缓存队列的最前面。</p>\n<p>那么意味着，队列越后面的缓存就使用得越少，当缓存队列容量达到阀值后，再往队列中添加新缓存时则可以将队列最后面的使用次数最少的缓存依次移除，插入新缓存，达到Lru算法的效果。</p>\n"},{"title":"Java高级特性-反射","date":"2022-03-30T10:17:18.000Z","cover":"https://s1.ax1x.com/2022/03/30/q2mOxI.jpg","_content":"# 前言\n **[JAVA反射机制](https://baike.baidu.com/item/JAVA%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/6015990)是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意方法和属性；这种动态获取信息以及动态调用对象方法的功能称为java语言的反射机制。**\n\n# 应用场景\nAndroid中最熟悉的反射，莫过于Json数据的转换，例如网络数据，数据库数据和类之间的相互转化。使用反射机制可以直接创建对象，方便代码管理。\n\n# 相关类\n[. Class](https://developer.android.google.cn/reference/java/lang/Class)\n* class类下部分常用方法\n\n| 方法名| 翻译 |\n| :-----:|:----: |\n| [forName(String className)](https://developer.android.google.cn/reference/java/lang/Class#forName(java.lang.String,%20boolean,%20java.lang.ClassLoader)) | 加载参数指定的类，并且初始化它。|\n| [cast](https://developer.android.google.cn/reference/java/lang/Class#cast(java.lang.Object)) | 对象转换成代表类或是接口的对象|\n| [getClasses()](https://developer.android.google.cn/reference/java/lang/Class#cast(java.lang.Object)) |返回一个数组，数组中包含该类中所有公共类和接口类的对象|\n| [getName()](https://developer.android.google.cn/reference/java/lang/Class#getName()) |获取类路径名称|\n| [newInstance](https://developer.android.google.cn/reference/java/lang/Class#newInstance()) |创建类的实例\n| [getPackage()](https://developer.android.google.cn/reference/java/lang/Class#getPackage()) |获取类所在包|\n| [getInterfaces()](https://developer.android.google.cn/reference/java/lang/Class#getPackage()) |确定此对象所表示的类或接口实现的接口|\n| [getSuperclass()](https://developer.android.google.cn/reference/java/lang/Class#getSuperclass()) |获得当前类继承的父类的名字|\n| [getClassLoader()](https://developer.android.google.cn/reference/java/lang/Class#getClassLoader()) |获取类加载器|\n| [getDeclaredClasses()](https://developer.android.google.cn/reference/java/lang/Class#getDeclaredClasses()) |返回一个数组，数组中包含该类中所有类和接口类的对象|\n\n* Class类下相关属性方法\n\n| 方法名| 翻译 |\n| :-----:|:----: |\n| [getField(String name)](https://developer.android.google.cn/reference/java/lang/Class#getField(java.lang.String)) | 获取某个公有的属性对象 |\n| [getFields()](https://developer.android.google.cn/reference/java/lang/Class#getFields()) | 获取所有公有的属性对象 |\n| [getDeclaredField(String name)](https://developer.android.google.cn/reference/java/lang/Class#getDeclaredField(java.lang.String))) | 获取某个私有属性对象 |\n| [getDeclaredFields()](https://developer.android.google.cn/reference/java/lang/Class#getDeclaredFields()) | 获取所有私有属性对象 |\n\n* Class 类下相关注解方法\n\n| 方法名| 翻译 |\n| :-----:|:----: |\n| [getDeclaredAnnotations()](https://developer.android.google.cn/reference/java/lang/Class#getDeclaredAnnotations()) | 返回对应类下所有注解对象|\n| [getDeclaredAnnotation(Class<A> annotationClass)](https://developer.android.google.cn/reference/java/lang/Class#getDeclaredAnnotation(java.lang.Class%3CA%3E)) | 返回对应类中与参数类型匹配的所有注解对象|\n| [getAnnotation(Class<A> annotationClass)](https://developer.android.google.cn/reference/java/lang/Class#getAnnotation(java.lang.Class%3CA%3E)) | 返回对应类中与参数类型匹配的公有注解对象|\n| [getAnnotations ()](https://developer.android.google.cn/reference/java/lang/Class#getAnnotations()) | 返回对应类中所有公有注解对象|\n\n* Class 类下其它相关方法\n\n| 方法名| 翻译 |\n| :-----:|:----: |\n| [getMethods()](https://developer.android.google.cn/reference/java/lang/Class#getMethods()) | 返回该类所有公有的方法|\n| [getMethod (String name, Class...<?> parameterTypes)](https://developer.android.google.cn/reference/java/lang/Class#getMethod(java.lang.String,%20java.lang.Class%3C?%3E...)) | 返回该类某个公有方法|\n| [getDeclaredMethod(String name, Class...<?> parameterTypes)](https://developer.android.google.cn/reference/java/lang/Class#getDeclaredMethod(java.lang.String,%20java.lang.Class%3C?%3E...)) | 返回该类某个方法|\n| [getDeclaredMethods()](https://developer.android.google.cn/reference/java/lang/Class#getDeclaredMethods()) | 返回该类所有方法|\n\n[. Method](https://developer.android.google.cn/reference/java/lang/reflect/Field)\n* Method类下部分常用方法\n\n| 方法名| 翻译 |\n| :-----:|:----: |\n| [invoke(Object obj, Object... args)](https://developer.android.google.cn/reference/java/lang/reflect/Method#invoke(java.lang.Object,%20java.lang.Object...)) | 传递object对象及参数调用该对象对应的方法|\n\n[. Field](https://developer.android.google.cn/reference/java/lang/reflect/Field)\n* Field类下部分常用方法\n\n| 方法名| 翻译 |\n| :-----:|:----: |\n| [get(Object obj)](https://developer.android.google.cn/reference/java/lang/reflect/Field#get(java.lang.Object)) | 获得obj中对应的属性值|\n| [set(Object obj, Object value)](https://developer.android.google.cn/reference/java/lang/reflect/Field#set(java.lang.Object,%20java.lang.Object)) | 设置obj中对应属性值|\n\n[. Constructor](https://developer.android.google.cn/reference/java/lang/reflect/Constructor)\n* Constructor类下部分常用方法\n\n| 方法名| 翻译 |\n| :-----:|:----: |\n| [newInstance(Object... initargs)](https://developer.android.google.cn/reference/java/lang/reflect/Constructor#newInstance(java.lang.Object...)) | 根据传递的参数创建类的对象|\n\n\n# 示例\n* 反射实体类\n```java\npublic class GloryOfKings {\n\n    private String role;\n    private String skills;\n    private String explain;\n\n    public GloryOfKings() {\n    }\n\n    private GloryOfKings(String role, String skills) {\n        this.role = role;\n        this.skills = skills;\n    }\n\n    public String getRole() {\n        return role;\n    }\n\n    public void setRole(String role) {\n        this.role = role;\n    }\n\n    public String getSkills() {\n        return skills;\n    }\n\n    public void setSkills(String skills) {\n        this.skills = skills;\n    }\n\n    public void setExplain(String explain) {\n        this.explain = explain;\n    }\n\n    public String getExplain() {\n        return explain;\n    }\n\n    private String week(int flag) {\n        String string = \"\";\n        switch (flag) {\n            case FlagMethod.monday:\n                string = \"天气晴朗\";\n                break;\n            case FlagMethod.tuesday:\n                string = \"多云\";\n                break;\n            case FlagMethod.Wednesday:\n                string = \"微风\";\n                break;\n            case FlagMethod.Thursday:\n                string = \"阵风6级\";\n                break;\n            case FlagMethod.Friday:\n                string = \"中雨\";\n                break;\n            case FlagMethod.Saturday:\n                string = \"大雨\";\n                break;\n            case FlagMethod.Sunday:\n                string = \"晴朗\";\n                break;\n            default:\n                string = \"-.-\";\n        }\n\n        return string;\n    }\n}\n\n```\n* 逻辑封装类\n```java\npublic class Reflect {\n    /**\n     * 反射-创建对象（三种方式：.class、new MyClass().getClass，Class.forName(\"类的全路径\")）\n     */\n    public static void newInstance(int flag) {\n        String outMessage = \"\";\n        try {\n            switch (flag) {\n                case FlagSource.newInstanceOne:\n                    Class<GloryOfKings> cls = GloryOfKings.class;\n                    GloryOfKings gloryOfKings = cls.newInstance();\n                    gloryOfKings.setExplain(\"创建对象方式- GloryOfKings.class\");\n                    gloryOfKings.setRole(\"李元芳\");\n                    gloryOfKings.setSkills(\"利刃风暴\");\n                    outMessage = gloryOfKings.toString();\n                    break;\n                case FlagSource.newInstanceTwo:\n                    Class<? extends GloryOfKings> cls1 = new GloryOfKings().getClass();\n                    GloryOfKings gloryOfKings1 = cls1.newInstance();\n                    gloryOfKings1.setExplain(\"创建对象方式- new GloryOfKings().getClass()\");\n                    gloryOfKings1.setRole(\"后羿\");\n                    gloryOfKings1.setSkills(\"灼日之矢”\");\n                    outMessage = gloryOfKings1.toString();\n                    break;\n                case FlagSource.newInstanceThree:\n                    Class<?> cls2 = Class.forName(\"com.linked.business.reflect.GloryOfKings\");\n                    GloryOfKings gloryOfKings2 = (GloryOfKings) cls2.newInstance();\n                    gloryOfKings2.setExplain(\"创建对象方式- Class.forName()\");\n                    gloryOfKings2.setRole(\"诸葛亮\");\n                    gloryOfKings2.setSkills(\"时空穿梭”\");\n                    outMessage = gloryOfKings2.toString();\n                    break;\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        System.out.println(outMessage);\n    }\n\n    /**\n     * 反射-私有构造方法\n     */\n    public static void construction() {\n        try {\n            Class<?> cls = Class.forName(\"com.linked.business.reflect.GloryOfKings\");\n            Constructor<?> constructor = cls.getDeclaredConstructor(String.class, String.class);\n            constructor.setAccessible(true);\n            Object obj = constructor.newInstance(\" 反射-设置私有构造方法：名称\", \" 反射-获取私有构造方法：福利\");\n            GloryOfKings go = (GloryOfKings) obj;\n            System.out.println(\"反射-获取私有构造方法\" + go);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    /**\n     * 反射-私有属性\n     */\n    public static void reflectDeclaredAttribute() {\n        try {\n            Class<?> cls = Class.forName(\"com.linked.business.reflect.GloryOfKings\");\n            Object obj = cls.newInstance();\n            Field field = cls.getDeclaredField(\"TAG\");\n            field.setAccessible(true);\n            String str = (String) field.get(obj);\n            System.out.println(\"反射-获取私有属性\" + str);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    /**\n     * 反射-私有方法\n     * <p>将此对象的 accessible 标志设置为指示的布尔值。值为 true 则指示反射的对象在使用时应该取消 Java 语言访问检查。值为 false 则指示反射的对象应该实施 Java 语言访问检查;\n     * 实际上setAccessible是启用和禁用访问安全检查的开关,并不是为true就能访问为false就不能访问 ；\n     * 由于JDK的安全检查耗时较多.所以通过setAccessible(true)的方式关闭安全检查就可以达到提升反射速度的目的\n     * </p>\n     */\n    public static void privateMethod() {\n        try {\n            Class<?> cls = Class.forName(\"com.linked.business.reflect.GloryOfKings\");\n            Method method = cls.getDeclaredMethod(\"week\", int.class);\n            method.setAccessible(true);\n            Object obj = cls.newInstance();\n            //invoke：传递object对象及参数调用该对象对应的方法\n            String str = (String) method.invoke(obj, FlagMethod.monday);\n            System.out.println(str);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n* 测试类\n```java\npublic class ReflectTest {\n    public static void main(String[] args) {\n        try {\n            Reflect.newInstance(FlagSource.newInstanceTwo);\n            Reflect.attribute();\n            Reflect.construction();\n            Reflect.privateMethod();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n","source":"_posts/2022/java/java-反射.md","raw":"---\ntitle: Java高级特性-反射\ndate: 2022-03-30 18:17:18\ncategories:\n - Java\ntags:\n - Java\ncover: https://s1.ax1x.com/2022/03/30/q2mOxI.jpg\n---\n# 前言\n **[JAVA反射机制](https://baike.baidu.com/item/JAVA%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/6015990)是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意方法和属性；这种动态获取信息以及动态调用对象方法的功能称为java语言的反射机制。**\n\n# 应用场景\nAndroid中最熟悉的反射，莫过于Json数据的转换，例如网络数据，数据库数据和类之间的相互转化。使用反射机制可以直接创建对象，方便代码管理。\n\n# 相关类\n[. Class](https://developer.android.google.cn/reference/java/lang/Class)\n* class类下部分常用方法\n\n| 方法名| 翻译 |\n| :-----:|:----: |\n| [forName(String className)](https://developer.android.google.cn/reference/java/lang/Class#forName(java.lang.String,%20boolean,%20java.lang.ClassLoader)) | 加载参数指定的类，并且初始化它。|\n| [cast](https://developer.android.google.cn/reference/java/lang/Class#cast(java.lang.Object)) | 对象转换成代表类或是接口的对象|\n| [getClasses()](https://developer.android.google.cn/reference/java/lang/Class#cast(java.lang.Object)) |返回一个数组，数组中包含该类中所有公共类和接口类的对象|\n| [getName()](https://developer.android.google.cn/reference/java/lang/Class#getName()) |获取类路径名称|\n| [newInstance](https://developer.android.google.cn/reference/java/lang/Class#newInstance()) |创建类的实例\n| [getPackage()](https://developer.android.google.cn/reference/java/lang/Class#getPackage()) |获取类所在包|\n| [getInterfaces()](https://developer.android.google.cn/reference/java/lang/Class#getPackage()) |确定此对象所表示的类或接口实现的接口|\n| [getSuperclass()](https://developer.android.google.cn/reference/java/lang/Class#getSuperclass()) |获得当前类继承的父类的名字|\n| [getClassLoader()](https://developer.android.google.cn/reference/java/lang/Class#getClassLoader()) |获取类加载器|\n| [getDeclaredClasses()](https://developer.android.google.cn/reference/java/lang/Class#getDeclaredClasses()) |返回一个数组，数组中包含该类中所有类和接口类的对象|\n\n* Class类下相关属性方法\n\n| 方法名| 翻译 |\n| :-----:|:----: |\n| [getField(String name)](https://developer.android.google.cn/reference/java/lang/Class#getField(java.lang.String)) | 获取某个公有的属性对象 |\n| [getFields()](https://developer.android.google.cn/reference/java/lang/Class#getFields()) | 获取所有公有的属性对象 |\n| [getDeclaredField(String name)](https://developer.android.google.cn/reference/java/lang/Class#getDeclaredField(java.lang.String))) | 获取某个私有属性对象 |\n| [getDeclaredFields()](https://developer.android.google.cn/reference/java/lang/Class#getDeclaredFields()) | 获取所有私有属性对象 |\n\n* Class 类下相关注解方法\n\n| 方法名| 翻译 |\n| :-----:|:----: |\n| [getDeclaredAnnotations()](https://developer.android.google.cn/reference/java/lang/Class#getDeclaredAnnotations()) | 返回对应类下所有注解对象|\n| [getDeclaredAnnotation(Class<A> annotationClass)](https://developer.android.google.cn/reference/java/lang/Class#getDeclaredAnnotation(java.lang.Class%3CA%3E)) | 返回对应类中与参数类型匹配的所有注解对象|\n| [getAnnotation(Class<A> annotationClass)](https://developer.android.google.cn/reference/java/lang/Class#getAnnotation(java.lang.Class%3CA%3E)) | 返回对应类中与参数类型匹配的公有注解对象|\n| [getAnnotations ()](https://developer.android.google.cn/reference/java/lang/Class#getAnnotations()) | 返回对应类中所有公有注解对象|\n\n* Class 类下其它相关方法\n\n| 方法名| 翻译 |\n| :-----:|:----: |\n| [getMethods()](https://developer.android.google.cn/reference/java/lang/Class#getMethods()) | 返回该类所有公有的方法|\n| [getMethod (String name, Class...<?> parameterTypes)](https://developer.android.google.cn/reference/java/lang/Class#getMethod(java.lang.String,%20java.lang.Class%3C?%3E...)) | 返回该类某个公有方法|\n| [getDeclaredMethod(String name, Class...<?> parameterTypes)](https://developer.android.google.cn/reference/java/lang/Class#getDeclaredMethod(java.lang.String,%20java.lang.Class%3C?%3E...)) | 返回该类某个方法|\n| [getDeclaredMethods()](https://developer.android.google.cn/reference/java/lang/Class#getDeclaredMethods()) | 返回该类所有方法|\n\n[. Method](https://developer.android.google.cn/reference/java/lang/reflect/Field)\n* Method类下部分常用方法\n\n| 方法名| 翻译 |\n| :-----:|:----: |\n| [invoke(Object obj, Object... args)](https://developer.android.google.cn/reference/java/lang/reflect/Method#invoke(java.lang.Object,%20java.lang.Object...)) | 传递object对象及参数调用该对象对应的方法|\n\n[. Field](https://developer.android.google.cn/reference/java/lang/reflect/Field)\n* Field类下部分常用方法\n\n| 方法名| 翻译 |\n| :-----:|:----: |\n| [get(Object obj)](https://developer.android.google.cn/reference/java/lang/reflect/Field#get(java.lang.Object)) | 获得obj中对应的属性值|\n| [set(Object obj, Object value)](https://developer.android.google.cn/reference/java/lang/reflect/Field#set(java.lang.Object,%20java.lang.Object)) | 设置obj中对应属性值|\n\n[. Constructor](https://developer.android.google.cn/reference/java/lang/reflect/Constructor)\n* Constructor类下部分常用方法\n\n| 方法名| 翻译 |\n| :-----:|:----: |\n| [newInstance(Object... initargs)](https://developer.android.google.cn/reference/java/lang/reflect/Constructor#newInstance(java.lang.Object...)) | 根据传递的参数创建类的对象|\n\n\n# 示例\n* 反射实体类\n```java\npublic class GloryOfKings {\n\n    private String role;\n    private String skills;\n    private String explain;\n\n    public GloryOfKings() {\n    }\n\n    private GloryOfKings(String role, String skills) {\n        this.role = role;\n        this.skills = skills;\n    }\n\n    public String getRole() {\n        return role;\n    }\n\n    public void setRole(String role) {\n        this.role = role;\n    }\n\n    public String getSkills() {\n        return skills;\n    }\n\n    public void setSkills(String skills) {\n        this.skills = skills;\n    }\n\n    public void setExplain(String explain) {\n        this.explain = explain;\n    }\n\n    public String getExplain() {\n        return explain;\n    }\n\n    private String week(int flag) {\n        String string = \"\";\n        switch (flag) {\n            case FlagMethod.monday:\n                string = \"天气晴朗\";\n                break;\n            case FlagMethod.tuesday:\n                string = \"多云\";\n                break;\n            case FlagMethod.Wednesday:\n                string = \"微风\";\n                break;\n            case FlagMethod.Thursday:\n                string = \"阵风6级\";\n                break;\n            case FlagMethod.Friday:\n                string = \"中雨\";\n                break;\n            case FlagMethod.Saturday:\n                string = \"大雨\";\n                break;\n            case FlagMethod.Sunday:\n                string = \"晴朗\";\n                break;\n            default:\n                string = \"-.-\";\n        }\n\n        return string;\n    }\n}\n\n```\n* 逻辑封装类\n```java\npublic class Reflect {\n    /**\n     * 反射-创建对象（三种方式：.class、new MyClass().getClass，Class.forName(\"类的全路径\")）\n     */\n    public static void newInstance(int flag) {\n        String outMessage = \"\";\n        try {\n            switch (flag) {\n                case FlagSource.newInstanceOne:\n                    Class<GloryOfKings> cls = GloryOfKings.class;\n                    GloryOfKings gloryOfKings = cls.newInstance();\n                    gloryOfKings.setExplain(\"创建对象方式- GloryOfKings.class\");\n                    gloryOfKings.setRole(\"李元芳\");\n                    gloryOfKings.setSkills(\"利刃风暴\");\n                    outMessage = gloryOfKings.toString();\n                    break;\n                case FlagSource.newInstanceTwo:\n                    Class<? extends GloryOfKings> cls1 = new GloryOfKings().getClass();\n                    GloryOfKings gloryOfKings1 = cls1.newInstance();\n                    gloryOfKings1.setExplain(\"创建对象方式- new GloryOfKings().getClass()\");\n                    gloryOfKings1.setRole(\"后羿\");\n                    gloryOfKings1.setSkills(\"灼日之矢”\");\n                    outMessage = gloryOfKings1.toString();\n                    break;\n                case FlagSource.newInstanceThree:\n                    Class<?> cls2 = Class.forName(\"com.linked.business.reflect.GloryOfKings\");\n                    GloryOfKings gloryOfKings2 = (GloryOfKings) cls2.newInstance();\n                    gloryOfKings2.setExplain(\"创建对象方式- Class.forName()\");\n                    gloryOfKings2.setRole(\"诸葛亮\");\n                    gloryOfKings2.setSkills(\"时空穿梭”\");\n                    outMessage = gloryOfKings2.toString();\n                    break;\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        System.out.println(outMessage);\n    }\n\n    /**\n     * 反射-私有构造方法\n     */\n    public static void construction() {\n        try {\n            Class<?> cls = Class.forName(\"com.linked.business.reflect.GloryOfKings\");\n            Constructor<?> constructor = cls.getDeclaredConstructor(String.class, String.class);\n            constructor.setAccessible(true);\n            Object obj = constructor.newInstance(\" 反射-设置私有构造方法：名称\", \" 反射-获取私有构造方法：福利\");\n            GloryOfKings go = (GloryOfKings) obj;\n            System.out.println(\"反射-获取私有构造方法\" + go);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    /**\n     * 反射-私有属性\n     */\n    public static void reflectDeclaredAttribute() {\n        try {\n            Class<?> cls = Class.forName(\"com.linked.business.reflect.GloryOfKings\");\n            Object obj = cls.newInstance();\n            Field field = cls.getDeclaredField(\"TAG\");\n            field.setAccessible(true);\n            String str = (String) field.get(obj);\n            System.out.println(\"反射-获取私有属性\" + str);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    /**\n     * 反射-私有方法\n     * <p>将此对象的 accessible 标志设置为指示的布尔值。值为 true 则指示反射的对象在使用时应该取消 Java 语言访问检查。值为 false 则指示反射的对象应该实施 Java 语言访问检查;\n     * 实际上setAccessible是启用和禁用访问安全检查的开关,并不是为true就能访问为false就不能访问 ；\n     * 由于JDK的安全检查耗时较多.所以通过setAccessible(true)的方式关闭安全检查就可以达到提升反射速度的目的\n     * </p>\n     */\n    public static void privateMethod() {\n        try {\n            Class<?> cls = Class.forName(\"com.linked.business.reflect.GloryOfKings\");\n            Method method = cls.getDeclaredMethod(\"week\", int.class);\n            method.setAccessible(true);\n            Object obj = cls.newInstance();\n            //invoke：传递object对象及参数调用该对象对应的方法\n            String str = (String) method.invoke(obj, FlagMethod.monday);\n            System.out.println(str);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n* 测试类\n```java\npublic class ReflectTest {\n    public static void main(String[] args) {\n        try {\n            Reflect.newInstance(FlagSource.newInstanceTwo);\n            Reflect.attribute();\n            Reflect.construction();\n            Reflect.privateMethod();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n","slug":"java-反射","published":1,"relaxed":"java","updated":"2022-04-03T11:57:46.150Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl2vhlmfz000lt6fye9ui2mth","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p> <strong><a href=\"https://baike.baidu.com/item/JAVA%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/6015990\">JAVA反射机制</a>是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意方法和属性；这种动态获取信息以及动态调用对象方法的功能称为java语言的反射机制。</strong></p>\n<h1 id=\"应用场景\"><a href=\"#应用场景\" class=\"headerlink\" title=\"应用场景\"></a>应用场景</h1><p>Android中最熟悉的反射，莫过于Json数据的转换，例如网络数据，数据库数据和类之间的相互转化。使用反射机制可以直接创建对象，方便代码管理。</p>\n<h1 id=\"相关类\"><a href=\"#相关类\" class=\"headerlink\" title=\"相关类\"></a>相关类</h1><p><a href=\"https://developer.android.google.cn/reference/java/lang/Class\">. Class</a></p>\n<ul>\n<li>class类下部分常用方法</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法名</th>\n<th align=\"center\">翻译</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#forName(java.lang.String,%20boolean,%20java.lang.ClassLoader)\">forName(String className)</a></td>\n<td align=\"center\">加载参数指定的类，并且初始化它。</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#cast(java.lang.Object)\">cast</a></td>\n<td align=\"center\">对象转换成代表类或是接口的对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#cast(java.lang.Object)\">getClasses()</a></td>\n<td align=\"center\">返回一个数组，数组中包含该类中所有公共类和接口类的对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getName()\">getName()</a></td>\n<td align=\"center\">获取类路径名称</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#newInstance()\">newInstance</a></td>\n<td align=\"center\">创建类的实例</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getPackage()\">getPackage()</a></td>\n<td align=\"center\">获取类所在包</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getPackage()\">getInterfaces()</a></td>\n<td align=\"center\">确定此对象所表示的类或接口实现的接口</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getSuperclass()\">getSuperclass()</a></td>\n<td align=\"center\">获得当前类继承的父类的名字</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getClassLoader()\">getClassLoader()</a></td>\n<td align=\"center\">获取类加载器</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getDeclaredClasses()\">getDeclaredClasses()</a></td>\n<td align=\"center\">返回一个数组，数组中包含该类中所有类和接口类的对象</td>\n</tr>\n</tbody></table>\n<ul>\n<li>Class类下相关属性方法</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法名</th>\n<th align=\"center\">翻译</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getField(java.lang.String)\">getField(String name)</a></td>\n<td align=\"center\">获取某个公有的属性对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getFields()\">getFields()</a></td>\n<td align=\"center\">获取所有公有的属性对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getDeclaredField(java.lang.String)\">getDeclaredField(String name)</a>)</td>\n<td align=\"center\">获取某个私有属性对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getDeclaredFields()\">getDeclaredFields()</a></td>\n<td align=\"center\">获取所有私有属性对象</td>\n</tr>\n</tbody></table>\n<ul>\n<li>Class 类下相关注解方法</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法名</th>\n<th align=\"center\">翻译</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getDeclaredAnnotations()\">getDeclaredAnnotations()</a></td>\n<td align=\"center\">返回对应类下所有注解对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getDeclaredAnnotation(java.lang.Class%3CA%3E)\">getDeclaredAnnotation(Class<A> annotationClass)</a></td>\n<td align=\"center\">返回对应类中与参数类型匹配的所有注解对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getAnnotation(java.lang.Class%3CA%3E)\">getAnnotation(Class<A> annotationClass)</a></td>\n<td align=\"center\">返回对应类中与参数类型匹配的公有注解对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getAnnotations()\">getAnnotations ()</a></td>\n<td align=\"center\">返回对应类中所有公有注解对象</td>\n</tr>\n</tbody></table>\n<ul>\n<li>Class 类下其它相关方法</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法名</th>\n<th align=\"center\">翻译</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getMethods()\">getMethods()</a></td>\n<td align=\"center\">返回该类所有公有的方法</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getMethod(java.lang.String,%20java.lang.Class%3C?%3E...)\">getMethod (String name, Class…&lt;?&gt; parameterTypes)</a></td>\n<td align=\"center\">返回该类某个公有方法</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getDeclaredMethod(java.lang.String,%20java.lang.Class%3C?%3E...)\">getDeclaredMethod(String name, Class…&lt;?&gt; parameterTypes)</a></td>\n<td align=\"center\">返回该类某个方法</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getDeclaredMethods()\">getDeclaredMethods()</a></td>\n<td align=\"center\">返回该类所有方法</td>\n</tr>\n</tbody></table>\n<p><a href=\"https://developer.android.google.cn/reference/java/lang/reflect/Field\">. Method</a></p>\n<ul>\n<li>Method类下部分常用方法</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法名</th>\n<th align=\"center\">翻译</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/reflect/Method#invoke(java.lang.Object,%20java.lang.Object...)\">invoke(Object obj, Object… args)</a></td>\n<td align=\"center\">传递object对象及参数调用该对象对应的方法</td>\n</tr>\n</tbody></table>\n<p><a href=\"https://developer.android.google.cn/reference/java/lang/reflect/Field\">. Field</a></p>\n<ul>\n<li>Field类下部分常用方法</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法名</th>\n<th align=\"center\">翻译</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/reflect/Field#get(java.lang.Object)\">get(Object obj)</a></td>\n<td align=\"center\">获得obj中对应的属性值</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/reflect/Field#set(java.lang.Object,%20java.lang.Object)\">set(Object obj, Object value)</a></td>\n<td align=\"center\">设置obj中对应属性值</td>\n</tr>\n</tbody></table>\n<p><a href=\"https://developer.android.google.cn/reference/java/lang/reflect/Constructor\">. Constructor</a></p>\n<ul>\n<li>Constructor类下部分常用方法</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法名</th>\n<th align=\"center\">翻译</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/reflect/Constructor#newInstance(java.lang.Object...)\">newInstance(Object… initargs)</a></td>\n<td align=\"center\">根据传递的参数创建类的对象</td>\n</tr>\n</tbody></table>\n<h1 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h1><ul>\n<li>反射实体类<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GloryOfKings</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String role;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String skills;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String explain;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">GloryOfKings</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">GloryOfKings</span><span class=\"params\">(String role, String skills)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.role = role;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.skills = skills;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getRole</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> role;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setRole</span><span class=\"params\">(String role)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.role = role;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getSkills</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> skills;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setSkills</span><span class=\"params\">(String skills)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.skills = skills;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setExplain</span><span class=\"params\">(String explain)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.explain = explain;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getExplain</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> explain;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String <span class=\"title function_\">week</span><span class=\"params\">(<span class=\"type\">int</span> flag)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">string</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (flag) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> FlagMethod.monday:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;天气晴朗&quot;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> FlagMethod.tuesday:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;多云&quot;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> FlagMethod.Wednesday:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;微风&quot;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> FlagMethod.Thursday:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;阵风6级&quot;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> FlagMethod.Friday:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;中雨&quot;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> FlagMethod.Saturday:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;大雨&quot;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> FlagMethod.Sunday:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;晴朗&quot;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;-.-&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> string;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n<li>逻辑封装类<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Reflect</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 反射-创建对象（三种方式：.class、new MyClass().getClass，Class.forName(&quot;类的全路径&quot;)）</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">newInstance</span><span class=\"params\">(<span class=\"type\">int</span> flag)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">outMessage</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">switch</span> (flag) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> FlagSource.newInstanceOne:</span><br><span class=\"line\">                    Class&lt;GloryOfKings&gt; cls = GloryOfKings.class;</span><br><span class=\"line\">                    <span class=\"type\">GloryOfKings</span> <span class=\"variable\">gloryOfKings</span> <span class=\"operator\">=</span> cls.newInstance();</span><br><span class=\"line\">                    gloryOfKings.setExplain(<span class=\"string\">&quot;创建对象方式- GloryOfKings.class&quot;</span>);</span><br><span class=\"line\">                    gloryOfKings.setRole(<span class=\"string\">&quot;李元芳&quot;</span>);</span><br><span class=\"line\">                    gloryOfKings.setSkills(<span class=\"string\">&quot;利刃风暴&quot;</span>);</span><br><span class=\"line\">                    outMessage = gloryOfKings.toString();</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> FlagSource.newInstanceTwo:</span><br><span class=\"line\">                    Class&lt;? <span class=\"keyword\">extends</span> <span class=\"title class_\">GloryOfKings</span>&gt; cls1 = <span class=\"keyword\">new</span> <span class=\"title class_\">GloryOfKings</span>().getClass();</span><br><span class=\"line\">                    <span class=\"type\">GloryOfKings</span> <span class=\"variable\">gloryOfKings1</span> <span class=\"operator\">=</span> cls1.newInstance();</span><br><span class=\"line\">                    gloryOfKings1.setExplain(<span class=\"string\">&quot;创建对象方式- new GloryOfKings().getClass()&quot;</span>);</span><br><span class=\"line\">                    gloryOfKings1.setRole(<span class=\"string\">&quot;后羿&quot;</span>);</span><br><span class=\"line\">                    gloryOfKings1.setSkills(<span class=\"string\">&quot;灼日之矢”&quot;</span>);</span><br><span class=\"line\">                    outMessage = gloryOfKings1.toString();</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> FlagSource.newInstanceThree:</span><br><span class=\"line\">                    Class&lt;?&gt; cls2 = Class.forName(<span class=\"string\">&quot;com.linked.business.reflect.GloryOfKings&quot;</span>);</span><br><span class=\"line\">                    <span class=\"type\">GloryOfKings</span> <span class=\"variable\">gloryOfKings2</span> <span class=\"operator\">=</span> (GloryOfKings) cls2.newInstance();</span><br><span class=\"line\">                    gloryOfKings2.setExplain(<span class=\"string\">&quot;创建对象方式- Class.forName()&quot;</span>);</span><br><span class=\"line\">                    gloryOfKings2.setRole(<span class=\"string\">&quot;诸葛亮&quot;</span>);</span><br><span class=\"line\">                    gloryOfKings2.setSkills(<span class=\"string\">&quot;时空穿梭”&quot;</span>);</span><br><span class=\"line\">                    outMessage = gloryOfKings2.toString();</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(outMessage);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 反射-私有构造方法</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">construction</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Class&lt;?&gt; cls = Class.forName(<span class=\"string\">&quot;com.linked.business.reflect.GloryOfKings&quot;</span>);</span><br><span class=\"line\">            Constructor&lt;?&gt; constructor = cls.getDeclaredConstructor(String.class, String.class);</span><br><span class=\"line\">            constructor.setAccessible(<span class=\"literal\">true</span>);</span><br><span class=\"line\">            <span class=\"type\">Object</span> <span class=\"variable\">obj</span> <span class=\"operator\">=</span> constructor.newInstance(<span class=\"string\">&quot; 反射-设置私有构造方法：名称&quot;</span>, <span class=\"string\">&quot; 反射-获取私有构造方法：福利&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">GloryOfKings</span> <span class=\"variable\">go</span> <span class=\"operator\">=</span> (GloryOfKings) obj;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;反射-获取私有构造方法&quot;</span> + go);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 反射-私有属性</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">reflectDeclaredAttribute</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Class&lt;?&gt; cls = Class.forName(<span class=\"string\">&quot;com.linked.business.reflect.GloryOfKings&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">Object</span> <span class=\"variable\">obj</span> <span class=\"operator\">=</span> cls.newInstance();</span><br><span class=\"line\">            <span class=\"type\">Field</span> <span class=\"variable\">field</span> <span class=\"operator\">=</span> cls.getDeclaredField(<span class=\"string\">&quot;TAG&quot;</span>);</span><br><span class=\"line\">            field.setAccessible(<span class=\"literal\">true</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> (String) field.get(obj);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;反射-获取私有属性&quot;</span> + str);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 反射-私有方法</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;将此对象的 accessible 标志设置为指示的布尔值。值为 true 则指示反射的对象在使用时应该取消 Java 语言访问检查。值为 false 则指示反射的对象应该实施 Java 语言访问检查;</span></span><br><span class=\"line\"><span class=\"comment\">     * 实际上setAccessible是启用和禁用访问安全检查的开关,并不是为true就能访问为false就不能访问 ；</span></span><br><span class=\"line\"><span class=\"comment\">     * 由于JDK的安全检查耗时较多.所以通过setAccessible(true)的方式关闭安全检查就可以达到提升反射速度的目的</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">privateMethod</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Class&lt;?&gt; cls = Class.forName(<span class=\"string\">&quot;com.linked.business.reflect.GloryOfKings&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">Method</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> cls.getDeclaredMethod(<span class=\"string\">&quot;week&quot;</span>, <span class=\"type\">int</span>.class);</span><br><span class=\"line\">            method.setAccessible(<span class=\"literal\">true</span>);</span><br><span class=\"line\">            <span class=\"type\">Object</span> <span class=\"variable\">obj</span> <span class=\"operator\">=</span> cls.newInstance();</span><br><span class=\"line\">            <span class=\"comment\">//invoke：传递object对象及参数调用该对象对应的方法</span></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> (String) method.invoke(obj, FlagMethod.monday);</span><br><span class=\"line\">            System.out.println(str);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li>测试类<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ReflectTest</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Reflect.newInstance(FlagSource.newInstanceTwo);</span><br><span class=\"line\">            Reflect.attribute();</span><br><span class=\"line\">            Reflect.construction();</span><br><span class=\"line\">            Reflect.privateMethod();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p> <strong><a href=\"https://baike.baidu.com/item/JAVA%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/6015990\">JAVA反射机制</a>是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意方法和属性；这种动态获取信息以及动态调用对象方法的功能称为java语言的反射机制。</strong></p>\n<h1 id=\"应用场景\"><a href=\"#应用场景\" class=\"headerlink\" title=\"应用场景\"></a>应用场景</h1><p>Android中最熟悉的反射，莫过于Json数据的转换，例如网络数据，数据库数据和类之间的相互转化。使用反射机制可以直接创建对象，方便代码管理。</p>\n<h1 id=\"相关类\"><a href=\"#相关类\" class=\"headerlink\" title=\"相关类\"></a>相关类</h1><p><a href=\"https://developer.android.google.cn/reference/java/lang/Class\">. Class</a></p>\n<ul>\n<li>class类下部分常用方法</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法名</th>\n<th align=\"center\">翻译</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#forName(java.lang.String,%20boolean,%20java.lang.ClassLoader)\">forName(String className)</a></td>\n<td align=\"center\">加载参数指定的类，并且初始化它。</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#cast(java.lang.Object)\">cast</a></td>\n<td align=\"center\">对象转换成代表类或是接口的对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#cast(java.lang.Object)\">getClasses()</a></td>\n<td align=\"center\">返回一个数组，数组中包含该类中所有公共类和接口类的对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getName()\">getName()</a></td>\n<td align=\"center\">获取类路径名称</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#newInstance()\">newInstance</a></td>\n<td align=\"center\">创建类的实例</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getPackage()\">getPackage()</a></td>\n<td align=\"center\">获取类所在包</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getPackage()\">getInterfaces()</a></td>\n<td align=\"center\">确定此对象所表示的类或接口实现的接口</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getSuperclass()\">getSuperclass()</a></td>\n<td align=\"center\">获得当前类继承的父类的名字</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getClassLoader()\">getClassLoader()</a></td>\n<td align=\"center\">获取类加载器</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getDeclaredClasses()\">getDeclaredClasses()</a></td>\n<td align=\"center\">返回一个数组，数组中包含该类中所有类和接口类的对象</td>\n</tr>\n</tbody></table>\n<ul>\n<li>Class类下相关属性方法</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法名</th>\n<th align=\"center\">翻译</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getField(java.lang.String)\">getField(String name)</a></td>\n<td align=\"center\">获取某个公有的属性对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getFields()\">getFields()</a></td>\n<td align=\"center\">获取所有公有的属性对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getDeclaredField(java.lang.String)\">getDeclaredField(String name)</a>)</td>\n<td align=\"center\">获取某个私有属性对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getDeclaredFields()\">getDeclaredFields()</a></td>\n<td align=\"center\">获取所有私有属性对象</td>\n</tr>\n</tbody></table>\n<ul>\n<li>Class 类下相关注解方法</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法名</th>\n<th align=\"center\">翻译</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getDeclaredAnnotations()\">getDeclaredAnnotations()</a></td>\n<td align=\"center\">返回对应类下所有注解对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getDeclaredAnnotation(java.lang.Class%3CA%3E)\">getDeclaredAnnotation(Class<A> annotationClass)</a></td>\n<td align=\"center\">返回对应类中与参数类型匹配的所有注解对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getAnnotation(java.lang.Class%3CA%3E)\">getAnnotation(Class<A> annotationClass)</a></td>\n<td align=\"center\">返回对应类中与参数类型匹配的公有注解对象</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getAnnotations()\">getAnnotations ()</a></td>\n<td align=\"center\">返回对应类中所有公有注解对象</td>\n</tr>\n</tbody></table>\n<ul>\n<li>Class 类下其它相关方法</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法名</th>\n<th align=\"center\">翻译</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getMethods()\">getMethods()</a></td>\n<td align=\"center\">返回该类所有公有的方法</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getMethod(java.lang.String,%20java.lang.Class%3C?%3E...)\">getMethod (String name, Class…&lt;?&gt; parameterTypes)</a></td>\n<td align=\"center\">返回该类某个公有方法</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getDeclaredMethod(java.lang.String,%20java.lang.Class%3C?%3E...)\">getDeclaredMethod(String name, Class…&lt;?&gt; parameterTypes)</a></td>\n<td align=\"center\">返回该类某个方法</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/Class#getDeclaredMethods()\">getDeclaredMethods()</a></td>\n<td align=\"center\">返回该类所有方法</td>\n</tr>\n</tbody></table>\n<p><a href=\"https://developer.android.google.cn/reference/java/lang/reflect/Field\">. Method</a></p>\n<ul>\n<li>Method类下部分常用方法</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法名</th>\n<th align=\"center\">翻译</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/reflect/Method#invoke(java.lang.Object,%20java.lang.Object...)\">invoke(Object obj, Object… args)</a></td>\n<td align=\"center\">传递object对象及参数调用该对象对应的方法</td>\n</tr>\n</tbody></table>\n<p><a href=\"https://developer.android.google.cn/reference/java/lang/reflect/Field\">. Field</a></p>\n<ul>\n<li>Field类下部分常用方法</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法名</th>\n<th align=\"center\">翻译</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/reflect/Field#get(java.lang.Object)\">get(Object obj)</a></td>\n<td align=\"center\">获得obj中对应的属性值</td>\n</tr>\n<tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/reflect/Field#set(java.lang.Object,%20java.lang.Object)\">set(Object obj, Object value)</a></td>\n<td align=\"center\">设置obj中对应属性值</td>\n</tr>\n</tbody></table>\n<p><a href=\"https://developer.android.google.cn/reference/java/lang/reflect/Constructor\">. Constructor</a></p>\n<ul>\n<li>Constructor类下部分常用方法</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法名</th>\n<th align=\"center\">翻译</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"https://developer.android.google.cn/reference/java/lang/reflect/Constructor#newInstance(java.lang.Object...)\">newInstance(Object… initargs)</a></td>\n<td align=\"center\">根据传递的参数创建类的对象</td>\n</tr>\n</tbody></table>\n<h1 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h1><ul>\n<li>反射实体类<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GloryOfKings</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String role;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String skills;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String explain;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">GloryOfKings</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">GloryOfKings</span><span class=\"params\">(String role, String skills)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.role = role;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.skills = skills;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getRole</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> role;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setRole</span><span class=\"params\">(String role)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.role = role;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getSkills</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> skills;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setSkills</span><span class=\"params\">(String skills)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.skills = skills;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setExplain</span><span class=\"params\">(String explain)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.explain = explain;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getExplain</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> explain;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String <span class=\"title function_\">week</span><span class=\"params\">(<span class=\"type\">int</span> flag)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">string</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (flag) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> FlagMethod.monday:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;天气晴朗&quot;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> FlagMethod.tuesday:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;多云&quot;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> FlagMethod.Wednesday:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;微风&quot;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> FlagMethod.Thursday:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;阵风6级&quot;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> FlagMethod.Friday:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;中雨&quot;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> FlagMethod.Saturday:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;大雨&quot;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> FlagMethod.Sunday:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;晴朗&quot;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                string = <span class=\"string\">&quot;-.-&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> string;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n<li>逻辑封装类<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Reflect</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 反射-创建对象（三种方式：.class、new MyClass().getClass，Class.forName(&quot;类的全路径&quot;)）</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">newInstance</span><span class=\"params\">(<span class=\"type\">int</span> flag)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">outMessage</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">switch</span> (flag) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> FlagSource.newInstanceOne:</span><br><span class=\"line\">                    Class&lt;GloryOfKings&gt; cls = GloryOfKings.class;</span><br><span class=\"line\">                    <span class=\"type\">GloryOfKings</span> <span class=\"variable\">gloryOfKings</span> <span class=\"operator\">=</span> cls.newInstance();</span><br><span class=\"line\">                    gloryOfKings.setExplain(<span class=\"string\">&quot;创建对象方式- GloryOfKings.class&quot;</span>);</span><br><span class=\"line\">                    gloryOfKings.setRole(<span class=\"string\">&quot;李元芳&quot;</span>);</span><br><span class=\"line\">                    gloryOfKings.setSkills(<span class=\"string\">&quot;利刃风暴&quot;</span>);</span><br><span class=\"line\">                    outMessage = gloryOfKings.toString();</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> FlagSource.newInstanceTwo:</span><br><span class=\"line\">                    Class&lt;? <span class=\"keyword\">extends</span> <span class=\"title class_\">GloryOfKings</span>&gt; cls1 = <span class=\"keyword\">new</span> <span class=\"title class_\">GloryOfKings</span>().getClass();</span><br><span class=\"line\">                    <span class=\"type\">GloryOfKings</span> <span class=\"variable\">gloryOfKings1</span> <span class=\"operator\">=</span> cls1.newInstance();</span><br><span class=\"line\">                    gloryOfKings1.setExplain(<span class=\"string\">&quot;创建对象方式- new GloryOfKings().getClass()&quot;</span>);</span><br><span class=\"line\">                    gloryOfKings1.setRole(<span class=\"string\">&quot;后羿&quot;</span>);</span><br><span class=\"line\">                    gloryOfKings1.setSkills(<span class=\"string\">&quot;灼日之矢”&quot;</span>);</span><br><span class=\"line\">                    outMessage = gloryOfKings1.toString();</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> FlagSource.newInstanceThree:</span><br><span class=\"line\">                    Class&lt;?&gt; cls2 = Class.forName(<span class=\"string\">&quot;com.linked.business.reflect.GloryOfKings&quot;</span>);</span><br><span class=\"line\">                    <span class=\"type\">GloryOfKings</span> <span class=\"variable\">gloryOfKings2</span> <span class=\"operator\">=</span> (GloryOfKings) cls2.newInstance();</span><br><span class=\"line\">                    gloryOfKings2.setExplain(<span class=\"string\">&quot;创建对象方式- Class.forName()&quot;</span>);</span><br><span class=\"line\">                    gloryOfKings2.setRole(<span class=\"string\">&quot;诸葛亮&quot;</span>);</span><br><span class=\"line\">                    gloryOfKings2.setSkills(<span class=\"string\">&quot;时空穿梭”&quot;</span>);</span><br><span class=\"line\">                    outMessage = gloryOfKings2.toString();</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(outMessage);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 反射-私有构造方法</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">construction</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Class&lt;?&gt; cls = Class.forName(<span class=\"string\">&quot;com.linked.business.reflect.GloryOfKings&quot;</span>);</span><br><span class=\"line\">            Constructor&lt;?&gt; constructor = cls.getDeclaredConstructor(String.class, String.class);</span><br><span class=\"line\">            constructor.setAccessible(<span class=\"literal\">true</span>);</span><br><span class=\"line\">            <span class=\"type\">Object</span> <span class=\"variable\">obj</span> <span class=\"operator\">=</span> constructor.newInstance(<span class=\"string\">&quot; 反射-设置私有构造方法：名称&quot;</span>, <span class=\"string\">&quot; 反射-获取私有构造方法：福利&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">GloryOfKings</span> <span class=\"variable\">go</span> <span class=\"operator\">=</span> (GloryOfKings) obj;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;反射-获取私有构造方法&quot;</span> + go);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 反射-私有属性</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">reflectDeclaredAttribute</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Class&lt;?&gt; cls = Class.forName(<span class=\"string\">&quot;com.linked.business.reflect.GloryOfKings&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">Object</span> <span class=\"variable\">obj</span> <span class=\"operator\">=</span> cls.newInstance();</span><br><span class=\"line\">            <span class=\"type\">Field</span> <span class=\"variable\">field</span> <span class=\"operator\">=</span> cls.getDeclaredField(<span class=\"string\">&quot;TAG&quot;</span>);</span><br><span class=\"line\">            field.setAccessible(<span class=\"literal\">true</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> (String) field.get(obj);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;反射-获取私有属性&quot;</span> + str);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 反射-私有方法</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;将此对象的 accessible 标志设置为指示的布尔值。值为 true 则指示反射的对象在使用时应该取消 Java 语言访问检查。值为 false 则指示反射的对象应该实施 Java 语言访问检查;</span></span><br><span class=\"line\"><span class=\"comment\">     * 实际上setAccessible是启用和禁用访问安全检查的开关,并不是为true就能访问为false就不能访问 ；</span></span><br><span class=\"line\"><span class=\"comment\">     * 由于JDK的安全检查耗时较多.所以通过setAccessible(true)的方式关闭安全检查就可以达到提升反射速度的目的</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">privateMethod</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Class&lt;?&gt; cls = Class.forName(<span class=\"string\">&quot;com.linked.business.reflect.GloryOfKings&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">Method</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> cls.getDeclaredMethod(<span class=\"string\">&quot;week&quot;</span>, <span class=\"type\">int</span>.class);</span><br><span class=\"line\">            method.setAccessible(<span class=\"literal\">true</span>);</span><br><span class=\"line\">            <span class=\"type\">Object</span> <span class=\"variable\">obj</span> <span class=\"operator\">=</span> cls.newInstance();</span><br><span class=\"line\">            <span class=\"comment\">//invoke：传递object对象及参数调用该对象对应的方法</span></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> (String) method.invoke(obj, FlagMethod.monday);</span><br><span class=\"line\">            System.out.println(str);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li>测试类<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ReflectTest</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Reflect.newInstance(FlagSource.newInstanceTwo);</span><br><span class=\"line\">            Reflect.attribute();</span><br><span class=\"line\">            Reflect.construction();</span><br><span class=\"line\">            Reflect.privateMethod();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n"},{"title":"Java-链表（单向、循环、双向）","date":"2022-03-23T15:58:35.000Z","cover":"https://s1.ax1x.com/2022/03/24/q32XLT.jpg","_content":"\n## 前言：\n\n什么是链表？链表是一种常见的基础数据结构，是一种线性表，但并不会按线性的顺序存储数据，而是在每一个节点里存到下一个节点的指针来做关联，同时链表也分为，单链表、双链表、循环链表。\n\n## 单链表（单向链表）\n\n### 单链表由两个部分构成\n\n*   DATA域：数据域、用来存储数据元素\n*   NEXT域：指针域、用来指向下一个节点\n\n![单链表](https://s1.ax1x.com/2022/03/24/q3RB60.jpg)\n\n链表与数组类似,也可以进行查找、插入、删除、读取等操作,但是由于链表与数组的特性不同,导致不同操作的复杂度也不同\n\n### 查找方式\n\n*   从头节点进入,开始比对节点的值,如果不同则通过指针进入下一个节点\n*   重复上面的动作,直到找到相同的值,或者节点的指针指向null\n\n*   时间复杂度为O(n)\n\n### 插入或删除方式\n\n链表与数组最大的不同就在于删除、插入的性能优势,由于链表是非连续的内存,所以不用像数组一样在插入、删除操作的时候需要进行大面积的成员位移,比如在a、b节点之间插入一个新节点c,链表只需要做\n\n*   a断开指向b的指针，将指针指向c\n*   c节点将指针指向b，完毕（这才是魅力所在）\n\n插入或删除只需要调整指针即可。\n\n时间复杂度为O(1)\n\n下面看下链表的插入、删除操作\n\n![单链表插入&删除](https://s1.ax1x.com/2022/03/24/q3Rgk4.jpg)\n\n### 读取方式\n\n链表与数组相比读取性能是有劣势的。数组读取操作性能高效是因为它是一块连续内存，读取通过寻址公式就可以快速定位，链表非连续内存必须通过指针节点一一遍历。\n\n### 使用场景\n\n*   撤销功能,这种操作最多见于各种文本、图形编辑器中,撤销重做在编辑器场景下属于家常便饭,单向链表由于良好的删除特性在这个场景很适用\n*   图片队列上传\n*   ...\n\n## 双链表（双向链表）\n\n我们看到双向链表多了一个新的指针prev指向节点的前一个节点,当然由于多了一个指针,所以双向链表要更占内存\n\n![双链表](https://s1.ax1x.com/2022/03/24/q3RfpR.jpg)\n\n### 插入操作\n\n向双链表中插入一个新节点，需要通过调整两次prev指向和两次next指向来完成。如下图所示，X为新节点，将A1的next指向X，将X的next指向A2，将A2的prev指向X，将X的prev指向A1即可。\n\n![双链表插入](https://s1.ax1x.com/2022/03/24/q3RT0O.jpg)\n### 删除操作\n\n从双链表中删除一个节点，需要通过调整一次prev指向和一次next指向来完成。如下图所示，删除A2节点，将A1的next指向A3，将A3的 prev指向A1即可。\n\n![双链表删除](https://s1.ax1x.com/2022/03/24/q3RqtH.jpg)\n\n## 循环链表\n\n环形链表又叫循环链表，本文讲述的是单向环形链表，其与单链表的唯一区别是尾部节点的next不再为空，则是指向了头部节点，这样便形成了一个环。\n\n![循环链表](https://s1.ax1x.com/2022/03/24/q3RxjP.jpg)\n\n小结：链表与数组的的不同之处在于数组是一块连续的内存,而链表可以不是连续内存,链表的节点与节点之间通过指针来联系的\n\n*   数组静态分配内存，链表动态分配内存\n*   数组在内存中连续，链表不连续\n*   数组元素在栈区，链表元素在堆区\n*   数组利用下标定位，时间复杂度为O(1)，链表定位元素时间复杂度O(n)\n*   数组插入或删除元素的时间复杂度O(n)，链表的时间复杂度O(1)\n","source":"_posts/2022/java/java-链表.md","raw":"---\ntitle: Java-链表（单向、循环、双向）\ndate: 2022-03-23 23:58:35\ncategories:\n - Java\ntags:\n - Java\ncover: https://s1.ax1x.com/2022/03/24/q32XLT.jpg\n---\n\n## 前言：\n\n什么是链表？链表是一种常见的基础数据结构，是一种线性表，但并不会按线性的顺序存储数据，而是在每一个节点里存到下一个节点的指针来做关联，同时链表也分为，单链表、双链表、循环链表。\n\n## 单链表（单向链表）\n\n### 单链表由两个部分构成\n\n*   DATA域：数据域、用来存储数据元素\n*   NEXT域：指针域、用来指向下一个节点\n\n![单链表](https://s1.ax1x.com/2022/03/24/q3RB60.jpg)\n\n链表与数组类似,也可以进行查找、插入、删除、读取等操作,但是由于链表与数组的特性不同,导致不同操作的复杂度也不同\n\n### 查找方式\n\n*   从头节点进入,开始比对节点的值,如果不同则通过指针进入下一个节点\n*   重复上面的动作,直到找到相同的值,或者节点的指针指向null\n\n*   时间复杂度为O(n)\n\n### 插入或删除方式\n\n链表与数组最大的不同就在于删除、插入的性能优势,由于链表是非连续的内存,所以不用像数组一样在插入、删除操作的时候需要进行大面积的成员位移,比如在a、b节点之间插入一个新节点c,链表只需要做\n\n*   a断开指向b的指针，将指针指向c\n*   c节点将指针指向b，完毕（这才是魅力所在）\n\n插入或删除只需要调整指针即可。\n\n时间复杂度为O(1)\n\n下面看下链表的插入、删除操作\n\n![单链表插入&删除](https://s1.ax1x.com/2022/03/24/q3Rgk4.jpg)\n\n### 读取方式\n\n链表与数组相比读取性能是有劣势的。数组读取操作性能高效是因为它是一块连续内存，读取通过寻址公式就可以快速定位，链表非连续内存必须通过指针节点一一遍历。\n\n### 使用场景\n\n*   撤销功能,这种操作最多见于各种文本、图形编辑器中,撤销重做在编辑器场景下属于家常便饭,单向链表由于良好的删除特性在这个场景很适用\n*   图片队列上传\n*   ...\n\n## 双链表（双向链表）\n\n我们看到双向链表多了一个新的指针prev指向节点的前一个节点,当然由于多了一个指针,所以双向链表要更占内存\n\n![双链表](https://s1.ax1x.com/2022/03/24/q3RfpR.jpg)\n\n### 插入操作\n\n向双链表中插入一个新节点，需要通过调整两次prev指向和两次next指向来完成。如下图所示，X为新节点，将A1的next指向X，将X的next指向A2，将A2的prev指向X，将X的prev指向A1即可。\n\n![双链表插入](https://s1.ax1x.com/2022/03/24/q3RT0O.jpg)\n### 删除操作\n\n从双链表中删除一个节点，需要通过调整一次prev指向和一次next指向来完成。如下图所示，删除A2节点，将A1的next指向A3，将A3的 prev指向A1即可。\n\n![双链表删除](https://s1.ax1x.com/2022/03/24/q3RqtH.jpg)\n\n## 循环链表\n\n环形链表又叫循环链表，本文讲述的是单向环形链表，其与单链表的唯一区别是尾部节点的next不再为空，则是指向了头部节点，这样便形成了一个环。\n\n![循环链表](https://s1.ax1x.com/2022/03/24/q3RxjP.jpg)\n\n小结：链表与数组的的不同之处在于数组是一块连续的内存,而链表可以不是连续内存,链表的节点与节点之间通过指针来联系的\n\n*   数组静态分配内存，链表动态分配内存\n*   数组在内存中连续，链表不连续\n*   数组元素在栈区，链表元素在堆区\n*   数组利用下标定位，时间复杂度为O(1)，链表定位元素时间复杂度O(n)\n*   数组插入或删除元素的时间复杂度O(n)，链表的时间复杂度O(1)\n","slug":"java-链表","published":1,"relaxed":"java","updated":"2022-03-31T02:11:53.378Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl2vhlmg2000pt6fy65ynf3wn","content":"<h2 id=\"前言：\"><a href=\"#前言：\" class=\"headerlink\" title=\"前言：\"></a>前言：</h2><p>什么是链表？链表是一种常见的基础数据结构，是一种线性表，但并不会按线性的顺序存储数据，而是在每一个节点里存到下一个节点的指针来做关联，同时链表也分为，单链表、双链表、循环链表。</p>\n<h2 id=\"单链表（单向链表）\"><a href=\"#单链表（单向链表）\" class=\"headerlink\" title=\"单链表（单向链表）\"></a>单链表（单向链表）</h2><h3 id=\"单链表由两个部分构成\"><a href=\"#单链表由两个部分构成\" class=\"headerlink\" title=\"单链表由两个部分构成\"></a>单链表由两个部分构成</h3><ul>\n<li>  DATA域：数据域、用来存储数据元素</li>\n<li>  NEXT域：指针域、用来指向下一个节点</li>\n</ul>\n<p><img src=\"https://s1.ax1x.com/2022/03/24/q3RB60.jpg\" alt=\"单链表\"></p>\n<p>链表与数组类似,也可以进行查找、插入、删除、读取等操作,但是由于链表与数组的特性不同,导致不同操作的复杂度也不同</p>\n<h3 id=\"查找方式\"><a href=\"#查找方式\" class=\"headerlink\" title=\"查找方式\"></a>查找方式</h3><ul>\n<li><p>  从头节点进入,开始比对节点的值,如果不同则通过指针进入下一个节点</p>\n</li>\n<li><p>  重复上面的动作,直到找到相同的值,或者节点的指针指向null</p>\n</li>\n<li><p>  时间复杂度为O(n)</p>\n</li>\n</ul>\n<h3 id=\"插入或删除方式\"><a href=\"#插入或删除方式\" class=\"headerlink\" title=\"插入或删除方式\"></a>插入或删除方式</h3><p>链表与数组最大的不同就在于删除、插入的性能优势,由于链表是非连续的内存,所以不用像数组一样在插入、删除操作的时候需要进行大面积的成员位移,比如在a、b节点之间插入一个新节点c,链表只需要做</p>\n<ul>\n<li>  a断开指向b的指针，将指针指向c</li>\n<li>  c节点将指针指向b，完毕（这才是魅力所在）</li>\n</ul>\n<p>插入或删除只需要调整指针即可。</p>\n<p>时间复杂度为O(1)</p>\n<p>下面看下链表的插入、删除操作</p>\n<p><img src=\"https://s1.ax1x.com/2022/03/24/q3Rgk4.jpg\" alt=\"单链表插入&amp;删除\"></p>\n<h3 id=\"读取方式\"><a href=\"#读取方式\" class=\"headerlink\" title=\"读取方式\"></a>读取方式</h3><p>链表与数组相比读取性能是有劣势的。数组读取操作性能高效是因为它是一块连续内存，读取通过寻址公式就可以快速定位，链表非连续内存必须通过指针节点一一遍历。</p>\n<h3 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h3><ul>\n<li>  撤销功能,这种操作最多见于各种文本、图形编辑器中,撤销重做在编辑器场景下属于家常便饭,单向链表由于良好的删除特性在这个场景很适用</li>\n<li>  图片队列上传</li>\n<li>  …</li>\n</ul>\n<h2 id=\"双链表（双向链表）\"><a href=\"#双链表（双向链表）\" class=\"headerlink\" title=\"双链表（双向链表）\"></a>双链表（双向链表）</h2><p>我们看到双向链表多了一个新的指针prev指向节点的前一个节点,当然由于多了一个指针,所以双向链表要更占内存</p>\n<p><img src=\"https://s1.ax1x.com/2022/03/24/q3RfpR.jpg\" alt=\"双链表\"></p>\n<h3 id=\"插入操作\"><a href=\"#插入操作\" class=\"headerlink\" title=\"插入操作\"></a>插入操作</h3><p>向双链表中插入一个新节点，需要通过调整两次prev指向和两次next指向来完成。如下图所示，X为新节点，将A1的next指向X，将X的next指向A2，将A2的prev指向X，将X的prev指向A1即可。</p>\n<p><img src=\"https://s1.ax1x.com/2022/03/24/q3RT0O.jpg\" alt=\"双链表插入\"></p>\n<h3 id=\"删除操作\"><a href=\"#删除操作\" class=\"headerlink\" title=\"删除操作\"></a>删除操作</h3><p>从双链表中删除一个节点，需要通过调整一次prev指向和一次next指向来完成。如下图所示，删除A2节点，将A1的next指向A3，将A3的 prev指向A1即可。</p>\n<p><img src=\"https://s1.ax1x.com/2022/03/24/q3RqtH.jpg\" alt=\"双链表删除\"></p>\n<h2 id=\"循环链表\"><a href=\"#循环链表\" class=\"headerlink\" title=\"循环链表\"></a>循环链表</h2><p>环形链表又叫循环链表，本文讲述的是单向环形链表，其与单链表的唯一区别是尾部节点的next不再为空，则是指向了头部节点，这样便形成了一个环。</p>\n<p><img src=\"https://s1.ax1x.com/2022/03/24/q3RxjP.jpg\" alt=\"循环链表\"></p>\n<p>小结：链表与数组的的不同之处在于数组是一块连续的内存,而链表可以不是连续内存,链表的节点与节点之间通过指针来联系的</p>\n<ul>\n<li>  数组静态分配内存，链表动态分配内存</li>\n<li>  数组在内存中连续，链表不连续</li>\n<li>  数组元素在栈区，链表元素在堆区</li>\n<li>  数组利用下标定位，时间复杂度为O(1)，链表定位元素时间复杂度O(n)</li>\n<li>  数组插入或删除元素的时间复杂度O(n)，链表的时间复杂度O(1)</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言：\"><a href=\"#前言：\" class=\"headerlink\" title=\"前言：\"></a>前言：</h2><p>什么是链表？链表是一种常见的基础数据结构，是一种线性表，但并不会按线性的顺序存储数据，而是在每一个节点里存到下一个节点的指针来做关联，同时链表也分为，单链表、双链表、循环链表。</p>\n<h2 id=\"单链表（单向链表）\"><a href=\"#单链表（单向链表）\" class=\"headerlink\" title=\"单链表（单向链表）\"></a>单链表（单向链表）</h2><h3 id=\"单链表由两个部分构成\"><a href=\"#单链表由两个部分构成\" class=\"headerlink\" title=\"单链表由两个部分构成\"></a>单链表由两个部分构成</h3><ul>\n<li>  DATA域：数据域、用来存储数据元素</li>\n<li>  NEXT域：指针域、用来指向下一个节点</li>\n</ul>\n<p><img src=\"https://s1.ax1x.com/2022/03/24/q3RB60.jpg\" alt=\"单链表\"></p>\n<p>链表与数组类似,也可以进行查找、插入、删除、读取等操作,但是由于链表与数组的特性不同,导致不同操作的复杂度也不同</p>\n<h3 id=\"查找方式\"><a href=\"#查找方式\" class=\"headerlink\" title=\"查找方式\"></a>查找方式</h3><ul>\n<li><p>  从头节点进入,开始比对节点的值,如果不同则通过指针进入下一个节点</p>\n</li>\n<li><p>  重复上面的动作,直到找到相同的值,或者节点的指针指向null</p>\n</li>\n<li><p>  时间复杂度为O(n)</p>\n</li>\n</ul>\n<h3 id=\"插入或删除方式\"><a href=\"#插入或删除方式\" class=\"headerlink\" title=\"插入或删除方式\"></a>插入或删除方式</h3><p>链表与数组最大的不同就在于删除、插入的性能优势,由于链表是非连续的内存,所以不用像数组一样在插入、删除操作的时候需要进行大面积的成员位移,比如在a、b节点之间插入一个新节点c,链表只需要做</p>\n<ul>\n<li>  a断开指向b的指针，将指针指向c</li>\n<li>  c节点将指针指向b，完毕（这才是魅力所在）</li>\n</ul>\n<p>插入或删除只需要调整指针即可。</p>\n<p>时间复杂度为O(1)</p>\n<p>下面看下链表的插入、删除操作</p>\n<p><img src=\"https://s1.ax1x.com/2022/03/24/q3Rgk4.jpg\" alt=\"单链表插入&amp;删除\"></p>\n<h3 id=\"读取方式\"><a href=\"#读取方式\" class=\"headerlink\" title=\"读取方式\"></a>读取方式</h3><p>链表与数组相比读取性能是有劣势的。数组读取操作性能高效是因为它是一块连续内存，读取通过寻址公式就可以快速定位，链表非连续内存必须通过指针节点一一遍历。</p>\n<h3 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h3><ul>\n<li>  撤销功能,这种操作最多见于各种文本、图形编辑器中,撤销重做在编辑器场景下属于家常便饭,单向链表由于良好的删除特性在这个场景很适用</li>\n<li>  图片队列上传</li>\n<li>  …</li>\n</ul>\n<h2 id=\"双链表（双向链表）\"><a href=\"#双链表（双向链表）\" class=\"headerlink\" title=\"双链表（双向链表）\"></a>双链表（双向链表）</h2><p>我们看到双向链表多了一个新的指针prev指向节点的前一个节点,当然由于多了一个指针,所以双向链表要更占内存</p>\n<p><img src=\"https://s1.ax1x.com/2022/03/24/q3RfpR.jpg\" alt=\"双链表\"></p>\n<h3 id=\"插入操作\"><a href=\"#插入操作\" class=\"headerlink\" title=\"插入操作\"></a>插入操作</h3><p>向双链表中插入一个新节点，需要通过调整两次prev指向和两次next指向来完成。如下图所示，X为新节点，将A1的next指向X，将X的next指向A2，将A2的prev指向X，将X的prev指向A1即可。</p>\n<p><img src=\"https://s1.ax1x.com/2022/03/24/q3RT0O.jpg\" alt=\"双链表插入\"></p>\n<h3 id=\"删除操作\"><a href=\"#删除操作\" class=\"headerlink\" title=\"删除操作\"></a>删除操作</h3><p>从双链表中删除一个节点，需要通过调整一次prev指向和一次next指向来完成。如下图所示，删除A2节点，将A1的next指向A3，将A3的 prev指向A1即可。</p>\n<p><img src=\"https://s1.ax1x.com/2022/03/24/q3RqtH.jpg\" alt=\"双链表删除\"></p>\n<h2 id=\"循环链表\"><a href=\"#循环链表\" class=\"headerlink\" title=\"循环链表\"></a>循环链表</h2><p>环形链表又叫循环链表，本文讲述的是单向环形链表，其与单链表的唯一区别是尾部节点的next不再为空，则是指向了头部节点，这样便形成了一个环。</p>\n<p><img src=\"https://s1.ax1x.com/2022/03/24/q3RxjP.jpg\" alt=\"循环链表\"></p>\n<p>小结：链表与数组的的不同之处在于数组是一块连续的内存,而链表可以不是连续内存,链表的节点与节点之间通过指针来联系的</p>\n<ul>\n<li>  数组静态分配内存，链表动态分配内存</li>\n<li>  数组在内存中连续，链表不连续</li>\n<li>  数组元素在栈区，链表元素在堆区</li>\n<li>  数组利用下标定位，时间复杂度为O(1)，链表定位元素时间复杂度O(n)</li>\n<li>  数组插入或删除元素的时间复杂度O(n)，链表的时间复杂度O(1)</li>\n</ul>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cl2vhlmfk0001t6fydl615rdg","category_id":"cl2vhlmfp0004t6fy5830bpr6","_id":"cl2vhlmfy000ht6fy412a1156"},{"post_id":"cl2vhlmfn0003t6fyb3nt5url","category_id":"cl2vhlmfp0004t6fy5830bpr6","_id":"cl2vhlmg1000mt6fyasvc94d2"},{"post_id":"cl2vhlmfr0007t6fyb0m9cxtc","category_id":"cl2vhlmfx000gt6fy5m427ghq","_id":"cl2vhlmg3000rt6fydhqu3wzd"},{"post_id":"cl2vhlmfs0009t6fy0vjt6joq","category_id":"cl2vhlmg1000nt6fy6nhf3y2k","_id":"cl2vhlmg5000wt6fyh4g0e6em"},{"post_id":"cl2vhlmft000at6fy23fs3ume","category_id":"cl2vhlmg1000nt6fy6nhf3y2k","_id":"cl2vhlmg60010t6fy2g3vgti0"},{"post_id":"cl2vhlmfw000et6fyfqma6rq4","category_id":"cl2vhlmg1000nt6fy6nhf3y2k","_id":"cl2vhlmg70013t6fy3cs87b9b"},{"post_id":"cl2vhlmfx000ft6fy1sam8s86","category_id":"cl2vhlmg6000zt6fy0kpn1cnr","_id":"cl2vhlmg70018t6fyehk445ab"},{"post_id":"cl2vhlmfy000kt6fyfw13e4h5","category_id":"cl2vhlmg6000zt6fy0kpn1cnr","_id":"cl2vhlmg8001ct6fyhel15t81"},{"post_id":"cl2vhlmfz000lt6fye9ui2mth","category_id":"cl2vhlmg6000zt6fy0kpn1cnr","_id":"cl2vhlmg9001ft6fy1u3q61os"},{"post_id":"cl2vhlmg2000pt6fy65ynf3wn","category_id":"cl2vhlmg6000zt6fy0kpn1cnr","_id":"cl2vhlmg9001ht6fybroxczaw"}],"PostTag":[{"post_id":"cl2vhlmfk0001t6fydl615rdg","tag_id":"cl2vhlmfq0005t6fy34scc15w","_id":"cl2vhlmfw000dt6fy2sjmcj7v"},{"post_id":"cl2vhlmfn0003t6fyb3nt5url","tag_id":"cl2vhlmfq0005t6fy34scc15w","_id":"cl2vhlmfy000jt6fyhsync4ct"},{"post_id":"cl2vhlmfr0007t6fyb0m9cxtc","tag_id":"cl2vhlmfy000it6fy5ktfesqk","_id":"cl2vhlmg3000qt6fyai020xsr"},{"post_id":"cl2vhlmfs0009t6fy0vjt6joq","tag_id":"cl2vhlmg1000ot6fyg2cbc4v4","_id":"cl2vhlmg4000ut6fy7ayy22of"},{"post_id":"cl2vhlmft000at6fy23fs3ume","tag_id":"cl2vhlmg3000tt6fyezk89io2","_id":"cl2vhlmg5000yt6fy8m1rdpvu"},{"post_id":"cl2vhlmfw000et6fyfqma6rq4","tag_id":"cl2vhlmg1000ot6fyg2cbc4v4","_id":"cl2vhlmg60012t6fybde2gh6z"},{"post_id":"cl2vhlmfx000ft6fy1sam8s86","tag_id":"cl2vhlmg60011t6fy2qmnfsew","_id":"cl2vhlmg70016t6fyhv1s56c8"},{"post_id":"cl2vhlmfy000kt6fyfw13e4h5","tag_id":"cl2vhlmg60011t6fy2qmnfsew","_id":"cl2vhlmg8001at6fycjc95ksz"},{"post_id":"cl2vhlmfz000lt6fye9ui2mth","tag_id":"cl2vhlmg60011t6fy2qmnfsew","_id":"cl2vhlmg9001et6fy9sptcqnm"},{"post_id":"cl2vhlmg2000pt6fy65ynf3wn","tag_id":"cl2vhlmg60011t6fy2qmnfsew","_id":"cl2vhlmg9001gt6fy5uwx1j1j"}],"Tag":[{"name":"Git","_id":"cl2vhlmfq0005t6fy34scc15w"},{"name":"Markdown","_id":"cl2vhlmfy000it6fy5ktfesqk"},{"name":"Handler","_id":"cl2vhlmg1000ot6fyg2cbc4v4"},{"name":"Android","_id":"cl2vhlmg3000tt6fyezk89io2"},{"name":"Java","_id":"cl2vhlmg60011t6fy2qmnfsew"}]}}